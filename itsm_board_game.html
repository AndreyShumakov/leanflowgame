<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSM Operations: Service Desk Challenge</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --incident: #e74c3c; --problem: #9b59b6; --change: #3498db; --knowledge: #27ae60;
            --bg-dark: #0a0e17; --bg-card: #141b2d; --text-primary: #e8e8e8; --text-secondary: #8892a0;
            --success: #00d9a5; --warning: #f1c40f; --danger: #e74c3c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Exo 2', sans-serif; background: var(--bg-dark); 
            background-image: radial-gradient(ellipse at 20% 20%, rgba(52,152,219,0.1) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 80%, rgba(155,89,182,0.1) 0%, transparent 50%);
            min-height: 100vh; color: var(--text-primary); padding: 15px; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 20px; }
        .title { font-family: 'Russo One', sans-serif; font-size: 2.5em;
            background: linear-gradient(135deg, #00d9a5, #3498db, #9b59b6);
            background-clip: text; -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; }
        .subtitle { color: var(--text-secondary); }
        
        .layout { display: grid; grid-template-columns: 260px 1fr 280px; gap: 15px; }
        .panel { background: var(--bg-card); border-radius: 12px; padding: 15px;
            border: 1px solid rgba(255,255,255,0.05); }
        .panel-title { font-family: 'Russo One', sans-serif; font-size: 1em; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px; }
        .icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center;
            justify-content: center; font-size: 1em; }
        
        .turn-box { background: linear-gradient(135deg, rgba(52,152,219,0.2), rgba(155,89,182,0.2));
            border-radius: 10px; padding: 15px; text-align: center; border: 2px solid rgba(52,152,219,0.3); }
        .turn-num { font-size: 2.5em; font-weight: 700; color: #3498db; }
        .turn-label { color: var(--text-secondary); font-size: 0.85em; }
        
        .stat { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px; margin-top: 10px; }
        .stat-label { color: var(--text-secondary); font-size: 0.8em; }
        .stat-value { font-size: 1.5em; font-weight: 700; }
        .stat-incident { color: var(--incident); }
        .stat-problem { color: var(--problem); }
        .stat-change { color: var(--change); }
        .stat-kb { color: var(--knowledge); }
        
        .scores { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .score-box { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 10px; text-align: center; }
        .score-label { font-size: 0.75em; color: var(--text-secondary); }
        .score-val { font-size: 1.3em; font-weight: 700; color: var(--success); }
        
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer;
            font-family: 'Exo 2', sans-serif; font-weight: 600; transition: all 0.3s; width: 100%; margin-top: 8px; }
        .btn:hover { transform: translateY(-2px); }
        .btn-start { background: linear-gradient(135deg, #00d9a5, #1abc9c); color: white; }
        .btn-reset { background: linear-gradient(135deg, #e74c3c, #ec7063); color: white; }
        .btn-rules { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        
        .board { min-height: 600px; }
        .board-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .sla-timer { display: flex; align-items: center; gap: 8px; background: rgba(241,196,15,0.1);
            padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(241,196,15,0.3); }
        .sla-timer.warning { background: rgba(241,196,15,0.2); border-color: var(--warning); }
        .sla-timer.danger { background: rgba(231,76,60,0.2); border-color: var(--danger); animation: pulse 1s infinite; }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞—è–≤–æ–∫ */
        .queue { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; }
        .ticket { background: rgba(255,255,255,0.03); border-radius: 10px; padding: 12px;
            border: 2px solid transparent; cursor: pointer; transition: all 0.3s; position: relative; }
        .ticket::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: 10px 10px 0 0; }
        .ticket.incident::before { background: var(--incident); }
        .ticket.problem::before { background: var(--problem); }
        .ticket.change::before { background: var(--change); }
        .ticket:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .ticket.incident:hover { border-color: var(--incident); }
        .ticket.problem:hover { border-color: var(--problem); }
        .ticket.change:hover { border-color: var(--change); }
        .ticket.selected { transform: scale(1.02); box-shadow: 0 0 25px rgba(52,152,219,0.5); border-color: #3498db; }
        .ticket-id { font-size: 0.75em; color: var(--text-secondary); }
        .ticket-title { font-weight: 600; font-size: 0.9em; margin: 5px 0; }
        .ticket-icon { position: absolute; top: 12px; right: 12px; font-size: 1.3em; }
        .ticket-threshold { font-size: 0.75em; color: var(--text-secondary); margin: 5px 0; 
            background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 5px; display: inline-block; }
        .ticket-threshold.easy { color: #2ecc71; }
        .ticket-threshold.medium { color: #f1c40f; }
        .ticket-threshold.hard { color: #e74c3c; }
        .priority { display: inline-block; padding: 2px 8px; border-radius: 15px; font-size: 0.7em; font-weight: 600; }
        .priority-critical { background: rgba(231,76,60,0.2); color: #e74c3c; }
        .priority-high { background: rgba(230,126,34,0.2); color: #e67e22; }
        .priority-medium { background: rgba(241,196,15,0.2); color: #f1c40f; }
        .priority-low { background: rgba(46,204,113,0.2); color: #2ecc71; }
        
        .change-type { display: inline-block; padding: 2px 8px; border-radius: 15px; font-size: 0.7em; font-weight: 600; margin-left: 4px; }
        .type-emergency { background: rgba(231,76,60,0.3); color: #e74c3c; animation: urgentPulse 1.5s infinite; }
        .type-standard { background: rgba(52,152,219,0.3); color: #3498db; }
        .type-normal { background: rgba(149,165,166,0.3); color: #95a5a6; }
        @keyframes urgentPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        
        /* –°–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞—è–≤–∫–∞–º–∏ */
        .ticket-links { margin-top: 8px; padding-top: 8px; border-top: 1px dashed rgba(255,255,255,0.1); }
        .link { font-size: 0.7em; padding: 2px 6px; border-radius: 4px; margin-right: 4px; display: inline-block; margin-bottom: 3px; }
        .link-parent { background: rgba(155,89,182,0.3); color: #bb8fce; }
        .link-child { background: rgba(52,152,219,0.3); color: #5dade2; }
        .link-related { background: rgba(39,174,96,0.3); color: #58d68d; }
        
        /* –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π */
        .actions { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-top: 15px; }
        .actions-title { font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .action-btns { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .action-btn { padding: 12px 8px; border: none; border-radius: 8px; cursor: pointer;
            font-family: 'Exo 2', sans-serif; font-size: 0.85em; font-weight: 600; transition: all 0.3s;
            display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .action-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .action-btn:not(:disabled):hover { transform: translateY(-2px); }
        .action-btn .ico { font-size: 1.3em; }
        .btn-resolve { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        .btn-escalate { background: linear-gradient(135deg, #e67e22, #f39c12); color: white; }
        .btn-kb { background: linear-gradient(135deg, #3498db, #5dade2); color: white; }
        .btn-workaround { background: linear-gradient(135deg, #f1c40f, #f4d03f); color: #333; }
        .btn-rca { background: linear-gradient(135deg, #9b59b6, #a569bd); color: white; }
        .btn-change { background: linear-gradient(135deg, #1abc9c, #16a085); color: white; }
        .btn-implement { background: linear-gradient(135deg, #00d9a5, #1abc9c); color: white; }
        .btn-rollback { background: linear-gradient(135deg, #34495e, #5d6d7e); color: white; }
        .btn-assess { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .btn-cab { background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; }
        
        /* –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π */
        .log { max-height: 180px; overflow-y: auto; margin-top: 15px; }
        .log-entry { padding: 6px 10px; border-radius: 6px; margin-bottom: 4px; font-size: 0.8em;
            background: rgba(255,255,255,0.03); border-left: 3px solid var(--text-secondary); animation: slideIn 0.3s; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .log-entry.success { border-left-color: var(--success); }
        .log-entry.warning { border-left-color: var(--warning); }
        .log-entry.error { border-left-color: var(--danger); }
        .log-entry.info { border-left-color: var(--change); }
        .log-entry.link { border-left-color: var(--problem); background: rgba(155,89,182,0.1); }
        .log-time { color: var(--text-secondary); font-size: 0.9em; }
        
        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .kb-article { background: rgba(39,174,96,0.1); border: 1px solid rgba(39,174,96,0.3);
            border-radius: 8px; padding: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.3s; }
        .kb-article:hover { background: rgba(39,174,96,0.2); }
        .kb-article.applicable { background: rgba(39,174,96,0.25); border: 2px solid rgba(39,174,96,0.8); 
            box-shadow: 0 0 10px rgba(39,174,96,0.4); }
        .kb-article.not-applicable { opacity: 0.4; cursor: not-allowed; }
        .kb-article.not-applicable:hover { background: rgba(39,174,96,0.1); }
        .kb-title { font-weight: 600; font-size: 0.85em; margin-bottom: 4px; }
        .kb-tags { display: flex; flex-wrap: wrap; gap: 4px; }
        .kb-tag { background: rgba(255,255,255,0.1); padding: 1px 6px; border-radius: 8px;
            font-size: 0.65em; color: var(--text-secondary); }
        .known-error { background: rgba(155,89,182,0.1); border-color: rgba(155,89,182,0.3); }
        .scheduled-change { background: rgba(52,152,219,0.1); border-color: rgba(52,152,219,0.3); }
        .section { margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }
        .empty-msg { color: var(--text-secondary); font-size: 0.85em; text-align: center; padding: 15px; }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; }
        .modal-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--bg-card); border-radius: 16px; padding: 25px; width: 90%; max-width: 550px;
            max-height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-title { font-family: 'Russo One', sans-serif; font-size: 1.3em; }
        .modal-close { background: none; border: none; color: var(--text-secondary); font-size: 1.5em; cursor: pointer; }
        .detail { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05); }
        .detail-row:last-child { border-bottom: none; }
        .detail-label { color: var(--text-secondary); }
        .detail-value { font-weight: 600; }
        
        /* –ö–æ—Å—Ç–∏ */
        .dice-area { display: flex; justify-content: center; gap: 15px; margin: 15px 0; }
        .dice { width: 70px; height: 70px; background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 2em; font-weight: 700; color: white; box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            cursor: pointer; transition: all 0.3s; }
        .dice:hover { transform: scale(1.1); }
        .dice.rolling { animation: roll 0.5s ease-in-out; }
        @keyframes roll { 0% { transform: rotate(0) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1); } }
        
        /* –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã */
        .game-over { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10,14,23,0.95); display: none; z-index: 2000;
            flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .game-over h1 { font-family: 'Russo One', sans-serif; font-size: 3em; margin-bottom: 15px;
            background: linear-gradient(135deg, #00d9a5, #3498db); 
            background-clip: text; -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; }
        .final-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 25px 0; }
        .final-stat { background: var(--bg-card); border-radius: 12px; padding: 20px; }
        .final-stat-value { font-size: 2.5em; font-weight: 700; }
        .final-stat-label { color: var(--text-secondary); margin-top: 8px; font-size: 0.9em; }
        
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ */
        .instructions h3 { color: var(--success); margin: 15px 0 8px; font-family: 'Russo One', sans-serif; }
        .instructions ul { padding-left: 18px; line-height: 1.7; }
        .process-card { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin: 8px 0; border-left: 4px solid; }
        .process-card.incident { border-left-color: var(--incident); }
        .process-card.problem { border-left-color: var(--problem); }
        .process-card.change { border-left-color: var(--change); }
        .process-card.knowledge { border-left-color: var(--knowledge); }
        
        /* –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–≤—è–∑–µ–π */
        .flow-diagram { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin: 15px 0; text-align: center; }
        .flow-arrow { color: var(--text-secondary); font-size: 1.5em; margin: 5px 0; }
        .flow-box { display: inline-block; padding: 8px 15px; border-radius: 8px; margin: 5px; font-weight: 600; }
        .flow-incident { background: rgba(231,76,60,0.3); border: 1px solid var(--incident); }
        .flow-problem { background: rgba(155,89,182,0.3); border: 1px solid var(--problem); }
        .flow-change { background: rgba(52,152,219,0.3); border: 1px solid var(--change); }
        .flow-kb { background: rgba(39,174,96,0.3); border: 1px solid var(--knowledge); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        
        @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } .action-btns { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
<div class="container">
    <header class="header">
        <h1 class="title">ITSM Operations</h1>
        <p class="subtitle">Service Desk Challenge ‚Äî –ù–∞—Å—Ç–æ–ª—å–Ω–∞—è –±–∏–∑–Ω–µ—Å-–∏–≥—Ä–∞ —Å –≤–∑–∞–∏–º–æ—Å–≤—è–∑—è–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ ITIL 4</p>
    </header>
    
    <div class="layout">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="panel">
            <div class="turn-box">
                <div class="turn-label">–î–ï–ù–¨</div>
                <div class="turn-num" id="turn">0</div>
                <div class="turn-label">–∏–∑ 10</div>
            </div>
            <div class="stat"><div class="stat-label">üî• –ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–æ</div><div class="stat-value stat-incident" id="statInc">0</div></div>
            <div class="stat"><div class="stat-label">üîç –ü—Ä–æ–±–ª–µ–º —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ</div><div class="stat-value stat-problem" id="statPrb">0</div></div>
            <div class="stat"><div class="stat-label">‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–π –≤–Ω–µ–¥—Ä–µ–Ω–æ</div><div class="stat-value stat-change" id="statChg">0</div></div>
            <div class="stat"><div class="stat-label">üìö –°—Ç–∞—Ç–µ–π –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</div><div class="stat-value stat-kb" id="statKb">3</div></div>
            <div class="stat"><div class="stat-label">üîó –°–≤—è–∑–µ–π —Å–æ–∑–¥–∞–Ω–æ</div><div class="stat-value" style="color:#bb8fce" id="statLinks">0</div></div>
            <div class="scores">
                <div class="score-box"><div class="score-label">–û–ß–ö–ò</div><div class="score-val" id="score">0</div></div>
                <div class="score-box"><div class="score-label">SLA %</div><div class="score-val" id="sla">100%</div></div>
            </div>
            <button class="btn btn-start" id="startBtn" onclick="startGame()">‚ñ∂ –°–¢–ê–†–¢</button>
            <button class="btn btn-reset" onclick="resetGame()">‚Üª –°–ë–†–û–°</button>
            <button class="btn btn-rules" onclick="showRules()">üìñ –ü–†–ê–í–ò–õ–ê</button>
            
            <div class="section">
                <div class="panel-title"><div class="icon" style="background:var(--incident)">üîó</div>–ö–∞—Ä—Ç–∞ —Å–≤—è–∑–µ–π</div>
                <div id="linksMap"><div class="empty-msg">–°–≤—è–∑–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</div></div>
            </div>
        </aside>
        
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <main class="panel board">
            <div class="board-header">
                <h2 style="font-family: 'Russo One', sans-serif;">üìã –û—á–µ—Ä–µ–¥—å –∑–∞—è–≤–æ–∫</h2>
                <div class="sla-timer" id="slaTimer"><span>‚è±Ô∏è</span><span id="timerText">SLA: 3:00</span></div>
            </div>
            <div class="queue" id="queue"><div class="empty-msg">üëÜ –ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div></div>
            
            <div class="actions" id="actionsArea" style="display:none">
                <div class="actions-title"><span>üéØ</span><span>–î–µ–π—Å—Ç–≤–∏—è –¥–ª—è: <strong id="selectedId">-</strong></span></div>
                <div id="ticketInfo" style="font-size:0.75em;color:var(--text-secondary);margin-bottom:8px;padding:6px;background:rgba(0,0,0,0.2);border-radius:5px"></div>
                <div id="kbStatus" style="display:none;font-size:0.8em;padding:8px;margin-bottom:8px;background:rgba(39,174,96,0.2);border:1px solid rgba(39,174,96,0.5);border-radius:5px;color:var(--success)">
                    üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ (-2 –∫ –ø–æ—Ä–æ–≥—É)
                </div>
                <div class="action-btns" id="incActions" style="display:none">
                    <button class="action-btn btn-resolve" onclick="doAction('resolve')"><span class="ico">‚úÖ</span>–†–µ—à–∏—Ç—å</button>
                    <button class="action-btn btn-escalate" onclick="doAction('escalate')"><span class="ico">‚¨ÜÔ∏è</span>–≠—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="action-btn btn-kb" onclick="doAction('searchKb')"><span class="ico">üîç</span>–ò—Å–∫–∞—Ç—å –≤ KB</button>
                    <button class="action-btn btn-workaround" onclick="doAction('workaround')"><span class="ico">üîß</span>Workaround</button>
                    <button class="action-btn btn-rca" onclick="doAction('createProblem')"><span class="ico">üîç</span>‚Üí –ü—Ä–æ–±–ª–µ–º–∞</button>
                </div>
                <div class="action-btns" id="prbActions" style="display:none">
                    <button class="action-btn btn-rca" onclick="doAction('rca')"><span class="ico">üî¨</span>RCA –∞–Ω–∞–ª–∏–∑</button>
                    <button class="action-btn btn-workaround" onclick="doAction('docWorkaround')"><span class="ico">üìù</span>Workaround</button>
                    <button class="action-btn btn-change" onclick="doAction('createChange')"><span class="ico">‚öôÔ∏è</span>‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ</button>
                    <button class="action-btn btn-kb" onclick="doAction('createArticle')"><span class="ico">üìö</span>‚Üí –°—Ç–∞—Ç—å—è KB</button>
                </div>
                <div class="action-btns" id="chgActions" style="display:none">
                    <button class="action-btn btn-assess" onclick="doAction('assess')"><span class="ico">üìã</span>–û—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫–∏</button>
                    <button class="action-btn btn-implement" onclick="doAction('implement')"><span class="ico">üöÄ</span>–í–Ω–µ–¥—Ä–∏—Ç—å</button>
                    <button class="action-btn btn-rollback" onclick="doAction('rollback')"><span class="ico">‚Ü©Ô∏è</span>–û—Ç–∫–∞—Ç–∏—Ç—å</button>
                    <button class="action-btn btn-cab" onclick="doAction('cab')"><span class="ico">üë•</span>CAB</button>
                </div>
            </div>
            
            <div style="margin-top:15px"><h3 style="font-size:0.95em;color:var(--text-secondary);margin-bottom:8px">üìú –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h3>
                <div class="log" id="log"><div class="log-entry info"><span class="log-time">00:00</span> ‚Äî –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞</div></div>
            </div>
        </main>
        
        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <aside class="panel" style="max-height:700px;overflow-y:auto">
            <div class="panel-title">
                <div class="icon" style="background:var(--knowledge)">üìö</div>
                <div>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π <span id="kbMatch" style="color:var(--text-secondary);font-size:0.8em;font-weight:normal"></span></div>
            </div>
            <div id="kbHint" style="display:none;font-size:0.75em;color:var(--warning);margin-bottom:10px;padding:8px;background:rgba(241,196,15,0.1);border:1px solid rgba(241,196,15,0.3);border-radius:5px">
                üí° –ù–∞–∂–º–∏—Ç–µ "üîç –ò—Å–∫–∞—Ç—å –≤ KB" –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Å—Ç–∞—Ç—å–∏
            </div>
            <div id="kbList"></div>
            
            <div class="section"><div class="panel-title"><div class="icon" style="background:var(--problem)">üîç</div>–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏</div>
                <div id="knownErrors"><div class="empty-msg">–ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div></div>
            </div>
            
            <div class="section"><div class="panel-title"><div class="icon" style="background:var(--change)">üìÖ</div>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</div>
                <div id="scheduledChanges"><div class="empty-msg">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö</div></div>
            </div>
        </aside>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ—Å—Ç—è–º–∏ -->
<div class="modal" id="diceModal">
    <div class="modal-box">
        <div class="modal-header"><h2 class="modal-title" id="diceTitle">–î–µ–π—Å—Ç–≤–∏–µ</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="detail" id="diceDetails"></div>
        <div class="dice-area"><div class="dice" id="d1" onclick="rollDice()">üé≤</div><div class="dice" id="d2" onclick="rollDice()">üé≤</div></div>
        <p style="text-align:center;color:var(--text-secondary);margin-bottom:15px">–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –∫–æ—Å—Ç—è–º –¥–ª—è –±—Ä–æ—Å–∫–∞</p>
        <button class="btn btn-start" id="diceConfirm" onclick="confirmDice()" disabled>–ë—Ä–æ—Å—å—Ç–µ –∫–æ—Å—Ç–∏</button>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π -->
<div class="modal" id="kbSearchModal">
    <div class="modal-box" style="max-width:600px">
        <div class="modal-header"><h2 class="modal-title">üîç –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</h2><button class="modal-close" onclick="closeKbSearch()">√ó</button></div>
        <div class="detail">
            <p style="margin-bottom:15px;color:var(--text-secondary)">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—å—é, –ø–æ–¥—Ö–æ–¥—è—â—É—é –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ <strong id="kbSearchTicketId">-</strong></p>
            <div id="kbSearchTicketTags" style="margin-bottom:15px;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px;"></div>
        </div>
        <div id="kbSearchList" style="max-height:400px;overflow-y:auto;"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª -->
<div class="modal" id="rulesModal">
    <div class="modal-box" style="max-width:750px">
        <div class="modal-header"><h2 class="modal-title">üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã ITSM Operations</h2><button class="modal-close" onclick="closeRules()">√ó</button></div>
        <div class="instructions">
            <h3>üéØ –¶–µ–ª—å –∏–≥—Ä—ã</h3>
            <p>–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ IT –≤ —Ç–µ—á–µ–Ω–∏–µ <strong>10 –¥–Ω–µ–π</strong>, —Ä–µ—à–∞—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã, –≤—ã—è–≤–ª—è—è –ø—Ä–æ–±–ª–µ–º—ã, –≤–Ω–µ–¥—Ä—è—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Ä–∞–∑–≤–∏–≤–∞—è –±–∞–∑—É –∑–Ω–∞–Ω–∏–π. <strong>–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏!</strong></p>
            
            <h3>üìÖ –ú–µ—Ö–∞–Ω–∏–∫–∞ –¥–Ω–µ–π</h3>
            <ul>
                <li>–ò–≥—Ä–∞ –¥–ª–∏—Ç—Å—è <strong>10 –¥–Ω–µ–π</strong></li>
                <li>–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî <strong>3 –º–∏–Ω—É—Ç—ã</strong> –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á</li>
                <li><strong>‚è∞ –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è!</strong> (-50 –æ—á–∫–æ–≤ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ SLA)</li>
                <li><strong>–í—Å–µ –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å</strong> —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —à—Ç—Ä–∞—Ñ–∞–º–∏:</li>
                <li style="margin-left:20px">üö® <strong>–°—Ä–æ—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> ‚Äî —à—Ç—Ä–∞—Ñ -30 –æ—á–∫–æ–≤</li>
                <li style="margin-left:20px">‚ö° <strong>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> ‚Äî —à—Ç—Ä–∞—Ñ -15 –æ—á–∫–æ–≤</li>
                <li style="margin-left:20px">üî• <strong>–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –ë–ï–ó workaround</strong> ‚Äî —à—Ç—Ä–∞—Ñ -20 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–π</li>
                <li style="margin-left:20px">üîß <strong>–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –° workaround</strong> ‚Äî –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –±–µ–∑ —à—Ç—Ä–∞—Ñ–∞ (–±–æ–Ω—É—Å -2 –∫ –ø–æ—Ä–æ–≥—É)</li>
                <li style="margin-left:20px">üìÖ <strong>–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</strong> ‚Äî –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –±–µ–∑ —à—Ç—Ä–∞—Ñ–∞</li>
                <li style="margin-left:20px">üîç <strong>–ü—Ä–æ–±–ª–µ–º—ã</strong> ‚Äî —É–¥–∞–ª—è—é—Ç—Å—è (—Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–µ—Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º–∏)</li>
                <li>–î–µ–Ω—å —Ç–∞–∫–∂–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–µ–Ω—ã –¥–æ—Å—Ä–æ—á–Ω–æ</li>
            </ul>
            
            <h3>üé≤ –ú–µ—Ö–∞–Ω–∏–∫–∞ –±—Ä–æ—Å–∫–æ–≤ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏</h3>
            <p>–£—Å–ø–µ—Ö –º–Ω–æ–≥–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –±—Ä–æ—Å–∫–æ–º –¥–≤—É—Ö –∫—É–±–∏–∫–æ–≤ (2-12). <strong>–í–∞–∂–Ω–æ:</strong> –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è 6, 7, 8 (–æ–∫–æ–ª–æ 44% –≤—Å–µ—Ö –±—Ä–æ—Å–∫–æ–≤). –ù–∞ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ —É–∫–∞–∑–∞–Ω —Ç—Ä–µ–±—É–µ–º—ã–π –ø–æ—Ä–æ–≥ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞:</p>
            <ul>
                <li><strong>Critical</strong> ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è 10+ (~17% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞)</li>
                <li><strong>High</strong> ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è 9+ (~28% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞)</li>
                <li><strong>Medium</strong> ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è 7+ (~58% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞)</li>
                <li><strong>Low</strong> ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è 5+ (~83% —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞)</li>
            </ul>
            
            <h3>‚ö†Ô∏è –ß–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π</h3>
            <p><strong>–ù–µ–ª—å–∑—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–¥—Ä—è–¥!</strong> –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã –¥–æ–ª–∂–Ω—ã –ª–∏–±–æ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∑–∞—è–≤–∫—É, –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ç–æ–π –∂–µ –∑–∞—è–≤–∫–∏. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∞—Å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–ª–∏—á–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ—à–µ–Ω–∏—é –∑–∞–¥–∞—á.</p>
            
            <h3>üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–º–µ—Ö–∞–Ω–∏–∫–∞ –ø–æ–∏—Å–∫–∞)</h3>
            <p><strong>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤!</strong> –ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ:</p>
            <ul>
                <li><strong>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîç –ò—Å–∫–∞—Ç—å –≤ KB"</strong> –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</li>
                <li>–û—Ç–∫—Ä–æ–µ—Ç—Å—è –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ —Å–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å—Ç–∞—Ç—å—è–º–∏</li>
                <li>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–µ–≥–∏ –∑–∞—è–≤–∫–∏ –∏ —Ç–µ–≥–∏ —Å—Ç–∞—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: vpn, —Å–µ—Ç—å, network)</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç–∞—Ç—å—é ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –±–æ–Ω—É—Å -2 –∫ –ø–æ—Ä–æ–≥—É</li>
                <li>–ï—Å–ª–∏ –≤—ã–±–µ—Ä–µ—Ç–µ –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç–∞—Ç—å—é ‚Äî –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å KB!</li>
                <li><strong>–¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —à–∞–Ω—Å –Ω–∞ –∑–∞—è–≤–∫—É!</strong> –ß–∏—Ç–∞–π—Ç–µ —Ç–µ–≥–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.</li>
                <li>–°–ø—Ä–∞–≤–∞ –≤ –ø–∞–Ω–µ–ª–∏ —Å—Ç–∞—Ç—å–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏</li>
            </ul>
            
            <h3>üîó –°–∏—Å—Ç–µ–º–∞ —Å–≤—è–∑–µ–π (–∫–ª—é—á–µ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞)</h3>
            <div class="flow-diagram">
                <div class="flow-box flow-incident">üî• –ò–Ω—Ü–∏–¥–µ–Ω—Ç</div>
                <div class="flow-arrow">‚Üì –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã ‚Üì</div>
                <div class="flow-box flow-problem">üîç –ü—Ä–æ–±–ª–µ–º–∞</div>
                <div class="flow-arrow">‚Üì –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã ‚Üì</div>
                <div class="flow-box flow-change">‚öôÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏–µ</div>
                <div class="flow-arrow">‚Üì –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üì</div>
                <div class="flow-box flow-kb">üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</div>
            </div>
            <ul>
                <li><strong>–ò–Ω—Ü–∏–¥–µ–Ω—Ç ‚Üí –ü—Ä–æ–±–ª–µ–º–∞:</strong> –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ (+15 –æ—á–∫–æ–≤ –∑–∞ —Å–≤—è–∑—å)</li>
                <li><strong>–ü—Ä–æ–±–ª–µ–º–∞ ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ:</strong> –°–æ–∑–¥–∞–π—Ç–µ RFC –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã (+20 –æ—á–∫–æ–≤)</li>
                <li><strong>–ü—Ä–æ–±–ª–µ–º–∞ ‚Üí KB:</strong> –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ä–µ—à–µ–Ω–∏–µ (+10 –æ—á–∫–æ–≤)</li>
                <li><strong>–ù–µ—É–¥–∞—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí –ò–Ω—Ü–∏–¥–µ–Ω—Ç:</strong> –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç!</li>
            </ul>
            
            <div class="process-card incident">
                <strong>üî• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º–∏</strong>
                <ul>
                    <li><strong>üîç –ò—Å–∫–∞—Ç—å –≤ KB</strong> ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π, –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â—É—é —Å—Ç–∞—Ç—å—é (-2 –∫ –ø–æ—Ä–æ–≥—É)</li>
                    <li><strong>–†–µ—à–∏—Ç—å</strong> ‚Äî –±—Ä–æ—Å–æ–∫ –∫–æ—Å—Ç–µ–π –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞</li>
                    <li><strong>–≠—Å–∫–∞–ª–∏—Ä–æ–≤–∞—Ç—å</strong> ‚Äî –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ 2 –ª–∏–Ω–∏—é (+1 –º–∏–Ω, -10 –æ—á–∫–æ–≤)</li>
                    <li><strong>Workaround</strong> ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (-10 –æ—á–∫–æ–≤). –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç! –ò–Ω—Ü–∏–¥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥. –¥–µ–Ω—å —Å –±–æ–Ω—É—Å–æ–º -2 –∫ –ø–æ—Ä–æ–≥—É</li>
                    <li><strong>‚Üí –ü—Ä–æ–±–ª–µ–º–∞</strong> ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É</li>
                </ul>
                <p style="margin-top:8px;color:var(--warning);font-size:0.9em">üí° –ò—â–∏—Ç–µ —Å—Ç–∞—Ç—å–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —à–∞–Ω—Å –Ω–∞ –∑–∞—è–≤–∫—É!</p>
            </div>
            
            <div class="process-card problem">
                <strong>üîç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–∞–º–∏</strong>
                <ul>
                    <li><strong>RCA –∞–Ω–∞–ª–∏–∑</strong> ‚Äî –Ω–∞–π—Ç–∏ –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É (—Å–ª–æ–∂–Ω–æ!)</li>
                    <li><strong>Workaround</strong> ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (+5 –æ—á–∫–æ–≤ –≤ KB)</li>
                    <li><strong>‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ</strong> ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–π RFC <span style="color:var(--success)">‚úì –¢–∞–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–µ–≥—á–µ –≤–Ω–µ–¥—Ä–∏—Ç—å (–ø–æ—Ä–æ–≥ 5+)!</span></li>
                    <li><strong>‚Üí –°—Ç–∞—Ç—å—è KB</strong> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π</li>
                </ul>
            </div>
            
            <div class="process-card change">
                <strong>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏</strong>
                <p><strong>–¢—Ä–∏ —Ç–∏–ø–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:</strong></p>
                <ul>
                    <li><strong>üö® –°—Ä–æ—á–Ω—ã–µ (Emergency)</strong> ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫—Ä—ã—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è! –®—Ç—Ä–∞—Ñ -30 –æ—á–∫–æ–≤. –ë–µ–∑ CAB!</li>
                    <li><strong>‚ö° –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (Standard)</strong> ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫—Ä—ã—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è! –®—Ç—Ä–∞—Ñ -15 –æ—á–∫–æ–≤. –ë–µ–∑ CAB!</li>
                    <li><strong>üìÖ –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ (Normal)</strong> ‚Äî –º–æ–≥—É—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å. –¢—Ä–µ–±—É—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è CAB.</li>
                </ul>
                <p style="margin-top:8px"><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:</strong></p>
                <ul>
                    <li><strong>‚úì –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–±–ª–µ–º (–ø–æ—Å–ª–µ RCA)</strong> ‚Äî –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä–æ–≥ <strong>5+</strong> (~83% —É—Å–ø–µ—Ö–∞), —Ç–∞–∫ –∫–∞–∫ –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞!</li>
                </ul>
                <p style="margin-top:8px"><strong>–î–µ–π—Å—Ç–≤–∏—è:</strong></p>
                <ul>
                    <li><strong>–û—Ü–µ–Ω–∏—Ç—å —Ä–∏—Å–∫–∏</strong> ‚Äî —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ä–æ–≥ (-2) –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤</li>
                    <li><strong>–í–Ω–µ–¥—Ä–∏—Ç—å</strong> ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–±—Ä–æ—Å–æ–∫ –∫–æ—Å—Ç–µ–π)</li>
                    <li><strong>CAB</strong> ‚Äî —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ (+–≤—Ä–µ–º—è, -2 –∫ –ø–æ—Ä–æ–≥—É) <span style="color:var(--warning)">—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π!</span></li>
                    <li><strong>–û—Ç–∫–∞—Ç–∏—Ç—å</strong> ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ (-20 –æ—á–∫–æ–≤)</li>
                    <li><strong>‚ö†Ô∏è –ü—Ä–æ–≤–∞–ª —Å–æ–∑–¥–∞—ë—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç!</strong></li>
                </ul>
            </div>
            
            <h3>üèÜ –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤</h3>
            <ul>
                <li>–†–µ—à—ë–Ω–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç: <strong>10-30 –æ—á–∫–æ–≤</strong> (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)</li>
                <li>–£—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: <strong>50 –æ—á–∫–æ–≤</strong></li>
                <li>–í–Ω–µ–¥—Ä—ë–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: <strong>30 –æ—á–∫–æ–≤</strong></li>
                <li>–°—Ç–∞—Ç—å—è –≤ KB: <strong>5-10 –æ—á–∫–æ–≤</strong></li>
                <li><strong>–ë–æ–Ω—É—Å –∑–∞ —Å–≤—è–∑—å: +10-20 –æ—á–∫–æ–≤</strong></li>
                <li>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Workaround: <strong>-10 –æ—á–∫–æ–≤</strong> (–Ω–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥. –¥–µ–Ω—å —Å –±–æ–Ω—É—Å–æ–º)</li>
                <li>–≠—Å–∫–∞–ª–∞—Ü–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞: <strong>-10 –æ—á–∫–æ–≤</strong> (+1 –º–∏–Ω—É—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏)</li>
                <li>–ù–∞—Ä—É—à–µ–Ω–∏–µ SLA (—Ç–∞–π–º-–∞—É—Ç): <strong>-50 –æ—á–∫–æ–≤</strong></li>
                <li><strong>–ù–µ –∑–∞–∫—Ä—ã—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç –±–µ–∑ workaround –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è: -20 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–π</strong></li>
                <li><strong>–ù–µ –∑–∞–∫—Ä—ã—Ç–æ —Å—Ä–æ—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: -30 –æ—á–∫–æ–≤</strong></li>
                <li><strong>–ù–µ –∑–∞–∫—Ä—ã—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: -15 –æ—á–∫–æ–≤</strong></li>
                <li>–û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è: <strong>-20 –æ—á–∫–æ–≤</strong></li>
            </ul>
        </div>
    </div>
</div>

<!-- –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã -->
<div class="game-over" id="gameOver">
    <h1>üèÜ –ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê!</h1>
    <p style="font-size:1.2em;color:var(--text-secondary);margin-bottom:20px">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é IT-—Å–ª—É–∂–±–æ–π!</p>
    <div class="final-stats">
        <div class="final-stat"><div class="final-stat-value stat-incident" id="fInc">0</div><div class="final-stat-label">–ò–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤</div></div>
        <div class="final-stat"><div class="final-stat-value stat-problem" id="fPrb">0</div><div class="final-stat-label">–ü—Ä–æ–±–ª–µ–º</div></div>
        <div class="final-stat"><div class="final-stat-value stat-change" id="fChg">0</div><div class="final-stat-label">–ò–∑–º–µ–Ω–µ–Ω–∏–π</div></div>
        <div class="final-stat"><div class="final-stat-value" style="color:#bb8fce" id="fLinks">0</div><div class="final-stat-label">–°–≤—è–∑–µ–π</div></div>
    </div>
    <div style="background:var(--bg-card);border-radius:16px;padding:25px;margin:15px 0">
        <p style="color:var(--text-secondary)">–ò–¢–û–ì–û–í–´–ô –°–ß–Å–¢</p>
        <p style="font-size:4em;font-weight:700;color:var(--success)" id="fScore">0</p>
        <p>SLA: <span id="fSla">100%</span></p>
    </div>
    <button class="btn btn-start" style="padding:15px 50px;font-size:1.1em" onclick="resetGame();document.getElementById('gameOver').style.display='none'">üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
</div>

<script>
// –î–∞–Ω–Ω—ã–µ
const INC_TEMPLATES = [
    {title:"–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—á—Ç–∞",tags:["–ø–æ—á—Ç–∞","email"],cat:"Email"},
    {title:"–ü—Ä–∏–Ω—Ç–µ—Ä –Ω–µ –ø–µ—á–∞—Ç–∞–µ—Ç",tags:["–ø—Ä–∏–Ω—Ç–µ—Ä","hardware"],cat:"Hardware"},
    {title:"–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä",tags:["–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å","desktop"],cat:"Desktop"},
    {title:"–û—à–∏–±–∫–∞ CRM —Å–∏—Å—Ç–µ–º—ã",tags:["crm","—Å–µ—Ä–≤–∏—Å","application"],cat:"Application"},
    {title:"VPN –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è",tags:["vpn","—Å–µ—Ç—å","network"],cat:"Network"},
    {title:"–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É",tags:["–ª–æ–≥–∏–Ω","–ø–∞—Ä–æ–ª—å","access"],cat:"Access"},
    {title:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É",tags:["—Å–µ—Ä–≤–µ—Ä","—Å–µ—Ç—å","network"],cat:"Network"},
    {title:"–ó–∞–≤–∏—Å–∞–µ—Ç 1–°",tags:["1—Å","—Å–µ—Ä–≤–∏—Å","application"],cat:"Application"},
    {title:"–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º—ã—à—å",tags:["–ø–µ—Ä–∏—Ñ–µ—Ä–∏—è","hardware"],cat:"Hardware"},
    {title:"–°–∏–Ω–∏–π —ç–∫—Ä–∞–Ω BSOD",tags:["–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π","desktop"],cat:"Desktop"}
];
const PRB_TEMPLATES = [
    {title:"–ß–∞—Å—Ç—ã–µ –ø–∞–¥–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞",tags:["—Å–µ—Ä–≤–µ—Ä"],impact:"High"},
    {title:"–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ –≤ ERP",tags:["erp"],impact:"Medium"},
    {title:"–ü—Ä–æ–±–ª–µ–º—ã VPN –ø–æ—Å–ª–µ –∞–ø–¥–µ–π—Ç–∞",tags:["vpn"],impact:"High"},
    {title:"–°–±–æ–∏ –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞",tags:["–ø–æ—á—Ç–∞"],impact:"Critical"},
    {title:"–î–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ë–î",tags:["–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö"],impact:"High"}
];
const CHG_TEMPLATES = [
    {title:"–≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞",risk:"High",type:"Emergency"},
    {title:"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—á –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏",risk:"High",type:"Emergency"},
    {title:"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞",risk:"Low",type:"Standard"},
    {title:"–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",risk:"Low",type:"Standard"},
    {title:"–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Windows",risk:"Low",type:"Standard"},
    {title:"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –û–°",risk:"Medium",type:"Normal"},
    {title:"–ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ—á—Ç—ã –≤ –æ–±–ª–∞–∫–æ",risk:"High",type:"Normal"},
    {title:"–ó–∞–º–µ–Ω–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è",risk:"High",type:"Normal"},
    {title:"–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–∏—Å–∫–æ–≤",risk:"Medium",type:"Normal"},
    {title:"–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ERP —Å–∏—Å—Ç–µ–º—ã",risk:"High",type:"Normal"}
];
const PRIORITIES = ["Critical","High","Medium","Low"];
const THRESHOLDS = {Critical:10,High:9,Medium:7,Low:5};
const POINTS = {Critical:30,High:20,Medium:15,Low:10};

// –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Å —Ç–µ–≥–∞–º–∏ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
const KB_BASE = [
    {title:"–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–∞", tags:["—Å–µ—Ä–≤–∏—Å","crm","1—Å","–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å","application"]},
    {title:"–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è", tags:["–ø–∞—Ä–æ–ª—å","–ª–æ–≥–∏–Ω","–¥–æ—Å—Ç—É–ø","access"]},
    {title:"VPN –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ", tags:["vpn","—Å–µ—Ç—å","network","–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"]},
    {title:"–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫ –ø—Ä–∏–Ω—Ç–µ—Ä–∞", tags:["–ø—Ä–∏–Ω—Ç–µ—Ä","–ø–µ—á–∞—Ç—å","hardware"]},
    {title:"–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ü–ö", tags:["–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å","desktop","–º–µ–¥–ª–µ–Ω–Ω—ã–π"]},
];

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
let G = {
    turn:0, maxTurns:10, score:0, slaBreaches:0, totalTickets:0,
    inc:{resolved:0,total:0}, prb:{resolved:0,total:0}, chg:{deployed:0,total:0},
    kbArticles:[], linksCount:0,
    tickets:[], selected:null, timer:180, timerInt:null,
    diceResult:0, kbUsed:false, assessed:false, currentAction:null,
    lastAction:null, // –ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤
    links:[] // {from, to, type}
};
let ticketCounter = {INC:0, PRB:0, CHG:0};

// –£—Ç–∏–ª–∏—Ç—ã
function rnd(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
function time() { const d=new Date(); return `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`; }

function log(msg, type='info') {
    const el = document.getElementById('log');
    const e = document.createElement('div');
    e.className = `log-entry ${type}`;
    e.innerHTML = `<span class="log-time">${time()}</span> ‚Äî ${msg}`;
    el.insertBefore(e, el.firstChild);
    while(el.children.length > 25) el.removeChild(el.lastChild);
}

function updateStats() {
    document.getElementById('turn').textContent = G.turn;
    document.getElementById('statInc').textContent = G.inc.resolved;
    document.getElementById('statPrb').textContent = G.prb.resolved;
    document.getElementById('statChg').textContent = G.chg.deployed;
    document.getElementById('statKb').textContent = G.kbArticles.length;
    document.getElementById('statLinks').textContent = G.linksCount;
    document.getElementById('score').textContent = G.score;
    document.getElementById('sla').textContent = Math.max(0,100-G.slaBreaches*10)+'%';
}

function updateTimer() {
    const m = Math.floor(G.timer/60), s = G.timer%60;
    document.getElementById('timerText').textContent = `SLA: ${m}:${String(s).padStart(2,'0')}`;
    const el = document.getElementById('slaTimer');
    el.className = G.timer<=60 ? 'sla-timer danger' : G.timer<=120 ? 'sla-timer warning' : 'sla-timer';
}

function startTimer() {
    G.timer = 180; updateTimer();
    G.timerInt = setInterval(()=>{
        G.timer--;
        updateTimer();
        if(G.timer<=0) { 
            clearInterval(G.timerInt);
            G.slaBreaches++; 
            G.score-=50; 
            log('‚è∞ –í—Ä–µ–º—è –¥–Ω—è –∏—Å—Ç–µ–∫–ª–æ! -50 –æ—á–∫–æ–≤. –î–µ–Ω—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è...','error'); 
            updateStats();
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
            setTimeout(() => nextRound(), 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
        }
    },1000);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫
function createTicket(type, template, parentId=null) {
    let t;
    if(type==='incident') {
        ticketCounter.INC++;
        const tpl = template || rnd(INC_TEMPLATES);
        t = {
            id:`INC-${String(ticketCounter.INC).padStart(4,'0')}`,
            type:'incident', title:tpl.title, tags:tpl.tags, cat:tpl.cat,
            priority:rnd(PRIORITIES), status:'Open', parentId, childIds:[],
            hasWorkaround: false, // –§–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è workaround
            createdDay: G.turn // –î–µ–Ω—å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
        };
        G.inc.total++;
    } else if(type==='problem') {
        ticketCounter.PRB++;
        const tpl = template || rnd(PRB_TEMPLATES);
        t = {
            id:`PRB-${String(ticketCounter.PRB).padStart(4,'0')}`,
            type:'problem', title:tpl.title, tags:tpl.tags, impact:tpl.impact||'Medium',
            priority:tpl.impact==='Critical'?'Critical':tpl.impact==='High'?'High':'Medium',
            status:'Investigation', parentId, childIds:[]
        };
        G.prb.total++;
    } else {
        ticketCounter.CHG++;
        const tpl = template || rnd(CHG_TEMPLATES);
        t = {
            id:`CHG-${String(ticketCounter.CHG).padStart(4,'0')}`,
            type:'change', title:tpl.title, risk:tpl.risk||'Medium', changeType:tpl.type||'Normal',
            priority:tpl.risk==='High'?'High':tpl.risk==='Medium'?'Medium':'Low',
            status:'Pending', parentId, childIds:[],
            createdDay: G.turn // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –¥–µ–Ω—å —Å–æ–∑–¥–∞–Ω–∏—è
        };
        G.chg.total++;
    }
    G.tickets.push(t);
    G.totalTickets++;
    return t;
}

function createLink(from, to, type) {
    G.links.push({from:from.id, to:to.id, type});
    G.linksCount++;
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑–∏ –≤ –∑–∞—è–≤–∫–∞—Ö
    if(from.childIds) from.childIds.push(to.id);
    to.parentId = from.id;
    updateLinksMap();
    log(`üîó –°–æ–∑–¥–∞–Ω–∞ —Å–≤—è–∑—å: ${from.id} ‚Üí ${to.id}`, 'link');
}

function generateTickets() {
    const count = 3 + Math.floor(Math.random()*3);
    for(let i=0; i<count; i++) {
        const r = Math.random();
        if(r<0.5) createTicket('incident');
        else if(r<0.75) createTicket('problem');
        else {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–æ–≤
            const changeRand = Math.random();
            let template;
            if(changeRand < 0.2) {
                // 20% - —Å—Ä–æ—á–Ω—ã–µ
                template = CHG_TEMPLATES.filter(t => t.type === 'Emergency');
                template = rnd(template);
            } else if(changeRand < 0.5) {
                // 30% - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
                template = CHG_TEMPLATES.filter(t => t.type === 'Standard');
                template = rnd(template);
            } else {
                // 50% - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ
                template = CHG_TEMPLATES.filter(t => t.type === 'Normal');
                template = rnd(template);
            }
            createTicket('change', template);
        }
    }
    renderQueue();
}

function renderQueue() {
    const q = document.getElementById('queue');
    if(G.tickets.length===0) {
        q.innerHTML = '<div class="empty-msg">‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–µ–Ω—ã! –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –Ω–∞—á–Ω—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏...</div>';
        return;
    }
    q.innerHTML = '';
    G.tickets.forEach(t => {
        const el = document.createElement('div');
        el.className = `ticket ${t.type}`;
        el.onclick = () => selectTicket(t);
        const icon = t.type==='incident'?'üî•':t.type==='problem'?'üîç':'‚öôÔ∏è';
        const pCls = `priority-${t.priority.toLowerCase()}`;
        
        // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ—Ä–æ–≥ –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        const threshold = THRESHOLDS[t.priority];
        let thresholdClass = 'easy';
        let probability = '';
        if(threshold >= 10) { 
            thresholdClass = 'hard'; 
            probability = '(~17%)';
        } else if(threshold >= 9) { 
            thresholdClass = 'hard'; 
            probability = '(~28%)';
        } else if(threshold >= 7) { 
            thresholdClass = 'medium'; 
            probability = '(~58%)';
        } else { 
            thresholdClass = 'easy'; 
            probability = '(~83%)';
        }
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–≤—è–∑–∏
        let linksHtml = '';
        if(t.parentId || (t.childIds && t.childIds.length)) {
            linksHtml = '<div class="ticket-links">';
            if(t.parentId) linksHtml += `<span class="link link-parent">‚Üê ${t.parentId}</span>`;
            if(t.childIds) t.childIds.forEach(c => linksHtml += `<span class="link link-child">‚Üí ${c}</span>`);
            linksHtml += '</div>';
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        let changeTypeHtml = '';
        if(t.type === 'change') {
            const typeClass = t.changeType === 'Emergency' ? 'type-emergency' : t.changeType === 'Standard' ? 'type-standard' : 'type-normal';
            const typeLabel = t.changeType === 'Emergency' ? 'üö® –°—Ä–æ—á–Ω–æ–µ' : t.changeType === 'Standard' ? '‚ö° –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ' : 'üìÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ';
            const daysOld = G.turn - (t.createdDay || G.turn);
            const daysText = daysOld > 0 ? ` (–î–µ–Ω—å ${daysOld + 1})` : '';
            changeTypeHtml = `<span class="change-type ${typeClass}">${typeLabel}${daysText}</span>`;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ –ø—Ä–æ–±–ª–µ–º
            if(t.fromProblem) {
                changeTypeHtml += `<span class="change-type type-standard" style="background:rgba(39,174,96,0.3)">‚úì –ü–æ—Å–ª–µ RCA (5+)</span>`;
            }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä workaround –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
        let workaroundHtml = '';
        if(t.type === 'incident' && t.hasWorkaround) {
            const daysOld = G.turn - (t.createdDay || G.turn);
            const daysText = daysOld > 0 ? ` (–î–µ–Ω—å ${daysOld + 1})` : '';
            workaroundHtml = `<span class="change-type type-standard">üîß Workaround${daysText}</span>`;
        }
        
        el.innerHTML = `
            <span class="ticket-icon">${icon}</span>
            <div class="ticket-id">${t.id} ${changeTypeHtml}${workaroundHtml}</div>
            <div class="ticket-title">${t.title}</div>
            <span class="priority ${pCls}">${t.priority}</span>
            <div class="ticket-threshold ${thresholdClass}">üé≤ –£—Å–ø–µ—Ö: ${threshold}+ ${probability}</div>
            ${linksHtml}
        `;
        q.appendChild(el);
    });
}

function selectTicket(t) {
    G.selected = t;
    G.kbUsed = false;
    G.assessed = false;
    G.lastAction = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
    document.querySelectorAll('.ticket').forEach(el=>el.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById('selectedId').textContent = `${t.id} - ${t.title}`;
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å KB –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
    document.getElementById('kbStatus').style.display = 'none';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–≥–∏ –∑–∞—è–≤–∫–∏
    const ticketInfoEl = document.getElementById('ticketInfo');
    const tagsText = t.tags ? t.tags.join(', ') : t.cat || '–æ–±—â–∞—è';
    if(t.type === 'incident') {
        if(t.hasWorkaround) {
            const daysOld = G.turn - (t.createdDay || G.turn);
            ticketInfoEl.innerHTML = `üîß Workaround –ø—Ä–∏–º–µ–Ω—ë–Ω (–î–µ–Ω—å ${daysOld + 1}). –ë–æ–Ω—É—Å -2 –∫ –ø–æ—Ä–æ–≥—É! üè∑Ô∏è –¢–µ–≥–∏: <strong>${tagsText}</strong>`;
        } else {
            ticketInfoEl.innerHTML = `üè∑Ô∏è –¢–µ–≥–∏: <strong>${tagsText}</strong> ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ "üîç –ò—Å–∫–∞—Ç—å –≤ KB" –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ—à–µ–Ω–∏—è!`;
        }
        document.getElementById('kbHint').style.display = t.hasWorkaround ? 'none' : 'block';
    } else if(t.type === 'change') {
        const daysOld = G.turn - (t.createdDay || G.turn);
        const daysText = daysOld > 0 ? ` (–î–µ–Ω—å ${daysOld + 1})` : '';
        let urgencyText = '';
        if(t.changeType === 'Emergency') {
            urgencyText = `<span style="color:var(--danger)">‚ö†Ô∏è –°–†–û–ß–ù–û–ï! –ó–∞–∫—Ä—ã—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è –∏–ª–∏ -30 –æ—á–∫–æ–≤!</span>`;
        } else if(t.changeType === 'Standard') {
            urgencyText = `<span style="color:var(--warning)">‚ö° –°–¢–ê–ù–î–ê–†–¢–ù–û–ï! –ó–∞–∫—Ä—ã—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è –∏–ª–∏ -15 –æ—á–∫–æ–≤!</span>`;
        } else {
            urgencyText = `üìÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ${daysText} ‚Äî –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å`;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∏–∑ –ø—Ä–æ–±–ª–µ–º
        if(t.fromProblem) {
            urgencyText += `<br><span style="color:var(--success)">‚úì –°–æ–∑–¥–∞–Ω–æ –ø–æ—Å–ª–µ RCA ‚Äî –ª–µ–≥—á–µ –≤–Ω–µ–¥—Ä–∏—Ç—å (–ø–æ—Ä–æ–≥ 5+, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ~83%)</span>`;
        }
        
        ticketInfoEl.innerHTML = `${urgencyText}`;
        document.getElementById('kbHint').style.display = 'none';
    } else {
        ticketInfoEl.innerHTML = `üè∑Ô∏è –¢–µ–≥–∏: <strong>${tagsText}</strong>`;
        document.getElementById('kbHint').style.display = 'none';
    }
    
    document.getElementById('incActions').style.display = t.type==='incident'?'grid':'none';
    document.getElementById('prbActions').style.display = t.type==='problem'?'grid':'none';
    document.getElementById('chgActions').style.display = t.type==='change'?'grid':'none';
    
    // –£–ø—Ä–∞–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ CAB (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    if(t.type === 'change') {
        const cabBtn = document.querySelector('.btn-cab');
        if(cabBtn) {
            if(t.changeType === 'Normal') {
                cabBtn.disabled = false;
            } else {
                cabBtn.disabled = true;
                cabBtn.title = 'CAB –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π';
            }
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ KB —Å—Ç–∞—Ç–µ–π —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö
    renderKbList();
    
    log(`üìã –í—ã–±—Ä–∞–Ω–∞ –∑–∞—è–≤–∫–∞ ${t.id}`, 'info');
}

function getThreshold() {
    // –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–±–ª–µ–º –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ (RCA –ø—Ä–æ–≤–µ–¥–µ–Ω)
    if(G.selected.type === 'change' && G.selected.fromProblem) {
        return 5; // –õ–µ–≥—á–µ –≤–Ω–µ–¥—Ä–∏—Ç—å, —Ç–∞–∫ –∫–∞–∫ –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω–∞
    }
    
    let th = THRESHOLDS[G.selected.priority];
    if(G.kbUsed) th -= 2;
    if(G.assessed) th -= 2;
    if(G.selected.hasWorkaround) th -= 2; // –ë–æ–Ω—É—Å –æ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–≥–æ workaround
    return Math.max(2, th);
}

// –î–µ–π—Å—Ç–≤–∏—è
function doAction(action) {
    if(!G.selected) return;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    if(G.lastAction === action) {
        alert(`‚ùå –ù–µ–ª—å–∑—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–¥—Ä—è–¥!\n–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥—Ä—É–≥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é –∑–∞—è–≤–∫—É.`);
        log(`‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è "${action}" –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞`, 'warning');
        return;
    }
    
    G.currentAction = action;
    
    switch(action) {
        case 'resolve':
        case 'rca':
        case 'implement':
            showDiceModal(action);
            break;
        case 'escalate':
            G.timer += 60; updateTimer();
            G.score -= 10;
            log(`‚¨ÜÔ∏è ${G.selected.id} —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞–Ω (+1 –º–∏–Ω, -10 –æ—á–∫–æ–≤)`, 'warning');
            G.lastAction = action;
            removeTicket(); updateStats(); checkRound();
            break;
        case 'searchKb':
            showKbSearch();
            G.lastAction = action;
            break;
        case 'workaround':
            // Workaround –Ω–µ —Ä–µ—à–∞–µ—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç, –∞ –ª–∏—à—å —Å–Ω–∏–∂–∞–µ—Ç –µ–≥–æ –≤–ª–∏—è–Ω–∏–µ
            G.selected.hasWorkaround = true;
            G.selected.status = 'Workaround Applied';
            G.score -= 10;
            log(`üîß Workaround –ø—Ä–∏–º–µ–Ω—ë–Ω –¥–ª—è ${G.selected.id} (-10 –æ—á–∫–æ–≤). –ò–Ω—Ü–∏–¥–µ–Ω—Ç –ø–µ—Ä–µ–π–¥–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å —Å –±–æ–Ω—É—Å–æ–º –∫ —Ä–µ—à–µ–Ω–∏—é.`, 'warning');
            G.lastAction = action;
            updateStats();
            renderQueue();
            break;
        case 'createProblem':
            const prb = createTicket('problem', {title:`–ü—Ä–æ–±–ª–µ–º–∞: ${G.selected.title}`, tags:G.selected.tags, impact:'Medium'});
            createLink(G.selected, prb, 'incident‚Üíproblem');
            G.score += 15;
            log(`üîç –°–æ–∑–¥–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ ${prb.id} –∏–∑ ${G.selected.id} (+15 –∑–∞ —Å–≤—è–∑—å)`, 'success');
            addKnownError(prb);
            G.lastAction = action;
            removeTicket(); updateStats(); renderQueue(); checkRound();
            break;
        case 'docWorkaround':
            G.score += 5;
            addKbArticle(`Workaround: ${G.selected.title}`, G.selected.tags);
            log(`üìù –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω workaround –¥–ª—è ${G.selected.id} (+5)`, 'success');
            G.lastAction = action;
            updateStats();
            break;
        case 'createChange':
            // –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ –ø—Ä–æ–±–ª–µ–º –≤—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
            const chg = createTicket('change', {title:`Fix: ${G.selected.title}`, risk:'Medium', type:'Normal'});
            chg.fromProblem = true; // –§–ª–∞–≥, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –∏–∑ –ø—Ä–æ–±–ª–µ–º—ã (–ª–µ–≥—á–µ –≤–Ω–µ–¥—Ä–∏—Ç—å)
            createLink(G.selected, chg, 'problem‚Üíchange');
            G.score += 20;
            log(`‚öôÔ∏è –°–æ–∑–¥–∞–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ${chg.id} –∏–∑ ${G.selected.id} (+20 –∑–∞ —Å–≤—è–∑—å, –ª–µ–≥—á–µ –≤–Ω–µ–¥—Ä–∏—Ç—å!)`, 'success');
            addScheduledChange(chg);
            G.lastAction = action;
            removeTicket(); updateStats(); renderQueue(); checkRound();
            break;
        case 'createArticle':
            G.score += 10;
            addKbArticle(G.selected.title, G.selected.tags);
            createLink(G.selected, {id:`KB-${G.kbArticles.length}`}, 'problem‚Üíkb');
            log(`üìö –°–æ–∑–¥–∞–Ω–∞ —Å—Ç–∞—Ç—å—è KB –∏–∑ ${G.selected.id} (+10)`, 'success');
            G.lastAction = action;
            updateStats();
            break;
        case 'assess':
            G.assessed = true;
            log(`üìã –†–∏—Å–∫–∏ –æ—Ü–µ–Ω–µ–Ω—ã –¥–ª—è ${G.selected.id} (-2 –∫ –ø–æ—Ä–æ–≥—É)`, 'info');
            G.lastAction = action;
            alert(`–†–∏—Å–∫–∏ –æ—Ü–µ–Ω–µ–Ω—ã!\n–ù–æ–≤—ã–π –ø–æ—Ä–æ–≥: ${getThreshold()}+`);
            break;
        case 'cab':
            // CAB –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            if(G.selected.changeType !== 'Normal') {
                alert('‚ùå CAB –ø—Ä–∏–º–µ–Ω–∏–º —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π!\n\n–°—Ä–æ—á–Ω—ã–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è CAB.');
                return;
            }
            G.assessed = true;
            G.timer += 30; updateTimer();
            log(`üë• CAB —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ${G.selected.id} (+30—Å–µ–∫, -2 –ø–æ—Ä–æ–≥)`, 'info');
            G.lastAction = action;
            break;
        case 'rollback':
            G.score -= 20;
            log(`‚Ü©Ô∏è –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è ${G.selected.id} (-20 –æ—á–∫–æ–≤)`, 'warning');
            G.lastAction = action;
            removeTicket(); updateStats(); checkRound();
            break;
    }
}

function showDiceModal(action) {
    const titles = {resolve:'–†–µ—à–µ–Ω–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞', rca:'RCA –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã', implement:'–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è'};
    document.getElementById('diceModal').style.display = 'block';
    document.getElementById('diceTitle').textContent = titles[action];
    document.getElementById('diceDetails').innerHTML = `
        <div class="detail-row"><span class="detail-label">–ó–∞—è–≤–∫–∞:</span><span class="detail-value">${G.selected.id}</span></div>
        <div class="detail-row"><span class="detail-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</span><span class="detail-value">${G.selected.priority}</span></div>
        <div class="detail-row"><span class="detail-label">–¢—Ä–µ–±—É–µ—Ç—Å—è:</span><span class="detail-value">${getThreshold()}+ –Ω–∞ –∫–æ—Å—Ç—è—Ö</span></div>
        ${G.selected.parentId ? `<div class="detail-row"><span class="detail-label">–°–≤—è–∑–∞–Ω–∞ —Å:</span><span class="detail-value">${G.selected.parentId}</span></div>` : ''}
    `;
    const d1 = document.getElementById('d1');
    const d2 = document.getElementById('d2');
    d1.textContent = 'üé≤';
    d2.textContent = 'üé≤';
    d1.style.cursor = 'pointer'; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
    d2.style.cursor = 'pointer';
    G.diceResult = 0;
    document.getElementById('diceConfirm').disabled = true;
    document.getElementById('diceConfirm').textContent = '–ë—Ä–æ—Å—å—Ç–µ –∫–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)';
}

function rollDice() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—Ä–æ—Å–∞–ª–∏ –ª–∏ —É–∂–µ –∫—É–±–∏–∫–∏
    if(G.diceResult > 0) {
        return; // –£–∂–µ –±—Ä–æ—Å–∞–ª–∏, –Ω–µ –¥–∞–µ–º –ø–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞—Ç—å
    }
    
    const d1 = document.getElementById('d1'), d2 = document.getElementById('d2');
    d1.classList.add('rolling'); d2.classList.add('rolling');
    
    // –£–±–∏—Ä–∞–µ–º –∫—É—Ä—Å–æ—Ä —Å –∫—É–±–∏–∫–æ–≤ –ø–æ—Å–ª–µ –±—Ä–æ—Å–∫–∞
    d1.style.cursor = 'not-allowed';
    d2.style.cursor = 'not-allowed';
    
    setTimeout(()=>{
        const r1 = Math.floor(Math.random()*6)+1, r2 = Math.floor(Math.random()*6)+1;
        d1.textContent = r1; d2.textContent = r2;
        d1.classList.remove('rolling'); d2.classList.remove('rolling');
        G.diceResult = r1+r2;
        const btn = document.getElementById('diceConfirm');
        btn.disabled = false;
        btn.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${G.diceResult} ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å`;
    }, 500);
}

function confirmDice() {
    closeModal();
    const success = G.diceResult >= getThreshold();
    
    if(success) {
        handleSuccess();
    } else {
        handleFailure();
    }
}

function handleSuccess() {
    const t = G.selected;
    switch(G.currentAction) {
        case 'resolve':
            G.inc.resolved++;
            G.score += POINTS[t.priority];
            log(`‚úÖ ${t.id} —Ä–µ—à—ë–Ω! +${POINTS[t.priority]} –æ—á–∫–æ–≤`, 'success');
            G.lastAction = G.currentAction;
            break;
        case 'rca':
            G.prb.resolved++;
            G.score += 50;
            log(`‚úÖ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞ ${t.id} –Ω–∞–π–¥–µ–Ω–∞! +50 –æ—á–∫–æ–≤`, 'success');
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã, –∑–∞–∫—Ä—ã–≤–∞–µ–º –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            if(t.childIds && t.childIds.length) {
                log(`üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–∫—Ä—ã—Ç—ã`, 'link');
            }
            G.lastAction = G.currentAction;
            break;
        case 'implement':
            G.chg.deployed++;
            G.score += 30;
            log(`‚úÖ ${t.id} —É—Å–ø–µ—à–Ω–æ –≤–Ω–µ–¥—Ä—ë–Ω! +30 –æ—á–∫–æ–≤`, 'success');
            // –ï—Å–ª–∏ –±—ã–ª–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–æ–±–ª–µ–º–æ–π, –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–±–ª–µ–º—É
            if(t.parentId && t.parentId.startsWith('PRB')) {
                G.prb.resolved++;
                G.score += 25;
                log(`üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ${t.parentId} —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞! +25 –±–æ–Ω—É—Å`, 'success');
            }
            G.lastAction = G.currentAction;
            break;
    }
    removeTicket();
    updateStats();
    checkRound();
}

function handleFailure() {
    const t = G.selected;
    switch(G.currentAction) {
        case 'resolve':
            log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–µ—à–∏—Ç—å ${t.id}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥.`, 'error');
            G.lastAction = G.currentAction; // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ
            break;
        case 'rca':
            log(`‚ùå RCA ${t.id} –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.`, 'error');
            G.lastAction = G.currentAction; // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ
            break;
        case 'implement':
            log(`‚ùå –í–Ω–µ–¥—Ä–µ–Ω–∏–µ ${t.id} –ø—Ä–æ–≤–∞–ª–∏–ª–æ—Å—å!`, 'error');
            G.score -= 15;
            // –°–æ–∑–¥–∞—ë–º –∏–Ω—Ü–∏–¥–µ–Ω—Ç –∏–∑-–∑–∞ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è!
            const inc = createTicket('incident', {title:`–°–±–æ–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è ${t.id}`, tags:['–∏–∑–º–µ–Ω–µ–Ω–∏–µ'], cat:'System'});
            inc.priority = 'High';
            createLink(t, inc, 'failed_change‚Üíincident');
            log(`üî• –°–æ–∑–¥–∞–Ω –∏–Ω—Ü–∏–¥–µ–Ω—Ç ${inc.id} –∏–∑-–∑–∞ –ø—Ä–æ–≤–∞–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è!`, 'error');
            G.lastAction = G.currentAction;
            removeTicket();
            renderQueue();
            break;
    }
    updateStats();
}

function removeTicket() {
    const idx = G.tickets.indexOf(G.selected);
    if(idx>-1) G.tickets.splice(idx,1);
    G.selected = null;
    document.getElementById('selectedId').textContent = '-';
    document.getElementById('kbHint').style.display = 'none';
    document.getElementById('kbStatus').style.display = 'none';
    renderQueue();
    renderKbList(); // –û–±–Ω–æ–≤–ª—è–µ–º KB, —É–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
}

function checkRound() {
    if(G.tickets.length === 0) {
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ –∑–∞–¥–∞—á–∏ —Ä–µ—à–µ–Ω—ã
        if(G.timerInt) clearInterval(G.timerInt);
        log(`‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –¥–Ω—è —Ä–µ—à–µ–Ω—ã! –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å...`, 'success');
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
        setTimeout(() => nextRound(), 2000);
    }
}

function checkDayEnd() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –∑–∞—è–≤–∫–∏
    const remainingTickets = G.tickets.slice(); // –ö–æ–ø–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    
    // –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã —Å workaround –∏ –±–µ–∑
    const incidentsWithWorkaround = remainingTickets.filter(t => t.type === 'incident' && t.hasWorkaround);
    const incidentsWithoutWorkaround = remainingTickets.filter(t => t.type === 'incident' && !t.hasWorkaround);
    const problems = remainingTickets.filter(t => t.type === 'problem');
    
    // –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –±–µ–∑ workaround - —à—Ç—Ä–∞—Ñ
    if(incidentsWithoutWorkaround.length > 0) {
        G.score -= incidentsWithoutWorkaround.length * 20;
        log(`‚ùå ${incidentsWithoutWorkaround.length} –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –±–µ–∑ workaround –Ω–µ —Ä–µ—à–µ–Ω–æ! -${incidentsWithoutWorkaround.length * 20} –æ—á–∫–æ–≤`, 'error');
    }
    
    // –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã —Å workaround –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
    if(incidentsWithWorkaround.length > 0) {
        log(`üîß ${incidentsWithWorkaround.length} –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ —Å workaround –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ –¥–µ–Ω—å ${G.turn + 1}`, 'warning');
    }
    
    // –ü—Ä–æ–±–ª–µ–º—ã –Ω–µ —Ä–µ—à–µ–Ω—ã
    if(problems.length > 0) {
        log(`‚ö†Ô∏è ${problems.length} –ø—Ä–æ–±–ª–µ–º –Ω–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è`, 'warning');
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ —Å—Ä–æ—á–Ω—ã–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    const urgentChanges = remainingTickets.filter(t => t.type === 'change' && (t.changeType === 'Emergency' || t.changeType === 'Standard'));
    
    if(urgentChanges.length > 0) {
        urgentChanges.forEach(c => {
            if(c.changeType === 'Emergency') {
                G.score -= 30;
                G.slaBreaches++;
                log(`‚ùå –°—Ä–æ—á–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ${c.id} –Ω–µ –∑–∞–∫—Ä—ã—Ç–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è! -30 –æ—á–∫–æ–≤`, 'error');
            } else if(c.changeType === 'Standard') {
                G.score -= 15;
                log(`‚ùå –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ ${c.id} –Ω–µ –∑–∞–∫—Ä—ã—Ç–æ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è! -15 –æ—á–∫–æ–≤`, 'error');
            }
        });
        updateStats();
    }
    
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ –∑–∞—è–≤–∫–∏ –∫—Ä–æ–º–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ —Å workaround
    G.tickets = G.tickets.filter(t => 
        (t.type === 'change' && t.changeType === 'Normal') || 
        (t.type === 'incident' && t.hasWorkaround)
    );
    
    // –ß—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
    const normalChanges = G.tickets.filter(t => t.type === 'change' && t.changeType === 'Normal');
    if(normalChanges.length > 0) {
        log(`üìÖ ${normalChanges.length} –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ –¥–µ–Ω—å ${G.turn + 1}`, 'info');
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—á–µ—Ä–µ–¥—å
    renderQueue();
}

function nextRound() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
    checkDayEnd();
    
    G.turn++;
    if(G.turn > G.maxTurns) { endGame(); return; }
    log(`üîÑ –î–µ–Ω—å ${G.turn} –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...`, 'info');
    document.getElementById('slaTimer').className = 'sla-timer';
    generateTickets();
    updateStats();
    startTimer(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ –¥–Ω—è
}

function startGame() {
    if(G.timerInt) clearInterval(G.timerInt);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–¥–µ—Ç –ª–∏ —É–∂–µ –∏–≥—Ä–∞ (–¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–ª–µ–¥. –¥–µ–Ω—å")
    if(G.turn > 0) {
        // –ò–≥—Ä–∞ —É–∂–µ –∏–¥–µ—Ç, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
        nextRound();
        return;
    }
    
    G = {
        turn:1, maxTurns:10, score:0, slaBreaches:0, totalTickets:0,
        inc:{resolved:0,total:0}, prb:{resolved:0,total:0}, chg:{deployed:0,total:0},
        kbArticles:[...KB_BASE], linksCount:0,
        tickets:[], selected:null, timer:180, timerInt:null,
        diceResult:0, kbUsed:false, assessed:false, currentAction:null,
        lastAction:null,
        links:[]
    };
    ticketCounter = {INC:0, PRB:0, CHG:0};
    updateStats();
    generateTickets();
    startTimer();
    renderKbList();
    document.getElementById('actionsArea').style.display = 'block';
    
    // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –°–¢–ê–†–¢ –Ω–∞ "–°–ª–µ–¥. –¥–µ–Ω—å"
    const startBtn = document.getElementById('startBtn');
    startBtn.textContent = '‚è≠Ô∏è –°–ª–µ–¥. –¥–µ–Ω—å';
    startBtn.title = '–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å (—Å–æ —à—Ç—Ä–∞—Ñ–∞–º–∏)';
    
    log('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –î–µ–Ω—å 1', 'success');
}

function resetGame() {
    if(G.timerInt) clearInterval(G.timerInt);
    G = {
        turn:0, maxTurns:10, score:0, slaBreaches:0, totalTickets:0,
        inc:{resolved:0,total:0}, prb:{resolved:0,total:0}, chg:{deployed:0,total:0},
        kbArticles:[...KB_BASE], linksCount:0,
        tickets:[], selected:null, timer:180, timerInt:null,
        diceResult:0, kbUsed:false, assessed:false, currentAction:null,
        lastAction:null,
        links:[]
    };
    ticketCounter = {INC:0, PRB:0, CHG:0};
    updateStats();
    renderKbList();
    document.getElementById('queue').innerHTML = '<div class="empty-msg">üëÜ –ù–∞–∂–º–∏—Ç–µ –°–¢–ê–†–¢ –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</div>';
    document.getElementById('actionsArea').style.display = 'none';
    document.getElementById('timerText').textContent = 'SLA: 3:00';
    document.getElementById('slaTimer').className = 'sla-timer';
    document.getElementById('log').innerHTML = '<div class="log-entry info"><span class="log-time">00:00</span> ‚Äî –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞</div>';
    document.getElementById('knownErrors').innerHTML = '<div class="empty-msg">–ü–æ–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ</div>';
    document.getElementById('scheduledChanges').innerHTML = '<div class="empty-msg">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö</div>';
    document.getElementById('linksMap').innerHTML = '<div class="empty-msg">–°–≤—è–∑–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</div>';
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –°–¢–ê–†–¢
    const startBtn = document.getElementById('startBtn');
    startBtn.textContent = '‚ñ∂ –°–¢–ê–†–¢';
    startBtn.title = '';
}

function endGame() {
    if(G.timerInt) clearInterval(G.timerInt);
    const sla = Math.max(0,100-G.slaBreaches*10);
    document.getElementById('fInc').textContent = G.inc.resolved;
    document.getElementById('fPrb').textContent = G.prb.resolved;
    document.getElementById('fChg').textContent = G.chg.deployed;
    document.getElementById('fLinks').textContent = G.linksCount;
    document.getElementById('fScore').textContent = G.score;
    document.getElementById('fSla').textContent = sla+'%';
    document.getElementById('gameOver').style.display = 'flex';
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞—Ç—å–∏ KB –∏ –∑–∞—è–≤–∫–∏
function isKbApplicable(article, ticket) {
    if(!ticket) return false;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Ç–µ–≥–æ–≤
    const ticketTags = ticket.tags || [];
    const ticketCat = ticket.cat || '';
    
    return article.tags.some(tag => 
        ticketTags.some(t => t.toLowerCase().includes(tag.toLowerCase()) || tag.toLowerCase().includes(t.toLowerCase())) ||
        ticketCat.toLowerCase().includes(tag.toLowerCase()) ||
        tag.toLowerCase().includes(ticketCat.toLowerCase())
    );
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
function renderKbList() {
    const el = document.getElementById('kbList');
    const matchEl = document.getElementById('kbMatch');
    el.innerHTML = '';
    
    let applicableCount = 0;
    
    G.kbArticles.forEach((article, idx) => {
        const a = document.createElement('div');
        const applicable = isKbApplicable(article, G.selected);
        
        if(applicable && !G.kbUsed) applicableCount++;
        
        a.className = 'kb-article';
        
        // –ï—Å–ª–∏ KB —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞—è–≤–∫–∏ - –≤—Å–µ —Å—Ç–∞—Ç—å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
        if(G.selected && G.kbUsed) {
            a.className += ' not-applicable';
        } else if(G.selected) {
            if(applicable) {
                a.className += ' applicable';
            } else {
                a.className += ' not-applicable';
            }
        }
        
        // –°—Ç–∞—Ç—å–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ - –Ω–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã
        a.style.cursor = 'default';
        a.style.opacity = '0.8';
        
        const tagsHtml = article.tags.map(t => `<span class="kb-tag">${t}</span>`).join('');
        a.innerHTML = `<div class="kb-title">${article.title}</div><div class="kb-tags">${tagsHtml}</div>`;
        el.appendChild(a);
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å—Ç–∞—Ç–µ–π
    if(G.selected && G.kbUsed) {
        matchEl.textContent = '(—É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞)';
        matchEl.style.color = 'var(--text-secondary)';
    } else if(G.selected && applicableCount > 0) {
        matchEl.textContent = `(${applicableCount} –ø–æ–¥—Ö–æ–¥–∏—Ç)`;
        matchEl.style.color = 'var(--success)';
    } else if(G.selected) {
        matchEl.textContent = '(–Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö)';
        matchEl.style.color = 'var(--warning)';
    } else {
        matchEl.textContent = '';
    }
}

// UI –ø–æ–º–æ—â–Ω–∏–∫–∏
function addKbArticle(title, tags = []) {
    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞—Ç—å—é –≤ –º–∞—Å—Å–∏–≤
    const article = {title, tags};
    G.kbArticles.push(article);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    renderKbList();
}

function addKnownError(prb) {
    const el = document.getElementById('knownErrors');
    if(el.querySelector('.empty-msg')) el.innerHTML = '';
    const a = document.createElement('div');
    a.className = 'kb-article known-error';
    a.innerHTML = `<div class="kb-title">${prb.id}: ${prb.title}</div><div class="kb-tags"><span class="kb-tag">${prb.impact}</span></div>`;
    el.appendChild(a);
}

function addScheduledChange(chg) {
    const el = document.getElementById('scheduledChanges');
    if(el.querySelector('.empty-msg')) el.innerHTML = '';
    const a = document.createElement('div');
    a.className = 'kb-article scheduled-change';
    const typeIcon = chg.changeType === 'Emergency' ? 'üö®' : chg.changeType === 'Standard' ? '‚ö°' : 'üìÖ';
    a.innerHTML = `<div class="kb-title">${chg.id}: ${chg.title}</div><div class="kb-tags"><span class="kb-tag">${typeIcon} ${chg.changeType}</span><span class="kb-tag">${chg.risk} risk</span><span class="kb-tag">–î–µ–Ω—å ${chg.createdDay}</span></div>`;
    el.appendChild(a);
}

function updateLinksMap() {
    const el = document.getElementById('linksMap');
    if(el.querySelector('.empty-msg')) el.innerHTML = '';
    el.innerHTML = '';
    G.links.forEach(l => {
        const a = document.createElement('div');
        a.style.cssText = 'font-size:0.8em;padding:5px;margin:3px 0;background:rgba(0,0,0,0.2);border-radius:5px;';
        a.innerHTML = `<span style="color:var(--incident)">${l.from}</span> ‚Üí <span style="color:var(--change)">${l.to}</span>`;
        el.appendChild(a);
    });
}

function closeModal() { document.getElementById('diceModal').style.display = 'none'; }
function showRules() { document.getElementById('rulesModal').style.display = 'block'; }
function closeRules() { document.getElementById('rulesModal').style.display = 'none'; }

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
function showKbSearch() {
    if(!G.selected || G.selected.type !== 'incident') {
        alert('‚ùå –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤!');
        return;
    }
    
    if(G.selected.hasWorkaround) {
        alert('‚ö†Ô∏è –î–ª—è —ç—Ç–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω workaround.\n–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.');
        return;
    }
    
    if(G.kbUsed) {
        alert('‚ö†Ô∏è –í—ã —É–∂–µ –∏—Å–∫–∞–ª–∏ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –¥–ª—è —ç—Ç–æ–≥–æ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞!');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞—è–≤–∫–µ
    document.getElementById('kbSearchTicketId').textContent = `${G.selected.id}: ${G.selected.title}`;
    const tagsText = G.selected.tags ? G.selected.tags.join(', ') : G.selected.cat || '–æ–±—â–∞—è';
    document.getElementById('kbSearchTicketTags').innerHTML = `<strong>üè∑Ô∏è –¢–µ–≥–∏ –∑–∞—è–≤–∫–∏:</strong> ${tagsText}`;
    
    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç—å–∏
    const listEl = document.getElementById('kbSearchList');
    listEl.innerHTML = '';
    
    G.kbArticles.forEach((article, idx) => {
        const applicable = isKbApplicable(article, G.selected);
        const a = document.createElement('div');
        a.className = 'kb-article';
        a.style.cssText = 'margin-bottom:8px;cursor:pointer;';
        
        a.onclick = () => selectKbArticle(article, applicable);
        
        const tagsHtml = article.tags.map(t => `<span class="kb-tag">${t}</span>`).join('');
        a.innerHTML = `<div class="kb-title">${article.title}</div><div class="kb-tags">${tagsHtml}</div>`;
        listEl.appendChild(a);
    });
    
    document.getElementById('kbSearchModal').style.display = 'block';
}

function selectKbArticle(article, applicable) {
    closeKbSearch();
    
    if(!applicable) {
        alert(`‚ùå –°—Ç–∞—Ç—å—è "${article.title}" –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —ç—Ç–æ–π –∑–∞—è–≤–∫–∏!\n\n–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –ø—Ä–æ: ${article.tags.join(', ')}\n–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø—Ä–æ: ${G.selected.tags ? G.selected.tags.join(', ') : G.selected.cat}\n\n‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å KB –¥–ª—è —ç—Ç–æ–π –∑–∞—è–≤–∫–∏ —É–ø—É—â–µ–Ω–∞!`);
        log(`‚ö†Ô∏è –ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—å—é KB - –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ —Ç–µ–≥–∞–º`, 'warning');
        G.kbUsed = true;
        document.getElementById('kbHint').style.display = 'none';
        document.getElementById('kbStatus').style.display = 'block';
        document.getElementById('kbStatus').style.background = 'rgba(231,76,60,0.2)';
        document.getElementById('kbStatus').style.borderColor = 'rgba(231,76,60,0.5)';
        document.getElementById('kbStatus').style.color = 'var(--danger)';
        document.getElementById('kbStatus').innerHTML = '‚ùå –ù–µ–ø–æ–¥—Ö–æ–¥—è—â–∞—è —Å—Ç–∞—Ç—å—è –Ω–∞–π–¥–µ–Ω–∞ (–±–µ–∑ –±–æ–Ω—É—Å–∞)';
        renderKbList();
        return;
    }
    
    G.kbUsed = true;
    log(`üìö –ù–∞–π–¥–µ–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ —Å—Ç–∞—Ç—å—è "${article.title}" (-2 –∫ –ø–æ—Ä–æ–≥—É)`, 'success');
    document.getElementById('kbHint').style.display = 'none';
    document.getElementById('kbStatus').style.display = 'block';
    document.getElementById('kbStatus').style.background = 'rgba(39,174,96,0.2)';
    document.getElementById('kbStatus').style.borderColor = 'rgba(39,174,96,0.5)';
    document.getElementById('kbStatus').style.color = 'var(--success)';
    document.getElementById('kbStatus').innerHTML = `üìö –ù–∞–π–¥–µ–Ω–∞ —Å—Ç–∞—Ç—å—è: "${article.title}" (-2 –∫ –ø–æ—Ä–æ–≥—É)`;
    renderKbList();
    alert(`‚úÖ –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω–∞!\n–¢–µ–ø–µ—Ä—å –Ω–∞–∂–º–∏—Ç–µ "–†–µ—à–∏—Ç—å" –¥–ª—è –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–æ–≤.\n–ù–æ–≤—ã–π –ø–æ—Ä–æ–≥: ${getThreshold()}+`);
}

function closeKbSearch() {
    document.getElementById('kbSearchModal').style.display = 'none';
}

window.onclick = e => { if(e.target.className==='modal') e.target.style.display='none'; }
</script>
</body>
</html>

