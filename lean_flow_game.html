<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lean Flow Master - –ë–µ—Ä–µ–∂–ª–∏–≤–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∏ ITIL 4</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117; --bg-card: #161b22; --bg-column: #21262d;
            --text-primary: #c9d1d9; --text-secondary: #8b949e;
            --accent-green: #238636; --accent-blue: #1f6feb; --accent-purple: #8957e5;
            --accent-orange: #d29922; --accent-red: #da3633; --accent-cyan: #39c5cf;
            --waste-transport: #f97316; --waste-inventory: #8b5cf6; --waste-motion: #ec4899;
            --waste-waiting: #f59e0b; --waste-overprod: #ef4444; --waste-overproc: #6366f1;
            --waste-defects: #dc2626; --waste-talent: #14b8a6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Exo 2', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; }
        
        .app { display: flex; flex-direction: column; height: 100vh; }
        
        /* Header */
        .header { background: var(--bg-card); padding: 10px 20px; display: grid; 
            grid-template-columns: auto 1fr auto; grid-template-rows: auto auto; gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1); align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; grid-column: 1; grid-row: 1; }
        .logo-icon { font-size: 1.5em; }
        .logo-text { font-family: 'Russo One', sans-serif; font-size: 1.2em;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .logo-sub { font-size: 0.7em; color: var(--text-secondary); }
        
        .stats { display: flex; gap: 10px; flex-wrap: wrap; grid-column: 2; grid-row: 1 / 3; justify-content: center; }
        .stat { background: var(--bg-column); padding: 6px 12px; border-radius: 8px; text-align: center; min-width: 80px; }
        .stat-value { font-size: 1.2em; font-weight: 700; }
        .stat-label { font-size: 0.65em; color: var(--text-secondary); }
        .stat-efficiency .stat-value { color: var(--accent-green); }
        .stat-waste .stat-value { color: var(--accent-red); }
        .stat-score .stat-value { color: var(--accent-cyan); }
        .stat-time .stat-value { color: var(--accent-orange); }
        
        .controls { display: flex; gap: 8px; grid-column: 3; grid-row: 1 / 3; align-items: center; flex-wrap: nowrap; justify-content: flex-end; }
        .btn { padding: 8px 15px; border: none; border-radius: 8px; font-family: 'Exo 2', sans-serif;
            font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 6px; font-size: 0.9em; }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; filter: grayscale(50%); }
        .btn-start { background: var(--accent-green); color: white; }
        .btn-rules { background: var(--accent-purple); color: white; }
        .btn-reset { background: var(--accent-red); color: white; }
        
        #nextDayBtn:not(:disabled) {
            animation: btnPulse 2s infinite;
        }
        
        @keyframes btnPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(57, 197, 207, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(57, 197, 207, 0);
            }
        }
        
        /* Main Area */
        .main { display: flex; flex: 1; overflow: hidden; }
        
        /* Kanban Board */
        .kanban { flex: 1; display: flex; gap: 15px; padding: 20px; overflow-x: auto; }
        .column { background: var(--bg-column); border-radius: 12px; min-width: 280px; max-width: 280px;
            display: flex; flex-direction: column; position: relative; cursor: pointer; transition: all 0.3s; }
        .column:hover { box-shadow: 0 0 15px rgba(57, 197, 207, 0.3); }
        .column.selected { box-shadow: 0 0 25px rgba(57, 197, 207, 0.6); border: 2px solid var(--accent-cyan); }
        .column.automated { 
            background: linear-gradient(135deg, var(--bg-column) 0%, rgba(137,87,229,0.15) 100%);
            border: 2px solid var(--accent-purple);
        }
        .column.automated::before {
            content: 'ü§ñ –ê–≤—Ç–æ';
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--accent-purple);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7em;
            font-weight: 600;
            z-index: 10;
        }
        .column-header { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center; }
        .column-title { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .column-count { background: rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
        .column-wip { font-size: 0.75em; color: var(--text-secondary); }
        .column-wip.exceeded { color: var(--accent-red); font-weight: 600; }
        .column-wip.kaizen { color: var(--accent-cyan); font-weight: 600; }
        .wip-controls { display: flex; gap: 3px; margin-top: 5px; }
        .wip-btn { 
            padding: 3px 6px; 
            border: none; 
            border-radius: 4px; 
            font-size: 0.65em; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.2s;
            font-family: 'Exo 2', sans-serif;
        }
        .wip-btn:hover:not(:disabled) { transform: scale(1.05); }
        .wip-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .wip-btn-add { background: var(--accent-green); color: white; }
        .wip-btn-remove { background: var(--accent-orange); color: white; }
        .column-body { flex: 1; padding: 10px; overflow-y: auto; min-height: 200px; }
        
        /* Cards */
        .card { background: var(--bg-card); border-radius: 8px; padding: 12px; margin-bottom: 10px;
            border: 2px solid transparent; cursor: move; transition: all 0.3s; position: relative; }
        .card:hover { border-color: var(--accent-blue); transform: translateY(-2px); }
        .card.dragging { opacity: 0.5; transform: rotate(2deg); }
        .card.drag-over { border-top: 3px solid var(--accent-cyan); }
        .card.selected { border-color: var(--accent-cyan); box-shadow: 0 0 20px rgba(57,197,207,0.3); }
        .card.has-waste { border-color: var(--accent-orange); }
        .card.blocked { opacity: 0.6; border-color: var(--accent-red); }
        .card-id { font-size: 0.7em; color: var(--text-secondary); margin-bottom: 5px; }
        .card-title { font-weight: 600; font-size: 0.9em; margin-bottom: 8px; }
        .card-type { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.7em; font-weight: 600; }
        .type-feature { background: rgba(31,111,235,0.2); color: var(--accent-blue); }
        .type-bug { background: rgba(218,54,51,0.2); color: var(--accent-red); }
        .type-improvement { background: rgba(35,134,54,0.2); color: var(--accent-green); }
        .type-request { background: rgba(137,87,229,0.2); color: var(--accent-purple); }
        .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; gap: 8px; }
        .card-value { font-size: 0.75em; color: var(--accent-green); font-weight: 600; }
        .card-effort { font-size: 0.75em; font-weight: 600; }
        .card-time { font-size: 0.75em; color: var(--text-secondary); }
        .card-waste-indicator { position: absolute; top: 8px; right: 8px; font-size: 1em; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .card-processing { border: 2px solid var(--accent-orange) !important; }
        .card-ready { border: 2px solid var(--accent-green) !important; }
        .processing-badge { 
            display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px;
            border-radius: 5px; font-size: 0.7em; font-weight: 600; margin-top: 8px;
            background: rgba(245,158,11,0.2); color: var(--accent-orange);
            animation: blink 1.5s infinite;
        }
        .ready-badge { 
            display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px;
            border-radius: 5px; font-size: 0.7em; font-weight: 600; margin-top: 8px;
            background: rgba(35,134,54,0.2); color: var(--accent-green);
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        /* Toast notification */
        .toast {
            position: fixed;
            top: 100px;
            right: 30px;
            background: var(--bg-card);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 20px;
            max-width: 400px;
            z-index: 3000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            animation: slideIn 0.3s ease-out;
        }
        .toast.warning { border-color: var(--accent-orange); }
        .toast.error { border-color: var(--accent-red); }
        .toast.info { border-color: var(--accent-blue); }
        .toast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .toast-title {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--accent-orange);
        }
        .toast.error .toast-title { color: var(--accent-red); }
        .toast.info .toast-title { color: var(--accent-blue); }
        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        .toast-close:hover { color: var(--text-primary); }
        .toast-body {
            color: var(--text-primary);
            line-height: 1.6;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
        
        .urgency-badge {
            display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px;
            border-radius: 4px; font-size: 0.65em; font-weight: 600; margin-top: 5px;
        }
        .urgency-normal { background: rgba(139,92,246,0.2); color: var(--waste-inventory); }
        .urgency-warning { background: rgba(245,158,11,0.2); color: var(--accent-orange); animation: blink 2s infinite; }
        .urgency-critical { background: rgba(220,38,38,0.2); color: var(--accent-red); animation: blink 1s infinite; }
        .urgency-overdue { background: rgba(220,38,38,0.4); color: var(--accent-red); animation: blink 0.5s infinite; }
        
        /* Waste Badge */
        .waste-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px;
            border-radius: 4px; font-size: 0.65em; font-weight: 600; margin-top: 8px; }
        .waste-transport { background: rgba(249,115,22,0.2); color: var(--waste-transport); }
        .waste-inventory { background: rgba(139,92,246,0.2); color: var(--waste-inventory); }
        .waste-motion { background: rgba(236,72,153,0.2); color: var(--waste-motion); }
        .waste-waiting { background: rgba(245,158,11,0.2); color: var(--waste-waiting); }
        .waste-overprod { background: rgba(239,68,68,0.2); color: var(--waste-overprod); }
        .waste-overproc { background: rgba(99,102,241,0.2); color: var(--waste-overproc); }
        .waste-defects { background: rgba(220,38,38,0.2); color: var(--waste-defects); }
        .waste-talent { background: rgba(20,184,166,0.2); color: var(--waste-talent); }
        
        /* Side Panel */
        .side-panel { width: 320px; background: var(--bg-card); border-left: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column; }
        .panel-section { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .panel-section.waste-section { max-height: 400px; overflow-y: auto; }
        .panel-title { font-family: 'Russo One', sans-serif; font-size: 1em; margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px; }
        
        /* Actions */
        .action-btn { width: 100%; padding: 12px; margin-bottom: 8px; border: none; border-radius: 8px;
            font-family: 'Exo 2', sans-serif; font-weight: 600; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; gap: 10px; text-align: left; }
        .action-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .action-btn:not(:disabled):hover { transform: translateX(5px); }
        .action-btn .icon { font-size: 1.2em; }
        .action-btn .text { flex: 1; }
        .action-btn .cost { font-size: 0.8em; opacity: 0.7; }
        
        .btn-move { background: linear-gradient(135deg, var(--accent-blue), #2563eb); color: white; }
        .btn-eliminate { background: linear-gradient(135deg, var(--accent-green), #16a34a); color: white; }
        .btn-automate { background: linear-gradient(135deg, var(--accent-purple), #7c3aed); color: white; }
        .btn-kaizen { background: linear-gradient(135deg, var(--accent-cyan), #06b6d4); color: white; }
        .btn-5s { background: linear-gradient(135deg, var(--accent-orange), #ea580c); color: white; }
        
        /* Waste Legend */
        .waste-legend { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75em; padding: 5px;
            background: rgba(255,255,255,0.03); border-radius: 5px; cursor: pointer; transition: all 0.2s; }
        .legend-item:hover { background: rgba(255,255,255,0.08); }
        .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
        
        /* ITIL Connection */
        .itil-connection { background: rgba(31,111,235,0.1); border: 1px solid rgba(31,111,235,0.3);
            border-radius: 8px; padding: 12px; margin-top: 10px; }
        .itil-title { font-weight: 600; font-size: 0.85em; color: var(--accent-blue); margin-bottom: 5px; }
        .itil-text { font-size: 0.8em; color: var(--text-secondary); line-height: 1.5; }
        
        /* Log */
        .log { flex: 1; overflow-y: auto; padding: 10px; max-height: 200px; }
        .log-entry { font-size: 0.75em; padding: 5px 8px; margin-bottom: 4px; border-radius: 4px;
            background: rgba(255,255,255,0.03); border-left: 3px solid var(--text-secondary); }
        .log-entry.success { border-left-color: var(--accent-green); }
        .log-entry.warning { border-left-color: var(--accent-orange); }
        .log-entry.info { border-left-color: var(--accent-blue); }
        .log-entry.waste { border-left-color: var(--accent-red); }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; }
        .modal-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--bg-card); border-radius: 16px; padding: 25px; width: 90%; max-width: 700px;
            max-height: 85vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title { font-family: 'Russo One', sans-serif; font-size: 1.4em; }
        .modal-close { background: none; border: none; color: var(--text-secondary); font-size: 1.5em; cursor: pointer; }
        
        /* Rules Content */
        .rules h3 { color: var(--accent-cyan); margin: 20px 0 10px; font-family: 'Russo One', sans-serif; }
        .rules ul { padding-left: 20px; line-height: 1.8; }
        .rules p { line-height: 1.7; margin-bottom: 10px; }
        .waste-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
        .waste-item { background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; border-left: 4px solid; }
        .waste-item h4 { font-size: 0.9em; margin-bottom: 5px; }
        .waste-item p { font-size: 0.8em; color: var(--text-secondary); }
        .principle-box { background: rgba(35,134,54,0.1); border: 1px solid rgba(35,134,54,0.3);
            border-radius: 8px; padding: 12px; margin: 10px 0; }
        .principle-box h4 { color: var(--accent-green); margin-bottom: 5px; }
        
        /* Game Over */
        .game-over { position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(13,17,23,0.95); display: none; z-index: 2000;
            flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .game-over h1 { font-family: 'Russo One', sans-serif; font-size: 3em; margin-bottom: 15px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-cyan));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .final-stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin: 25px 0; max-width: 1200px; }
        .final-stat { background: var(--bg-card); border-radius: 12px; padding: 20px; }
        .final-stat-value { font-size: 2.5em; font-weight: 700; }
        .final-stat-label { color: var(--text-secondary); margin-top: 8px; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 3px; }
        
        @media (max-width: 1200px) {
            .main { flex-direction: column; }
            .side-panel { width: 100%; max-height: 300px; }
            .kanban { min-height: 400px; }
        }
    </style>
</head>
<body>
<div class="app">
    <header class="header">
        <div class="logo">
            <span class="logo-icon">üè≠</span>
            <div>
                <div class="logo-text">Lean Flow Master</div>
                <div class="logo-sub">–ë–µ—Ä–µ–∂–ª–∏–≤–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ + ITIL 4</div>
            </div>
        </div>
        <div class="stats">
            <div class="stat stat-score"><div class="stat-value" id="score">0</div><div class="stat-label">–û—á–∫–∏</div></div>
            <div class="stat stat-time"><div class="stat-value" id="day">–î–µ–Ω—å 1</div><div class="stat-label">–∏–∑ 21</div></div>
            <div class="stat stat-time"><div class="stat-value" id="timer">2:00</div><div class="stat-label">–û—Å—Ç–∞–ª–æ—Å—å</div></div>
            <div class="stat stat-efficiency"><div class="stat-value" id="efficiency">100%</div><div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div></div>
            <div class="stat stat-waste"><div class="stat-value" id="wasteCount">0</div><div class="stat-label">–ü–æ—Ç–µ—Ä—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ</div></div>
            <div class="stat" style="background: var(--accent-purple); cursor: pointer;" onclick="showTeamModal()" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π">
                <div class="stat-value" id="teamSize">5</div>
                <div class="stat-label" style="color: white;">üë• –ö–æ–º–∞–Ω–¥–∞</div>
            </div>
            <div class="stat" style="background: var(--accent-orange);" title="Work in Progress / –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ñ–æ–∫—É—Å–∞">
                <div class="stat-value" id="wipStat">0/5</div>
                <div class="stat-label" style="color: white;">‚ö° WIP (√ó<span id="focusMultiplier">1.0</span>)</div>
            </div>
        </div>
        <div class="controls">
            <button class="btn btn-rules" onclick="showRules()">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
            <button class="btn" onclick="showCFD()" id="btnCFD" disabled style="background: var(--accent-purple);">üìä CFD</button>
            <button class="btn btn-reset" onclick="resetGame()">‚Üª –°–±—Ä–æ—Å</button>
            <button class="btn btn-start" onclick="startGame()" id="startBtn">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
            <button class="btn btn-start" onclick="nextDay()" id="nextDayBtn" disabled style="background: var(--accent-cyan);">
                ‚û°Ô∏è –°–ª–µ–¥ –¥–µ–Ω—å
            </button>
        </div>
    </header>
    
    <div class="main">
        <div class="kanban" id="kanban">
            <div class="column" data-col="backlog" onclick="selectColumn('backlog')">
                <div class="column-header">
                    <div class="column-title">üì• Backlog</div>
                    <span class="column-count" id="count-backlog">0</span>
                </div>
                <div class="column-body" id="col-backlog"></div>
            </div>
            <div class="column" data-col="analysis" onclick="selectColumn('analysis')">
                <div class="column-header">
                    <div class="column-title">üîç –ê–Ω–∞–ª–∏–∑</div>
                    <div>
                        <span class="column-count" id="count-analysis">0</span> <span class="column-wip" id="wip-analysis">WIP: 3</span>
                        <div class="wip-controls">
                            <button class="wip-btn wip-btn-add" onclick="addWIP('analysis')" title="–î–æ–±–∞–≤–∏—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">+WIP</button>
                            <button class="wip-btn wip-btn-remove" onclick="removeWIP('analysis')" title="–£–±—Ä–∞—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">-WIP</button>
                        </div>
                    </div>
                </div>
                <div class="column-body" id="col-analysis"></div>
            </div>
            <div class="column" data-col="design" onclick="selectColumn('design')">
                <div class="column-header">
                    <div class="column-title">üìê –î–∏–∑–∞–π–Ω</div>
                    <div>
                        <span class="column-count" id="count-design">0</span> <span class="column-wip" id="wip-design">WIP: 2</span>
                        <div class="wip-controls">
                            <button class="wip-btn wip-btn-add" onclick="addWIP('design')" title="–î–æ–±–∞–≤–∏—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">+WIP</button>
                            <button class="wip-btn wip-btn-remove" onclick="removeWIP('design')" title="–£–±—Ä–∞—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">-WIP</button>
                        </div>
                    </div>
                </div>
                <div class="column-body" id="col-design"></div>
            </div>
            <div class="column" data-col="develop" onclick="selectColumn('develop')">
                <div class="column-header">
                    <div class="column-title">üíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞</div>
                    <div>
                        <span class="column-count" id="count-develop">0</span> <span class="column-wip" id="wip-develop">WIP: 2</span>
                        <div class="wip-controls">
                            <button class="wip-btn wip-btn-add" onclick="addWIP('develop')" title="–î–æ–±–∞–≤–∏—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">+WIP</button>
                            <button class="wip-btn wip-btn-remove" onclick="removeWIP('develop')" title="–£–±—Ä–∞—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">-WIP</button>
                        </div>
                    </div>
                </div>
                <div class="column-body" id="col-develop"></div>
            </div>
            <div class="column" data-col="test" onclick="selectColumn('test')">
                <div class="column-header">
                    <div class="column-title">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                    <div>
                        <span class="column-count" id="count-test">0</span> <span class="column-wip" id="wip-test">WIP: 1</span>
                        <div class="wip-controls">
                            <button class="wip-btn wip-btn-add" onclick="addWIP('test')" title="–î–æ–±–∞–≤–∏—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">+WIP</button>
                            <button class="wip-btn wip-btn-remove" onclick="removeWIP('test')" title="–£–±—Ä–∞—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">-WIP</button>
                        </div>
                    </div>
                </div>
                <div class="column-body" id="col-test"></div>
            </div>
            <div class="column" data-col="deploy" onclick="selectColumn('deploy')">
                <div class="column-header">
                    <div class="column-title">üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ</div>
                    <div>
                        <span class="column-count" id="count-deploy">0</span> <span class="column-wip" id="wip-deploy">WIP: 2</span>
                        <div class="wip-controls">
                            <button class="wip-btn wip-btn-add" onclick="addWIP('deploy')" title="–î–æ–±–∞–≤–∏—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">+WIP</button>
                            <button class="wip-btn wip-btn-remove" onclick="removeWIP('deploy')" title="–£–±—Ä–∞—Ç—å WIP (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)">-WIP</button>
                        </div>
                    </div>
                </div>
                <div class="column-body" id="col-deploy"></div>
            </div>
            <div class="column" data-col="done" onclick="selectColumn('done')">
                <div class="column-header">
                    <div class="column-title">‚úÖ –ì–æ—Ç–æ–≤–æ</div>
                    <span class="column-count" id="count-done">0</span>
                </div>
                <div class="column-body" id="col-done"></div>
            </div>
        </div>
        
        <aside class="side-panel">
            <div class="panel-section">
                <div class="panel-title">üéØ –î–µ–π—Å—Ç–≤–∏—è</div>
                <button class="action-btn btn-move" onclick="moveCard()" id="btnMove" disabled>
                    <span class="icon">‚û°Ô∏è</span><span class="text">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</span><span class="cost">–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø</span>
                </button>
                <button class="action-btn btn-eliminate" onclick="eliminateWaste()" id="btnEliminate" disabled>
                    <span class="icon">üóëÔ∏è</span><span class="text">–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é</span><span class="cost">-20 –æ—á–∫–æ–≤</span>
                </button>
                <button class="action-btn btn-automate" onclick="automateProcess()" id="btnAutomate" disabled>
                    <span class="icon">ü§ñ</span><span class="text">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span><span class="cost">-50 –æ—á–∫–æ–≤</span>
                </button>
                <button class="action-btn btn-5s" onclick="apply5S()" id="btn5S" disabled>
                    <span class="icon">üßπ</span><span class="text">5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</span><span class="cost">-30 –æ—á–∫–æ–≤</span>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #f59e0b, #d97706);" onclick="speedUpAutomation()" id="btnSpeedUp" disabled>
                    <span class="icon">‚ö°</span><span class="text">–£—Å–∫–æ—Ä–∏—Ç—å –∞–≤—Ç–æ</span><span class="cost">-500 –æ—á–∫–æ–≤</span>
                </button>
            </div>
            
            <div class="panel-section waste-section">
                <div class="panel-title">‚ö†Ô∏è 8 –≤–∏–¥–æ–≤ –ø–æ—Ç–µ—Ä—å (MUDA)</div>
                <div class="waste-legend">
                    <div class="legend-item" onclick="highlightWaste('transport')"><span class="legend-dot" style="background:var(--waste-transport)"></span>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
                    <div class="legend-item" onclick="highlightWaste('inventory')"><span class="legend-dot" style="background:var(--waste-inventory)"></span>–ó–∞–ø–∞—Å—ã</div>
                    <div class="legend-item" onclick="highlightWaste('motion')"><span class="legend-dot" style="background:var(--waste-motion)"></span>–õ–∏—à–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è</div>
                    <div class="legend-item" onclick="highlightWaste('waiting')"><span class="legend-dot" style="background:var(--waste-waiting)"></span>–û–∂–∏–¥–∞–Ω–∏–µ</div>
                    <div class="legend-item" onclick="highlightWaste('overprod')"><span class="legend-dot" style="background:var(--waste-overprod)"></span>–ü–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div>
                    <div class="legend-item" onclick="highlightWaste('overproc')"><span class="legend-dot" style="background:var(--waste-overproc)"></span>–ò–∑–ª–∏—à–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</div>
                    <div class="legend-item" onclick="highlightWaste('defects')"><span class="legend-dot" style="background:var(--waste-defects)"></span>–î–µ—Ñ–µ–∫—Ç—ã</div>
                    <div class="legend-item" onclick="highlightWaste('talent')"><span class="legend-dot" style="background:var(--waste-talent)"></span>–ù–µ–∏—Å–ø. –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª</div>
                </div>
                
                <div class="itil-connection" id="itilTip">
                    <div class="itil-title">üîó –°–≤—è–∑—å —Å ITIL 4</div>
                    <div class="itil-text">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∏–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤—è–∑—å —Å –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ ITIL 4</div>
                </div>
            </div>
            
            <div class="panel-section" style="flex:1;display:flex;flex-direction:column">
                <div class="panel-title">üìú –ñ—É—Ä–Ω–∞–ª</div>
                <div class="log" id="log"></div>
            </div>
        </aside>
    </div>
</div>

<!-- Modal Rules -->
<div class="modal" id="rulesModal">
    <div class="modal-box">
        <div class="modal-header">
            <h2 class="modal-title">üìñ Lean Flow Master ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
            <button class="modal-close" onclick="closeRules()">√ó</button>
        </div>
        <div class="rules">
            <h3>üéØ –¶–µ–ª—å –∏–≥—Ä—ã</h3>
            <p>–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–∏ (Value Stream), —É—Å—Ç—Ä–∞–Ω—è—è 8 –≤–∏–¥–æ–≤ –ø–æ—Ç–µ—Ä—å –∏ –ø—Ä–∏–º–µ–Ω—è—è –ø—Ä–∏–Ω—Ü–∏–ø—ã –±–µ—Ä–µ–∂–ª–∏–≤–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞. –ò–∑—É—á–∏—Ç–µ —Å–≤—è–∑—å Lean —Å –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏ ITIL 4!</p>
            
            <h3>‚ö†Ô∏è 8 –≤–∏–¥–æ–≤ –ø–æ—Ç–µ—Ä—å (MUDA)</h3>
            <div class="waste-grid">
                <div class="waste-item" style="border-color:var(--waste-transport)">
                    <h4>üöö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h4>
                    <p>–õ–∏—à–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏. ITIL: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Value Chain</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-inventory)">
                    <h4>üì¶ –ó–∞–ø–∞—Å—ã</h4>
                    <p>–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã. ITIL: WIP –ª–∏–º–∏—Ç—ã –≤ Kanban</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-motion)">
                    <h4>üèÉ –õ–∏—à–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è</h4>
                    <p>–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã. ITIL: Optimize & Automate</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-waiting)">
                    <h4>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ</h4>
                    <p>–ü—Ä–æ—Å—Ç–æ–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏. ITIL: Flow management</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-overprod)">
                    <h4>üìà –ü–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</h4>
                    <p>–†–∞–±–æ—Ç–∞ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞. ITIL: Focus on Value</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-overproc)">
                    <h4>‚öôÔ∏è –ò–∑–ª–∏—à–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h4>
                    <p>–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è. ITIL: Keep it Simple</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-defects)">
                    <h4>‚ùå –î–µ—Ñ–µ–∫—Ç—ã</h4>
                    <p>–û—à–∏–±–∫–∏ –∏ –ø–µ—Ä–µ–¥–µ–ª–∫–∏. ITIL: Problem Management</p>
                </div>
                <div class="waste-item" style="border-color:var(--waste-talent)">
                    <h4>üß† –ù–µ–∏—Å–ø. –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª</h4>
                    <p>–ù–∞–≤—ã–∫–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. ITIL: Collaborate</p>
                </div>
            </div>
            
            <h3>üéÆ –ú–µ—Ö–∞–Ω–∏–∫–∞ –∏–≥—Ä—ã</h3>
            <ul>
                <li><strong>21 –¥–µ–Ω—å</strong> ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–≥—Ä—ã</li>
                <li><strong>–°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª</strong> ‚Äî 300 –æ—á–∫–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã üí∞</li>
                <li><strong>2 –º–∏–Ω—É—Ç—ã –Ω–∞ –¥–µ–Ω—å</strong> ‚Äî —É –≤–∞—Å –µ—Å—Ç—å 120 —Å–µ–∫—É–Ω–¥ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏</li>
                <li><strong>üìä CFD –¥–∏–∞–≥—Ä–∞–º–º–∞</strong> ‚Äî Cumulative Flow Diagram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –∑–∞–¥–∞—á –ø–æ –¥–Ω—è–º:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è WIP –≤ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ</li>
                        <li>–í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç (—Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏)</li>
                        <li>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</li>
                        <li>–ö–Ω–æ–ø–∫–∞ "üìä CFD" –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã</li>
                        <li>–í —Ñ–∏–Ω–∞–ª–µ –∏–≥—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏—Ç–æ–≥–æ–≤–∞—è CFD —Å –∞–Ω–∞–ª–∏–∑–æ–º</li>
                    </ul>
                </li>
                <li><strong>‚è±Ô∏è Lead Time</strong> ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ –¥–æ –µ—ë –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ò–∑–º–µ—Ä—è–µ—Ç—Å—è –≤ –¥–Ω—è—Ö (–æ—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è –≤ Backlog –¥–æ Done)</li>
                        <li>–ö–ª—é—á–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ—Ç–æ–∫–∞</li>
                        <li>üü¢ –û—Ç–ª–∏—á–Ω–æ: < 3 –¥–Ω–µ–π</li>
                        <li>üü° –•–æ—Ä–æ—à–æ: 3-5 –¥–Ω–µ–π</li>
                        <li>üü† –°—Ä–µ–¥–Ω–µ: 5-8 –¥–Ω–µ–π</li>
                        <li>üî¥ –ü–ª–æ—Ö–æ: > 8 –¥–Ω–µ–π</li>
                        <li>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª–µ –∏–≥—Ä—ã –≤–º–µ—Å—Ç–µ —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø–æ—Ç–æ–∫–∞</li>
                    </ul>
                </li>
                <li><strong>üë• –ö–æ–º–∞–Ω–¥–∞ (5 —á–µ–ª–æ–≤–µ–∫)</strong> ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –∫–æ–º–∞–Ω–¥—ã:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 —á–µ–ª–æ–≤–µ–∫</li>
                        <li>–°—Ç–æ–∏–º–æ—Å—Ç—å: 5 –æ—á–∫–æ–≤/–¥–µ–Ω—å –∑–∞ –∫–∞–∂–¥–æ–≥–æ</li>
                        <li>–î–æ–±–∞–≤–∏—Ç—å: -10 –æ—á–∫–æ–≤ —Ä–∞–∑–æ–≤–æ + 5/–¥–µ–Ω—å</li>
                        <li>–£–±—Ä–∞—Ç—å: -15 –æ—á–∫–æ–≤ (–≤—ã—Ö–æ–¥–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ)</li>
                        <li>–ú–∏–Ω–∏–º—É–º: 1 —á–µ–ª–æ–≤–µ–∫</li>
                        <li>‚ö° –ë–æ–ª—å—à–µ –ª—é–¥–µ–π = –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞</li>
                    </ul>
                </li>
                <li><strong>Kanban –¥–æ—Å–∫–∞</strong> ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ —Ä–∞–±–æ—Ç</li>
                <li><strong>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Backlog</strong> ‚Äî –¥–Ω–∏ 1-5: –ø–æ 5 –∑–∞–¥–∞—á, –¥–Ω–∏ 6-13: –ø–æ 8 –∑–∞–¥–∞—á, –¥–Ω–∏ 14-19: –ø–æ 13 –∑–∞–¥–∞—á</li>
                <li><strong>üìã –ê–≤—Ç–æ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ Backlog</strong> ‚Äî –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –∑–∞–¥–∞—á–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ (–≤–≤–µ—Ä—Ö—É ‚Äî —Å–∞–º—ã–µ —Å—Ä–æ—á–Ω—ã–µ)</li>
                <li><strong>WIP –ª–∏–º–∏—Ç—ã</strong> ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –∫–æ–ª–æ–Ω–∫–µ</li>
                <li><strong>üîÑ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á</strong> ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏ (Drag & Drop):
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ó–∞–∂–º–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –Ω–∞ –¥—Ä—É–≥—É—é –≤ —Ç–æ–π –∂–µ –∫–æ–ª–æ–Ω–∫–µ</li>
                        <li>–ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á</li>
                    </ul>
                </li>
                <li><strong>‚è±Ô∏è –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</strong> ‚Äî –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ WIP –∏ –∫–æ–º–∞–Ω–¥—ã:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li><strong>Backlog</strong> ‚Äî –∑–∞–¥–∞—á–∏ –≥–æ—Ç–æ–≤—ã –∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é —Å—Ä–∞–∑—É (–±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏)</li>
                        <li><strong>–†–∞–±–æ—á–∏–µ –∫–æ–ª–æ–Ω–∫–∏</strong> ‚Äî –≤—Ä–µ–º—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏:</li>
                        <li><strong>–ë–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è:</strong> –±—Ä–æ—Å–æ–∫ 2d6 √ó 12 (24-144 —Å–µ–∫—É–Ω–¥—ã, —Å—Ä–µ–¥–Ω–µ–µ 84)</li>
                        <li><strong>–ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ñ–æ–∫—É—Å–∞:</strong> (WIP / –†–∞–∑–º–µ—Ä_–∫–æ–º–∞–Ω–¥—ã)^1.5</li>
                        <li><strong>–ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è:</strong> –ë–∞–∑–æ–≤–æ–µ √ó –ú–Ω–æ–∂–∏—Ç–µ–ª—å</li>
                        <li>WIP = –≤—Å–µ –∑–∞–¥–∞—á–∏ —Å –∞–∫—Ç–∏–≤–Ω—ã–º —Ç–∞–π–º–µ—Ä–æ–º (isProcessing), –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç–∞—Ç—É—Å–∞ –ê–Ω–∞–ª–∏–∑</li>
                        <li>‚ö†Ô∏è <strong>–ë–æ–ª—å—à–µ WIP = –±–æ–ª—å—à–µ –ø–æ—Ç–µ—Ä—è —Ñ–æ–∫—É—Å–∞ = –¥–æ–ª—å—à–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ!</strong></li>
                        <li><strong>–ü—Ä–∏–º–µ—Ä—ã –≤–ª–∏—è–Ω–∏—è WIP:</strong></li>
                        <li style="margin-left: 20px;">WIP=5, –ö–æ–º–∞–Ω–¥–∞=5: (5/5)^1.5 = <strong>√ó1.0</strong> ‚Äî –æ–ø—Ç–∏–º—É–º! ‚úÖ</li>
                        <li style="margin-left: 20px;">WIP=10, –ö–æ–º–∞–Ω–¥–∞=5: (10/5)^1.5 = <strong>√ó2.83</strong> ‚Äî –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞! ‚ö†Ô∏è</li>
                        <li style="margin-left: 20px;">WIP=3, –ö–æ–º–∞–Ω–¥–∞=5: (3/5)^1.5 = <strong>√ó0.46</strong> ‚Äî –Ω–µ–¥–æ–≥—Ä—É–∑–∫–∞ üìâ</li>
                        <li style="margin-left: 20px;">–ü—Ä–∏–º–µ—Ä: –±–∞–∑–æ–≤–æ–µ 84—Å, WIP=10 ‚Üí 84√ó2.83 = 238 —Å–µ–∫—É–Ω–¥!</li>
                        <li>–ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "‚è±Ô∏è 216—Å (84√ó2.57)" –≥–¥–µ 216=–æ—Å—Ç–∞–≤—à–µ–µ—Å—è, 84=–±–∞–∑–æ–≤–æ–µ, 2.57=–º–Ω–æ–∂–∏—Ç–µ–ª—å</li>
                        <li><strong>–°–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É WIP</strong> –≤ header (–æ—Ä–∞–Ω–∂–µ–≤—ã–π –±–ª–æ–∫) –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ñ–æ–∫—É—Å–∞!</li>
                        <li>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: "‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–Ω–æ—Å—É"</li>
                        <li>–¢–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –¥–∞–ª—å—à–µ</li>
                    </ul>
                </li>
                <li><strong>üö® –°—Ä–æ—á–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á</strong> ‚Äî –∫–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –∏–º–µ–µ—Ç –¥–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–î–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç, <strong>–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å</strong> –∑–∞–¥–∞—á—É (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–µ–Ω—å –∏–≥—Ä—ã)</li>
                        <li>–ú–∏–Ω–∏–º—É–º: —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è</li>
                        <li>–ú–∞–∫—Å–∏–º—É–º: –¥–µ–Ω—å 20</li>
                        <li><strong>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏—è—Ö</strong> (Backlog, –ê–Ω–∞–ª–∏–∑, –î–∏–∑–∞–π–Ω –∏ —Ç.–¥.)</li>
                        <li>üìã –ù–æ—Ä–º–∞–ª—å–Ω–æ: "–ü–æ—Å—Ç–∞–≤–∫–∞: –¥–µ–Ω—å 15" ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ä–æ–∫</li>
                        <li>‚è∞ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "–ß–µ—Ä–µ–∑ 2–¥ (–¥–µ–Ω—å 10)" ‚Äî —Å–∫–æ—Ä–æ –¥–µ–¥–ª–∞–π–Ω (–º–∏–≥–∞–µ—Ç –æ—Ä–∞–Ω–∂–µ–≤—ã–º)</li>
                        <li>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ: "–°–ï–ì–û–î–ù–Ø! –î–µ–Ω—å 8" ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å (–º–∏–≥–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–º)</li>
                        <li>üö® –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ: "–ü–†–û–°–†–û–ß–ï–ù–û –Ω–∞ 2–¥!" (–±—ã—Å—Ç—Ä–æ –º–∏–≥–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–º)</li>
                        <li><strong>–®—Ç—Ä–∞—Ñ: -5 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –≤ Backlog!</strong></li>
                        <li>–ü–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã (–≤—ã—Ö–æ–¥–∞ –∏–∑ Backlog) —à—Ç—Ä–∞—Ñ—ã –Ω–µ –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è</li>
                    </ul>
                </li>
                <li>–ö–∞—Ä—Ç–æ—á–∫–∏ —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ª—É—á–∞—é—Ç <strong>–ø–æ—Ç–µ—Ä–∏</strong> ‚Äî —É—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –∏—Ö!</li>
                <li>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏–Ω–æ—Å—è—Ç <strong>–æ—á–∫–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏</strong></li>
                <li><strong>–ö–Ω–æ–ø–∫–∞ "–°–ª–µ–¥ –¥–µ–Ω—å"</strong> ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é (–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–∞–π–º–µ—Ä—É)</li>
                <li><strong>‚ö†Ô∏è –ë–∞–ª–∞–Ω—Å 0</strong> ‚Äî –Ω–µ–ª—å–∑—è —Ä–∞—Å—Ö–æ–¥–æ–≤–∞—Ç—å –æ—á–∫–∏! –ó–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å–Ω–∞—á–∞–ª–∞.</li>
            </ul>
            
            <h3>üí∞ –°–∏—Å—Ç–µ–º–∞ –æ—á–∫–æ–≤</h3>
            <ul>
                <li><strong>+–ë–∞–∑–æ–≤—ã–µ –æ—á–∫–∏</strong> ‚Äî –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏: 15-45)</li>
                <li><strong>+10 –±–æ–Ω—É—Å</strong> ‚Äî –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É –±–µ–∑ –ø–æ—Ç–µ—Ä—å (–∫–∞—á–µ—Å—Ç–≤–æ)</li>
                <li><strong>-5 –æ—á–∫–æ–≤/–¥–µ–Ω—å/—á–µ–ª–æ–≤–µ–∫</strong> ‚Äî —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (—Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –¥–Ω—è)</li>
                <li><strong>-10 –æ—á–∫–æ–≤</strong> ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –≤ –∫–æ–º–∞–Ω–¥—É (—Ä–∞–∑–æ–≤–æ)</li>
                <li><strong>-15 –æ—á–∫–æ–≤</strong> ‚Äî —É–±—Ä–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –∏–∑ –∫–æ–º–∞–Ω–¥—ã (–≤—ã—Ö–æ–¥–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ)</li>
                <li><strong>-20 –æ—á–∫–æ–≤</strong> ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏</li>
                <li><strong>0 —É—Å–∏–ª–∏–π</strong> ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏–∑ Backlog –≤ —Ä–∞–±–æ—Ç—É (–Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ) üÜì</li>
                <li><strong>-2 —É—Å–∏–ª–∏—è</strong> ‚Äî –±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä—å ‚ö°</li>
                <li><strong>-7 —É—Å–∏–ª–∏–π</strong> ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –° –ø–æ—Ç–µ—Ä–µ–π (-2 –±–∞–∑–æ–≤—ã—Ö + -5 –∑–∞ –ø–æ—Ç–µ—Ä—é) ‚ö†Ô∏è</li>
                <li><strong>-5 –∑–∞ –ø–æ—Ç–µ—Ä—é</strong> ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –∫–∞–∂–¥—É—é –Ω–µ—É—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—É—é –ø–æ—Ç–µ—Ä—é –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –¥–Ω—è</li>
                <li><strong>-5 –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É</strong> ‚Äî —à—Ç—Ä–∞—Ñ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –∑–∞–¥–∞—á–∏ –≤ Backlog üö®</li>
                <li><strong>-50 –æ—á–∫–æ–≤</strong> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∫–æ–ª–æ–Ω–∫–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞). –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ: -2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π</li>
                <li><strong>-30 –æ—á–∫–æ–≤</strong> ‚Äî –±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å 5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (+ 10 –∑–∞ –∫–∞–∂–¥—É—é –ø–æ—Ç–µ—Ä—é)</li>
                <li><strong>-5 –æ—á–∫–æ–≤</strong> ‚Äî –∫–Ω–æ–ø–∫–∞ "+WIP" –Ω–∞ –∫–æ–ª–æ–Ω–∫–µ (+1 –∫ WIP –ª–∏–º–∏—Ç—É, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)</li>
                <li><strong>-5 –æ—á–∫–æ–≤</strong> ‚Äî –∫–Ω–æ–ø–∫–∞ "-WIP" –Ω–∞ –∫–æ–ª–æ–Ω–∫–µ (-1 –æ—Ç WIP –ª–∏–º–∏—Ç–∞, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)</li>
                <li><strong>-500 –æ—á–∫–æ–≤</strong> ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å 1 (20‚Üí13 —Å–µ–∫)</li>
                <li><strong>-500 –æ—á–∫–æ–≤</strong> ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å 2 (13‚Üí8 —Å–µ–∫)</li>
                <li><strong>-500 –æ—á–∫–æ–≤</strong> ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å 3 (8‚Üí5 —Å–µ–∫)</li>
                <li><strong>-500 –æ—á–∫–æ–≤</strong> ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É—Ä–æ–≤–µ–Ω—å 4 (5‚Üí3 —Å–µ–∫, –º–∞–∫—Å–∏–º—É–º!)</li>
                <li><strong>‚ö†Ô∏è –í–ê–ñ–ù–û:</strong> –ù–µ–ª—å–∑—è —Ä–∞—Å—Ö–æ–¥–æ–≤–∞—Ç—å –æ—á–∫–∏ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–µ 0! –°–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–π—Ç–µ –æ—á–∫–∏.</li>
            </ul>
            
            <div class="principle-box">
                <h4>‚ö° –ü–æ—á–µ–º—É –¥–≤–∏–∂–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏–π?</h4>
                <p><strong>Lean –ø—Ä–∏–Ω—Ü–∏–ø:</strong> –õ—é–±–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç —É—Å–∏–ª–∏–π (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è, –ø–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ). –ü–æ—Ç–µ—Ä–∏ (MUDA) —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —ç—Ç–∏ —É—Å–∏–ª–∏—è –≤ 3.5 —Ä–∞–∑–∞!<br>
                <strong>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ:</strong> –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –∏–∑ Backlog –±–µ—Å–ø–ª–∞—Ç–Ω–æ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–¥–∞—á–∏ –≤ —Ä–∞–±–æ—Ç—É.<br>
                <strong>–°—Ç—Ä–∞—Ç–µ–≥–∏—è:</strong> –£—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Ç–µ—Ä–∏ –ü–ï–†–ï–î –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º –∑–∞–¥–∞—á–∏ ‚Äî —ç—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç —É—Å–∏–ª–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–≤—ã—à–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–∞.</p>
            </div>
            
            <h3>üõ† –î–µ–π—Å—Ç–≤–∏—è</h3>
            <p><strong>üí° –í–∞–∂–Ω–æ:</strong> –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ <strong>–ö–ê–†–¢–û–ß–ö–£</strong> –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –Ω–µ–π, –∏–ª–∏ –Ω–∞ <strong>–ö–û–õ–û–ù–ö–£</strong> –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–æ–ª–æ–Ω–∫–æ–π.</p>
            
            <h4 style="color: var(--accent-blue); margin-top: 15px;">–î–µ–π—Å—Ç–≤–∏—è —Å –ö–ê–†–¢–û–ß–ö–ê–ú–ò:</h4>
            <ul>
                <li><strong>üîÑ –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ (Drag & Drop)</strong> ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ó–∞–∂–º–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –µ—ë –Ω–∞ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Ç–æ–π –∂–µ –∫–æ–ª–æ–Ω–∫–µ</li>
                        <li>–ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏</li>
                        <li>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –±—Ä–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑</li>
                        <li>üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á</li>
                    </ul>
                </li>
                <li><strong>–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</strong> ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ò–∑ Backlog: 0 —É—Å–∏–ª–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) üÜì</li>
                        <li>–ë–µ–∑ –ø–æ—Ç–µ—Ä—å: -2 —É—Å–∏–ª–∏—è ‚ö°</li>
                        <li>–° –ø–æ—Ç–µ—Ä–µ–π: -7 —É—Å–∏–ª–∏–π ‚ö†Ô∏è</li>
                    </ul>
                </li>
                <li><strong>–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é</strong> ‚Äî —É–¥–∞–ª–∏—Ç—å waste —Å –∫–∞—Ä—Ç–æ—á–∫–∏ (-20 –æ—á–∫–æ–≤). –ë–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ—à–µ–≤–ª–µ!</li>
            </ul>
            
            <h4 style="color: var(--accent-purple); margin-top: 15px;">–î–µ–π—Å—Ç–≤–∏—è —Å –ö–û–õ–û–ù–ö–ê–ú–ò (–∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É):</h4>
            <ul>
                <li><strong>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å (-50)</strong> ‚Äî –∫–æ–ª–æ–Ω–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥!
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–ö–æ–ª–æ–Ω–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∑–Ω–∞—á–∫–æ–º "ü§ñ –ê–≤—Ç–æ" (—Å–ª–µ–≤–∞ –≤–≤–µ—Ä—Ö—É)</li>
                        <li><strong>–ü–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏</strong> –∏–∑ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Å–ª–µ–¥—É—é—â—É—é</li>
                        <li>–ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç WIP –ª–∏–º–∏—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏</li>
                        <li>–ö–∞—Ä—Ç–æ—á–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (-2 —É—Å–∏–ª–∏—è, –∏–ª–∏ -7 —Å –ø–æ—Ç–µ—Ä–µ–π)</li>
                        <li><strong>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑</strong> ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏ –±–µ—Ä—É—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –∏—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è</li>
                        <li>üîÑ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</li>
                        <li>–ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥</li>
                        <li>–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥–æ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã</li>
                        <li><strong>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ 50 –æ—á–∫–æ–≤</strong> ‚Äî –∫–∞–∂–¥–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ!</li>
                        <li>‚ö†Ô∏è –ö–æ–ª–æ–Ω–∫—É "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ" –Ω–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å!</li>
                    </ul>
                </li>
                <li><strong>‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (4 —ç—Ç–∞–ø–∞ –ø–æ -500)</strong> ‚Äî —É–≤–µ–ª–∏—á–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π:
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>‚ö° –≠—Ç–∞–ø 1: -500 –æ—á–∫–æ–≤ ‚Üí 20‚Üí13 —Å–µ–∫</li>
                        <li>‚ö°‚ö° –≠—Ç–∞–ø 2: -500 –æ—á–∫–æ–≤ ‚Üí 13‚Üí8 —Å–µ–∫</li>
                        <li>‚ö°‚ö°‚ö° –≠—Ç–∞–ø 3: -500 –æ—á–∫–æ–≤ ‚Üí 8‚Üí5 —Å–µ–∫</li>
                        <li>‚ö°‚ö°‚ö°‚ö° –≠—Ç–∞–ø 4: -500 –æ—á–∫–æ–≤ ‚Üí 5‚Üí3 —Å–µ–∫ (–º–∞–∫—Å–∏–º—É–º!)</li>
                        <li>–†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å—Ä–∞–∑—É</li>
                        <li>–¢—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏</li>
                    </ul>
                </li>
                <li><strong>üßπ 5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</strong> ‚Äî —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –í–°–ï –ø–æ—Ç–µ—Ä–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ –æ–¥–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º!
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        <li>–°—Ç–æ–∏–º–æ—Å—Ç—å: 30 (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è) + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–ø–æ—Ç–µ—Ä—å √ó 10 (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)</li>
                        <li>–ü—Ä–∏–º–µ—Ä: 3 –ø–æ—Ç–µ—Ä–∏ = -30 -30 = -60 –æ—á–∫–æ–≤</li>
                        <li>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ –æ–¥–Ω–æ–π = 3√ó20 = -60 –æ—á–∫–æ–≤ (—Ç–∞ –∂–µ —Ü–µ–Ω–∞!)</li>
                        <li>5S —É–¥–æ–±–Ω–µ–µ ‚Äî –æ–¥–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º –≤–º–µ—Å—Ç–æ —Ç—Ä—ë—Ö. –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏!</li>
                    </ul>
                </li>
            </ul>
            
            <h4 style="color: var(--accent-cyan); margin-top: 15px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WIP (–∫–Ω–æ–ø–∫–∏ +WIP/-WIP –Ω–∞ –∫–æ–ª–æ–Ω–∫–∞—Ö):</h4>
            <ul>
                <li><strong>+WIP:</strong> –î–æ–±–∞–≤–∏—Ç—å +1 –∫ WIP –ª–∏–º–∏—Ç—É (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)</li>
                <li><strong>-WIP:</strong> –£–±—Ä–∞—Ç—å -1 –æ—Ç WIP –ª–∏–º–∏—Ç–∞ (-5 –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ)</li>
                <li>–ü—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏: –≤ –∫–æ–ª–æ–Ω–∫–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫–∞—Ä—Ç–æ—á–µ–∫ ‚â§ –Ω–æ–≤–æ–º—É –ª–∏–º–∏—Ç—É</li>
                <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π WIP: –Ω–µ –º–µ–Ω—å—à–µ 1 –≤ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ</li>
                <li><strong>‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ!</strong> WIP –ª–∏–º–∏—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ –¥–Ω–∏ –∏–≥—Ä—ã</li>
                <li>üí° –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –¥–µ—à–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è WIP (–≤—Å–µ–≥–æ 5 –æ—á–∫–æ–≤) –ø–æ–∑–≤–æ–ª—è—é—Ç –≥–∏–±–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫</li>
            </ul>
            
            <div class="principle-box">
                <h4>üîó –°–≤—è–∑—å —Å ITIL 4</h4>
                <p>Lean –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ ITIL 4 —á–µ—Ä–µ–∑ –ø—Ä–∏–Ω—Ü–∏–ø—ã:<br>
                ‚Ä¢ <strong>Focus on Value</strong> ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å<br>
                ‚Ä¢ <strong>Optimize and Automate</strong> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è<br>
                ‚Ä¢ <strong>Collaborate</strong> ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –∫–æ–º–∞–Ω–¥—ã<br>
                ‚Ä¢ <strong>Keep it Simple</strong> ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–ª–∏—à–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏<br>
                ‚Ä¢ <strong>Progress Iteratively</strong> ‚Äî –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ</p>
            </div>
            
            <h3>üìä –§–∏–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
            <p>–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è 21 –¥–Ω—è –≤—ã —É–≤–∏–¥–∏—Ç–µ:</p>
            <ul>
                <li><strong>–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:</strong> –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∑–∞–¥–∞—á, –ü–æ—Ç–µ—Ä—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ, Lead Time, –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç</li>
                <li><strong>CFD –¥–∏–∞–≥—Ä–∞–º–º–∞:</strong> –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ –∑–∞–¥–∞—á –∑–∞ –≤—Å—é –∏–≥—Ä—É</li>
                <li><strong>–ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞:</strong> –°—Ä–µ–¥–Ω–∏–π WIP, Throughput (–ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å), –æ—Ü–µ–Ω–∫–∞ Lead Time –∏ –∫–∞—á–µ—Å—Ç–≤–∞</li>
                <li><strong>üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏</strong> –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏–≥—Ä–µ!</li>
            </ul>
        </div>
    </div>
</div>

<!-- CFD Modal -->
<div class="modal" id="cfdModal">
    <div class="modal-box" style="max-width: 900px;">
        <div class="modal-header">
            <h2 class="modal-title">üìä Cumulative Flow Diagram (CFD)</h2>
            <button class="modal-close" onclick="closeCFD()">√ó</button>
        </div>
        <div style="padding: 20px 0;">
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9em;">
                <strong>üìà –û –¥–∏–∞–≥—Ä–∞–º–º–µ:</strong><br>
                CFD –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –≤ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ –ø–æ –¥–Ω—è–º. –¶–≤–µ—Ç–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.<br>
                <strong>üí° –ö–∞–∫ —á–∏—Ç–∞—Ç—å:</strong> –®–∏—Ä–∏–Ω–∞ –æ–±–ª–∞—Å—Ç–∏ = WIP –Ω–∞ —ç—Ç–∞–ø–µ. –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤–∏–¥–Ω—ã –∫–∞–∫ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏.
            </div>
            <canvas id="cfdCanvas" width="850" height="500" style="border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; background: var(--bg-dark);"></canvas>
        </div>
    </div>
</div>

<!-- Team Management Modal -->
<div class="modal" id="teamModal">
    <div class="modal-box" style="max-width: 500px;">
        <div class="modal-header">
            <h2 class="modal-title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π</h2>
            <button class="modal-close" onclick="closeTeamModal()">√ó</button>
        </div>
        <div style="padding: 20px 0;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 4em; margin-bottom: 10px;" id="teamSizeDisplay">5</div>
                <div style="font-size: 1.2em; color: var(--text-secondary);">–†–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã</div>
                <div style="font-size: 0.9em; color: var(--accent-orange); margin-top: 10px;" id="teamCostDisplay">
                    –°—Ç–æ–∏–º–æ—Å—Ç—å: 25 –æ—á–∫–æ–≤/–¥–µ–Ω—å
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
                <button class="btn btn-start" onclick="addTeamMember()" style="padding: 15px 30px; font-size: 1.1em;">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å (-10)
                </button>
                <button class="btn btn-reset" onclick="removeTeamMember()" style="padding: 15px 30px; font-size: 1.1em;">
                    ‚ûñ –£–±—Ä–∞—Ç—å (-15)
                </button>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; font-size: 0.9em;">
                <div style="margin-bottom: 10px;"><strong>üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã:</strong></div>
                <ul style="line-height: 1.8; padding-left: 20px;">
                    <li>–ö–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫: <strong>5 –æ—á–∫–æ–≤/–¥–µ–Ω—å</strong></li>
                    <li>–î–æ–±–∞–≤–∏—Ç—å: <strong>-10 –æ—á–∫–æ–≤</strong> —Ä–∞–∑–æ–≤–æ</li>
                    <li>–£–±—Ä–∞—Ç—å: <strong>-15 –æ—á–∫–æ–≤</strong> —Ä–∞–∑–æ–≤–æ</li>
                    <li>–°–ø–∏—Å–∞–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è</li>
                </ul>
                <div style="margin-top: 15px; padding: 10px; background: rgba(137,87,229,0.2); border-radius: 5px;">
                    <strong>‚ö° –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong><br>
                    –ë–æ–ª—å—à–µ –ª—é–¥–µ–π = –±–æ–ª—å—à–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞, –Ω–æ –¥–æ—Ä–æ–∂–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Game Over -->
<div class="game-over" id="gameOver">
    <h1>üèÜ –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h1>
    <p style="font-size:1.2em;color:var(--text-secondary);margin-bottom:20px">–í—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–∏!</p>
    <div class="final-stats">
        <div class="final-stat"><div class="final-stat-value" style="color:var(--accent-green)" id="fDelivered">0</div><div class="final-stat-label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div></div>
        <div class="final-stat"><div class="final-stat-value" style="color:var(--accent-red)" id="fWaste">0</div><div class="final-stat-label">–ü–æ—Ç–µ—Ä—å —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ</div></div>
        <div class="final-stat"><div class="final-stat-value" style="color:var(--accent-purple)" id="fLeadTime">0</div><div class="final-stat-label">Lead Time (–¥–Ω–µ–π)</div></div>
        <div class="final-stat"><div class="final-stat-value" style="color:var(--accent-cyan)" id="fEfficiency">0%</div><div class="final-stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div></div>
        <div class="final-stat"><div class="final-stat-value" style="color:var(--accent-orange)" id="fScore">0</div><div class="final-stat-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç</div></div>
    </div>
    
    <div style="margin: 30px auto; max-width: 900px;">
        <h2 style="font-family: 'Russo One', sans-serif; font-size: 1.5em; margin-bottom: 15px; color: var(--accent-cyan);">üìä Cumulative Flow Diagram</h2>
        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
            <canvas id="finalCfdCanvas" width="850" height="400" style="border-radius: 8px; background: var(--bg-dark);"></canvas>
        </div>
        <div style="background: rgba(31,111,235,0.1); border: 1px solid rgba(31,111,235,0.3); border-radius: 8px; padding: 15px; margin-top: 15px; text-align: left;">
            <div style="font-weight: 600; font-size: 0.9em; color: var(--accent-blue); margin-bottom: 8px;">üìà –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞:</div>
            <div style="font-size: 0.85em; color: var(--text-secondary); line-height: 1.6;" id="flowAnalysis">
                –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ. –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤–∏–¥–Ω—ã –∫–∞–∫ —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ—Å—è –æ–±–ª–∞—Å—Ç–∏.
            </div>
        </div>
    </div>
    
    <button class="btn btn-start" style="padding:15px 50px;font-size:1.1em;margin-top:20px" onclick="resetGame();document.getElementById('gameOver').style.display='none'">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

<script>
// –î–∞–Ω–Ω—ã–µ
const COLUMNS = ['backlog','analysis','design','develop','test','deploy','done'];
const WIP_LIMITS = {analysis:3, design:2, develop:2, test:1, deploy:2};
const CARD_TEMPLATES = [
    {title:'–ù–æ–≤—ã–π –º–æ–¥—É–ª—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', type:'feature', value:30},
    {title:'–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞', type:'bug', value:20},
    {title:'–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö', type:'improvement', value:25},
    {title:'–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM', type:'feature', value:35},
    {title:'–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä', type:'improvement', value:40},
    {title:'–ó–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å', type:'request', value:15},
    {title:'–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', type:'feature', value:45},
    {title:'–û—à–∏–±–∫–∞ –≤ —Ä–∞—Å—á—ë—Ç–∞—Ö', type:'bug', value:20},
    {title:'–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –¥–µ–ø–ª–æ—è', type:'improvement', value:30},
    {title:'–ü–æ—Ä—Ç–∞–ª —Å–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è', type:'request', value:25}
];
const WASTE_TYPES = [
    {id:'transport', name:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞', icon:'üöö', itil:'–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Value Chain ‚Äî –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞—á –º–µ–∂–¥—É –∫–æ–º–∞–Ω–¥–∞–º–∏'},
    {id:'inventory', name:'–ó–∞–ø–∞—Å—ã', icon:'üì¶', itil:'WIP –ª–∏–º–∏—Ç—ã –≤ –ø—Ä–∞–∫—Ç–∏–∫–µ Kanban ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã'},
    {id:'motion', name:'–õ–∏—à–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è', icon:'üèÉ', itil:'–ü—Ä–∏–Ω—Ü–∏–ø Optimize & Automate ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π'},
    {id:'waiting', name:'–û–∂–∏–¥–∞–Ω–∏–µ', icon:'‚è≥', itil:'Flow Management ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –ø—Ä–æ—Å—Ç–æ–µ–≤'},
    {id:'overprod', name:'–ü–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ', icon:'üìà', itil:'–ü—Ä–∏–Ω—Ü–∏–ø Focus on Value ‚Äî –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ'},
    {id:'overproc', name:'–ò–∑–ª–∏—à–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞', icon:'‚öôÔ∏è', itil:'–ü—Ä–∏–Ω—Ü–∏–ø Keep it Simple ‚Äî –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏'},
    {id:'defects', name:'–î–µ—Ñ–µ–∫—Ç—ã', icon:'‚ùå', itil:'Problem Management ‚Äî —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤—ã—Ö –ø—Ä–∏—á–∏–Ω'},
    {id:'talent', name:'–ù–µ–∏—Å–ø. –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª', icon:'üß†', itil:'–ü—Ä–∏–Ω—Ü–∏–ø Collaborate ‚Äî –≤–æ–≤–ª–µ—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ –∫–æ–º–∞–Ω–¥—ã'}
];

// –°–æ—Å—Ç–æ—è–Ω–∏–µ
let G = {
    day: 0, maxDays: 21, score: 300, wasteEliminated: 0, delivered: 0,
    cards: [], cardCounter: 0, selected: null, selectedColumn: null, running: false,
    wipLimits: {...WIP_LIMITS}, 
    baseWipLimits: {...WIP_LIMITS}, // –ë–∞–∑–æ–≤—ã–µ WIP –ª–∏–º–∏—Ç—ã –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    automated: {},
    automationSpeed: 20, // –°–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (20 -> 13 -> 8 -> 5 -> 3)
    dayTimeLeft: 120, // 2 –º–∏–Ω—É—Ç—ã –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    timerInterval: null,
    teamSize: 5, // –†–∞–∑–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã (—á–µ–ª–æ–≤–µ–∫)
    teamDailyCost: 5, // –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ –¥–µ–Ω—å
    cfdData: [] // –î–∞–Ω–Ω—ã–µ –¥–ª—è CFD –¥–∏–∞–≥—Ä–∞–º–º—ã (—Å–Ω–∏–º–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ –¥–Ω—è–º)
};

// –£—Ç–∏–ª–∏—Ç—ã
function rnd(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
function rndInt(min,max) { return Math.floor(Math.random()*(max-min+1))+min; }

// –ë—Ä–æ—Å–æ–∫ 2d6 (–¥–≤–∞ —à–µ—Å—Ç–∏–≥—Ä–∞–Ω–Ω—ã—Ö –∫—É–±–∏–∫–∞)
function roll2d6() {
    return rndInt(1, 6) + rndInt(1, 6);
}

// –†–∞—Å—á–µ—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è —Ñ–æ–∫—É—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ WIP –∏ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã
function calculateFocusMultiplier() {
    // WIP = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ —Ä–∞–±–æ—Ç–µ (—Å —Ç–∞–π–º–µ—Ä–æ–º), –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç–∞—Ç—É—Å–∞ –ê–Ω–∞–ª–∏–∑
    // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏ –≤ —Ä–∞–±–æ—á–∏—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–π–º–µ—Ä (isProcessing)
    const wip = G.cards.filter(c => {
        return c.column !== 'backlog' && c.column !== 'done' && c.isProcessing;
    }).length;
    
    // –ú–Ω–æ–∂–∏—Ç–µ–ª—å = (WIP / teamSize)^1.5
    // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å = 0.1 (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 0)
    const ratio = Math.max(wip, 1) / G.teamSize;
    const multiplier = Math.pow(ratio, 1.5);
    
    return {
        wip: wip,
        multiplier: multiplier
    };
}

function log(msg, type='info') {
    const el = document.getElementById('log');
    const e = document.createElement('div');
    e.className = `log-entry ${type}`;
    e.textContent = `–î–µ–Ω—å ${G.day}: ${msg}`;
    el.insertBefore(e, el.firstChild);
    while(el.children.length > 30) el.removeChild(el.lastChild);
}

function updateStats() {
    const total = G.cards.filter(c=>c.column!=='done').length;
    const withWaste = G.cards.filter(c=>c.waste && c.column!=='done').length;
    const eff = total > 0 ? Math.round((1 - withWaste/Math.max(total,1))*100) : 100;
    
    document.getElementById('efficiency').textContent = eff + '%';
    document.getElementById('wasteCount').textContent = G.wasteEliminated;
    document.getElementById('teamSize').textContent = G.teamSize;
    
    // Update WIP and focus multiplier
    const focusData = calculateFocusMultiplier();
    document.getElementById('wipStat').textContent = `${focusData.wip}/${G.teamSize}`;
    document.getElementById('focusMultiplier').textContent = focusData.multiplier.toFixed(2);
    
    const scoreEl = document.getElementById('score');
    scoreEl.textContent = G.score;
    // Color score based on balance
    if (G.score <= 0) {
        scoreEl.style.color = 'var(--accent-red)';
    } else if (G.score < 10) {
        scoreEl.style.color = 'var(--accent-orange)';
    } else {
        scoreEl.style.color = 'var(--accent-cyan)';
    }
    
    document.getElementById('day').textContent = `–î–µ–Ω—å ${G.day}`;
    
    // Update timer
    const minutes = Math.floor(G.dayTimeLeft / 60);
    const seconds = G.dayTimeLeft % 60;
    const timerEl = document.getElementById('timer');
    timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    // Color timer based on time left
    if (G.dayTimeLeft <= 30) {
        timerEl.style.color = 'var(--accent-red)';
    } else if (G.dayTimeLeft <= 60) {
        timerEl.style.color = 'var(--accent-orange)';
    } else {
        timerEl.style.color = 'var(--text-primary)';
    }
    
    // Update column counts
    COLUMNS.forEach(col => {
        const count = G.cards.filter(c=>c.column===col).length;
        document.getElementById(`count-${col}`).textContent = count;
        if(G.wipLimits[col]) {
            const wipEl = document.getElementById(`wip-${col}`);
            wipEl.textContent = `WIP: ${G.wipLimits[col]}`;
            
            if (count > G.wipLimits[col]) {
                wipEl.className = 'column-wip exceeded';
            } else {
                wipEl.className = 'column-wip';
            }
        }
    });
}

function updateButtons() {
    const s = G.selected;
    const col = G.selectedColumn;
    
    const btnMove = document.getElementById('btnMove');
    const btnEliminate = document.getElementById('btnEliminate');
    const btnAutomate = document.getElementById('btnAutomate');
    const btn5S = document.getElementById('btn5S');
    const btnSpeedUp = document.getElementById('btnSpeedUp');
    
    // Update panel title
    const panelTitle = document.querySelector('.panel-section .panel-title');
    if (col) {
        panelTitle.textContent = `üéØ –î–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–ª–æ–Ω–∫–æ–π: ${col}`;
    } else if (s) {
        panelTitle.textContent = 'üéØ –î–µ–π—Å—Ç–≤–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π';
    } else {
        panelTitle.textContent = 'üéØ –î–µ–π—Å—Ç–≤–∏—è';
    }
    
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–ª–æ–Ω–∫–æ–π
    if (col) {
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
        btnMove.style.display = 'none';
        btnEliminate.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫
        btnAutomate.style.display = 'flex';
        btn5S.style.display = 'flex';
        btnSpeedUp.style.display = 'flex';
        
        // Automate button
        const isAutomated = G.automated[col];
        const isDeployColumn = col === 'deploy';
        const automationCost = 50; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        
        btnAutomate.disabled = G.score < automationCost || isAutomated || isDeployColumn || col === 'backlog' || col === 'done';
        
        if (isDeployColumn) {
            btnAutomate.innerHTML = `<span class="icon">üö´</span><span class="text">–í–Ω–µ–¥—Ä–µ–Ω–∏–µ</span><span class="cost">–ù–µ–ª—å–∑—è –∞–≤—Ç–æ</span>`;
        } else if (isAutomated) {
            btnAutomate.innerHTML = `<span class="icon">‚úÖ</span><span class="text">–£–∂–µ –∞–≤—Ç–æ</span><span class="cost">–ê–∫—Ç–∏–≤–Ω–æ</span>`;
        } else if (col === 'backlog' || col === 'done') {
            btnAutomate.innerHTML = `<span class="icon">üö´</span><span class="text">–ù–µ–ª—å–∑—è</span><span class="cost">–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</span>`;
        } else {
            btnAutomate.innerHTML = `<span class="icon">ü§ñ</span><span class="text">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span><span class="cost">-${automationCost} –æ—á–∫–æ–≤</span>`;
        }
        
        // 5S button
        const wastesInColumn = G.cards.filter(c=>c.column===col && c.waste).length;
        const cost5S = 30 + (wastesInColumn * 10);
        btn5S.disabled = G.score < cost5S || wastesInColumn === 0 || col === 'backlog' || col === 'done';
        if (col === 'backlog' || col === 'done') {
            btn5S.innerHTML = `<span class="icon">üö´</span><span class="text">–ù–µ–ª—å–∑—è</span><span class="cost">–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ</span>`;
        } else {
            btn5S.innerHTML = `<span class="icon">üßπ</span><span class="text">5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</span><span class="cost">-${cost5S} (${wastesInColumn} –ø–æ—Ç–µ—Ä—å)</span>`;
        }
        
        // Speed up button (4 —ç—Ç–∞–ø–∞: 20‚Üí13‚Üí8‚Üí5‚Üí3)
        const hasAutomation = Object.keys(G.automated).length > 0;
        const speedLevels = {
            20: { cost: 500, to: 13, icon: '‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 1' },
            13: { cost: 500, to: 8, icon: '‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 2' },
            8: { cost: 500, to: 5, icon: '‚ö°‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 3' },
            5: { cost: 500, to: 3, icon: '‚ö°‚ö°‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 4' }
        };
        
        const currentSpeedLevel = speedLevels[G.automationSpeed];
        
        if (currentSpeedLevel) {
            btnSpeedUp.disabled = !hasAutomation || G.score < currentSpeedLevel.cost;
            btnSpeedUp.innerHTML = `<span class="icon">${currentSpeedLevel.icon}</span><span class="text">${currentSpeedLevel.text}</span><span class="cost">${hasAutomation ? `-${currentSpeedLevel.cost} ‚Üí ${currentSpeedLevel.to} —Å–µ–∫` : '–ù—É–∂–Ω–∞ –∞–≤—Ç–æ'}</span>`;
        } else {
            btnSpeedUp.disabled = true;
            btnSpeedUp.innerHTML = `<span class="icon">‚úÖ</span><span class="text">–ú–∞–∫—Å —Å–∫–æ—Ä–æ—Å—Ç—å</span><span class="cost">3 —Å–µ–∫</span>`;
        }
        
    } 
    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π
    else if (s) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫
        btnMove.style.display = 'flex';
        btnEliminate.style.display = 'flex';
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫
        btnAutomate.style.display = 'none';
        btn5S.style.display = 'none';
        btnSpeedUp.style.display = 'none';
        
        const hasWaste = s.waste;
        
        // Calculate move cost
        let moveCost = 0;
        if (s.column !== 'backlog') {
            moveCost = 2;
            if (hasWaste) moveCost += 5;
        }
        
        const isCardReady = s.column === 'backlog' || s.isReady;
        const canMove = s.column !== 'done' && isCardReady && (s.column === 'backlog' || G.score >= moveCost);
        
        btnMove.disabled = !canMove;
        if (s.column !== 'done') {
            let costText = '';
            if (s.column === 'backlog') {
                costText = `<span class="cost" style="color: white">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</span>`;
            } else if (!s.isReady && s.processingStartTime) {
                const elapsed = Math.floor((Date.now() - s.processingStartTime) / 1000);
                const remaining = Math.max(0, s.processingTime - elapsed);
                costText = `<span class="cost" style="color: var(--accent-orange)">‚è±Ô∏è –ñ–¥–∏—Ç–µ ${remaining}—Å</span>`;
            } else if (G.score < moveCost) {
                costText = `<span class="cost" style="color: var(--accent-red)">–ù—É–∂–Ω–æ ${moveCost} –æ—á–∫–æ–≤! ‚ùå</span>`;
            } else {
                costText = hasWaste 
                    ? `<span class="cost" style="color: var(--accent-red)">-${moveCost} —É—Å–∏–ª–∏–π ‚ö†Ô∏è</span>` 
                    : `<span class="cost" style="color: white">-${moveCost} —É—Å–∏–ª–∏–π</span>`;
            }
            btnMove.innerHTML = `<span class="icon">‚û°Ô∏è</span><span class="text">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å</span>${costText}`;
        }
        
        btnEliminate.disabled = !hasWaste || G.score < 20;
    }
    // –ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ - —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
    else {
        btnMove.disabled = true;
        btnEliminate.disabled = true;
        btnAutomate.disabled = true;
        btn5S.disabled = true;
        btnSpeedUp.disabled = true;
    }
}

function showItilTip(text) {
    document.getElementById('itilTip').innerHTML = `<div class="itil-title">üîó –°–≤—è–∑—å —Å ITIL 4</div><div class="itil-text">${text}</div>`;
}

function showScoreAnimation(text) {
    const scoreEl = document.getElementById('score');
    const rect = scoreEl.getBoundingClientRect();
    
    const popup = document.createElement('div');
    popup.style.position = 'fixed';
    popup.style.left = rect.left + 'px';
    popup.style.top = rect.top + 'px';
    popup.style.fontSize = '2em';
    popup.style.fontWeight = 'bold';
    popup.style.color = text.startsWith('+') ? 'var(--accent-green)' : 'var(--accent-red)';
    popup.style.zIndex = '3000';
    popup.style.pointerEvents = 'none';
    popup.style.animation = 'floatUp 1s ease-out';
    popup.textContent = text;
    
    document.body.appendChild(popup);
    
    setTimeout(() => popup.remove(), 1000);
}

function showToast(title, message, type = 'warning', duration = 5000) {
    // Remove existing toasts
    document.querySelectorAll('.toast').forEach(t => t.remove());
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="toast-header">
            <div class="toast-title">${title}</div>
            <button class="toast-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
        </div>
        <div class="toast-body">${message}</div>
    `;
    
    document.body.appendChild(toast);
    
    if (duration > 0) {
        setTimeout(() => {
            if (toast.parentElement) {
                toast.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }
        }, duration);
    }
}

// Add animation CSS
const style = document.createElement('style');
style.textContent = `
    @keyframes floatUp {
        0% { opacity: 0; transform: translateY(0); }
        50% { opacity: 1; transform: translateY(-30px); }
        100% { opacity: 0; transform: translateY(-60px); }
    }
`;
document.head.appendChild(style);

// Cards
function createCard() {
    G.cardCounter++;
    const tpl = rnd(CARD_TEMPLATES);
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏: –º–∏–Ω–∏–º—É–º —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å, –º–∞–∫—Å–∏–º—É–º –¥–µ–Ω—å 20
    const minDeliveryDay = G.day + 1;
    const maxDeliveryDay = 20;
    const deliveryDay = rndInt(minDeliveryDay, Math.min(maxDeliveryDay, G.maxDays));
    
    const card = {
        id: G.cardCounter,
        title: tpl.title,
        type: tpl.type,
        value: tpl.value,
        column: 'backlog',
        waste: Math.random() < 0.4 ? rnd(WASTE_TYPES) : null,
        daysInColumn: 0,
        processingTime: 0, // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –∏–∑ backlog
        processingStartTime: null,
        isProcessing: false,
        isReady: true, // –í backlog –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é
        urgency: deliveryDay, // –î–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏ (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–µ–Ω—å)
        createdDay: G.day, // –î–µ–Ω—å —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        order: G.cardCounter // –ü–æ—Ä—è–¥–æ–∫ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ
    };
    G.cards.push(card);
    return card;
}

function updateColumnVisuals() {
    // Update automated columns visual indication and selected state
    COLUMNS.forEach(col => {
        const columnEl = document.querySelector(`[data-col="${col}"]`);
        if (columnEl) {
            if (G.automated[col]) {
                columnEl.classList.add('automated');
            } else {
                columnEl.classList.remove('automated');
            }
            
            // Update selected state
            if (G.selectedColumn === col) {
                columnEl.classList.add('selected');
            } else {
                columnEl.classList.remove('selected');
            }
        }
    });
}

function selectColumn(column) {
    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–∞—Ä—Ç–æ—á–∫–∏
    G.selected = null;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
    if (G.selectedColumn === column) {
        G.selectedColumn = null;
    } else {
        G.selectedColumn = column;
    }
    
    renderCards();
    updateColumnVisuals();
    updateButtons();
    
    if (G.selectedColumn) {
        const col = G.selectedColumn;
        const isAutomated = G.automated[col];
        const wastesInColumn = G.cards.filter(c=>c.column===col && c.waste).length;
        const cardsCount = G.cards.filter(c=>c.column===col).length;
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ WIP –∏ —Ñ–æ–∫—É—Å–µ
        const focusData = calculateFocusMultiplier();
        
        let tip = `<strong>–ö–æ–ª–æ–Ω–∫–∞: ${col}</strong><br>`;
        tip += `–ö–∞—Ä—Ç–æ—á–µ–∫: ${cardsCount}`;
        if (G.wipLimits[col]) {
            tip += ` / WIP –ª–∏–º–∏—Ç: ${G.wipLimits[col]}`;
        }
        tip += `<br>‚ö° <strong>–¢–µ–∫—É—â–∏–π WIP:</strong> ${focusData.wip}/${G.teamSize} (–º–Ω–æ–∂–∏—Ç–µ–ª—å —Ñ–æ–∫—É—Å–∞: √ó${focusData.multiplier.toFixed(2)})<br><br>`;
        
        // Automation info
        if (isAutomated) {
            tip += `ü§ñ <strong>–ö–æ–ª–æ–Ω–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!</strong><br>–í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –∫–∞–∂–¥—ã–µ ${G.automationSpeed} —Å–µ–∫ (-2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π).<br>–ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç WIP –ª–∏–º–∏—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏.<br>–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –ø–æ –ø–æ—Ä—è–¥–∫—É.<br><br>üí° <strong>–£—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Ç–µ—Ä–∏!</strong> –û–Ω–∏ –¥–µ–ª–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –¥–æ—Ä–æ–∂–µ.<br><br>üîÑ <strong>–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:</strong> –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏.<br><br>`;
        } else if (col === 'deploy') {
            tip += 'üö´ <strong>–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å!</strong><br><br>';
        } else if (col !== 'backlog' && col !== 'done') {
            tip += `ü§ñ <strong>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (-50):</strong> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –í–°–ï–• –≥–æ—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–∞–∂–¥—ã–µ ${G.automationSpeed} —Å–µ–∫ (-2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π).<br>–ü–µ—Ä–µ–Ω–æ—Å –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è WIP –ª–∏–º–∏—Ç–∞.<br>–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.<br><br>`;
        }
        
        // Priority info for all non-done columns
        if (col !== 'done' && cardsCount > 1) {
            tip += `üîÑ <strong>–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:</strong> –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ (Drag & Drop).<br><br>`;
        }
        
        // Speed up info (4 —ç—Ç–∞–ø–∞: 20‚Üí13‚Üí8‚Üí5‚Üí3)
        if (Object.keys(G.automated).length > 0) {
            const speedInfo = {
                20: { icon: '‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 1 (-500)', next: '13 —Å–µ–∫' },
                13: { icon: '‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 2 (-500)', next: '8 —Å–µ–∫' },
                8: { icon: '‚ö°‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 3 (-500)', next: '5 —Å–µ–∫' },
                5: { icon: '‚ö°‚ö°‚ö°‚ö°', text: '–£—Å–∫–æ—Ä–µ–Ω–∏–µ 4 (-500)', next: '3 —Å–µ–∫' }
            };
            
            const currentInfo = speedInfo[G.automationSpeed];
            if (currentInfo) {
                tip += `${currentInfo.icon} <strong>${currentInfo.text}:</strong> –£—Å–∫–æ—Ä–∏—Ç—å –≤—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–æ ${currentInfo.next}.<br><br>`;
            } else {
                tip += `‚úÖ <strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:</strong> –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫.<br><br>`;
            }
        }
        
        // 5S info
        if (wastesInColumn > 0 && col !== 'backlog' && col !== 'done') {
            const cost5S = 30 + (wastesInColumn * 10);
            tip += `üßπ <strong>5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (-${cost5S}):</strong> –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –í–°–ï ${wastesInColumn} –ø–æ—Ç–µ—Ä—å –≤ –∫–æ–ª–æ–Ω–∫–µ.<br><br>`;
        }
        
        showItilTip(tip);
    }
}

function renderCards() {
    COLUMNS.forEach(col => {
        const container = document.getElementById(`col-${col}`);
        container.innerHTML = '';
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É (order) –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
        const cardsInColumn = G.cards.filter(c=>c.column===col).sort((a, b) => a.order - b.order);
        cardsInColumn.forEach(card => {
            const el = document.createElement('div');
            let cardClasses = `card ${card.waste ? 'has-waste' : ''} ${G.selected?.id===card.id ? 'selected' : ''}`;
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ (–Ω–µ backlog, –Ω–µ done)
            const isWorkColumn = card.column !== 'backlog' && card.column !== 'done';
            if (card.isProcessing && isWorkColumn) cardClasses += ' card-processing';
            if (card.isReady && isWorkColumn) cardClasses += ' card-ready';
            el.className = cardClasses;
            el.onclick = (e) => selectCard(card, e);
            
            // Drag and drop –¥–ª—è —É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏—è
            el.draggable = true;
            el.dataset.cardId = card.id;
            
            el.ondragstart = (e) => {
                e.stopPropagation();
                el.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', card.id);
            };
            
            el.ondragend = (e) => {
                el.classList.remove('dragging');
                document.querySelectorAll('.card').forEach(c => c.classList.remove('drag-over'));
            };
            
            el.ondragover = (e) => {
                e.preventDefault();
                e.stopPropagation();
                e.dataTransfer.dropEffect = 'move';
                const dragging = document.querySelector('.dragging');
                if (dragging && dragging !== el) {
                    el.classList.add('drag-over');
                }
            };
            
            el.ondragleave = (e) => {
                el.classList.remove('drag-over');
            };
            
            el.ondrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                el.classList.remove('drag-over');
                
                const draggedId = parseInt(e.dataTransfer.getData('text/plain'));
                const draggedCard = G.cards.find(c => c.id === draggedId);
                const targetCard = card;
                
                // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏
                if (draggedCard && targetCard && draggedCard.column === targetCard.column && draggedCard.id !== targetCard.id) {
                    // –ú–µ–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫
                    const tempOrder = draggedCard.order;
                    draggedCard.order = targetCard.order;
                    targetCard.order = tempOrder;
                    
                    log(`üîÑ –ò–∑–º–µ–Ω–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: TASK-${String(draggedCard.id).padStart(3,'0')} –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞`, 'info');
                    renderCards();
                    updateColumnVisuals();
                }
            };
            
            let wasteHtml = '';
            if(card.waste) {
                wasteHtml = `<span class="card-waste-indicator">${card.waste.icon}</span>
                    <div class="waste-badge waste-${card.waste.id}">${card.waste.icon} ${card.waste.name}</div>`;
            }
            
            // Processing status badge (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –∫–æ–ª–æ–Ω–æ–∫, –Ω–µ backlog –∏ –Ω–µ done)
            let processingHtml = '';
            
            if (card.isProcessing && isWorkColumn) {
                const elapsed = Math.floor((Date.now() - card.processingStartTime) / 1000);
                const remaining = Math.max(0, card.processingTime - elapsed);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è –∏ –º–Ω–æ–∂–∏—Ç–µ–ª—å –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                let detailsText = '';
                if (card.baseProcessingTime && card.focusMultiplier) {
                    const baseTime = card.baseProcessingTime;
                    const multiplier = card.focusMultiplier.toFixed(2);
                    detailsText = ` (${baseTime}√ó${multiplier})`;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π WIP –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                const focusData = calculateFocusMultiplier();
                const wipInfo = `WIP: ${focusData.wip}/${G.teamSize}`;
                
                processingHtml = `<div class="processing-badge" title="${wipInfo}, –ú–Ω–æ–∂–∏—Ç–µ–ª—å: √ó${focusData.multiplier.toFixed(2)}">‚è±Ô∏è ${remaining}—Å${detailsText}</div>`;
            } else if (card.isReady && isWorkColumn) {
                processingHtml = `<div class="ready-badge">‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–Ω–æ—Å—É</div>`;
            }
            
            // Urgency badge (–¥–ª—è –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –∫—Ä–æ–º–µ done)
            let urgencyHtml = '';
            if (card.column !== 'done') {
                const currentDay = G.day || 1; // –¢–µ–∫—É—â–∏–π –¥–µ–Ω—å –∏–≥—Ä—ã
                const daysLeft = card.urgency - currentDay;
                let urgencyClass = 'urgency-normal';
                let urgencyIcon = 'üìã';
                let urgencyText = `–ü–æ—Å—Ç–∞–≤–∫–∞: –¥–µ–Ω—å ${card.urgency}`;
                
                if (daysLeft < 0) {
                    // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
                    const overdueDays = Math.abs(daysLeft);
                    urgencyClass = 'urgency-overdue';
                    urgencyIcon = 'üö®';
                    urgencyText = `–ü–†–û–°–†–û–ß–ï–ù–û –Ω–∞ ${overdueDays}–¥!`;
                } else if (daysLeft === 0) {
                    // –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å
                    urgencyClass = 'urgency-critical';
                    urgencyIcon = '‚ö†Ô∏è';
                    urgencyText = `–°–ï–ì–û–î–ù–Ø! –î–µ–Ω—å ${card.urgency}`;
                } else if (daysLeft === 1) {
                    // –ó–∞–≤—Ç—Ä–∞
                    urgencyClass = 'urgency-warning';
                    urgencyIcon = '‚è∞';
                    urgencyText = `–ó–ê–í–¢–†–ê! –î–µ–Ω—å ${card.urgency}`;
                } else if (daysLeft <= 2) {
                    // –û—Å—Ç–∞–ª–æ—Å—å 2 –¥–Ω—è
                    urgencyClass = 'urgency-warning';
                    urgencyIcon = '‚è∞';
                    urgencyText = `–ß–µ—Ä–µ–∑ ${daysLeft}–¥ (–¥–µ–Ω—å ${card.urgency})`;
                } else {
                    urgencyText = `–ü–æ—Å—Ç–∞–≤–∫–∞: –¥–µ–Ω—å ${card.urgency}`;
                }
                
                urgencyHtml = `<div class="urgency-badge ${urgencyClass}">${urgencyIcon} ${urgencyText}</div>`;
            }
            
            // Calculate move cost for display
            let moveCostHtml = '';
            if (card.column !== 'done' && card.column !== 'backlog') {
                let moveCost = 2;
                if (card.waste) moveCost += 5;
                const moveCostColor = card.waste ? 'var(--accent-red)' : 'var(--text-secondary)';
                moveCostHtml = `<span class="card-effort" style="color: ${moveCostColor}">‚ö° ${moveCost}</span>`;
            } else if (card.column === 'backlog') {
                // –í backlog –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ
                moveCostHtml = `<span class="card-effort" style="color: white">‚ö° 0</span>`;
            }
            
            el.innerHTML = `
                <div class="card-id">TASK-${String(card.id).padStart(3,'0')}</div>
                <div class="card-title">${card.title}</div>
                <span class="card-type type-${card.type}">${card.type}</span>
                ${wasteHtml}
                ${urgencyHtml}
                ${processingHtml}
                <div class="card-footer">
                    <span class="card-value">üíé ${card.value}</span>
                    ${moveCostHtml}
                    <span class="card-time">üìÖ ${card.daysInColumn}–¥</span>
                </div>
            `;
            container.appendChild(el);
        });
    });
}

function selectCard(card, event) {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è —á—Ç–æ–±—ã –Ω–µ –≤—ã–±–∏—Ä–∞–ª–∞—Å—å –∫–æ–ª–æ–Ω–∫–∞
    if (event) {
        event.stopPropagation();
    }
    
    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–æ–ª–æ–Ω–∫–∏
    G.selectedColumn = null;
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    G.selected = G.selected?.id === card.id ? null : card;
    renderCards();
    updateColumnVisuals();
    updateButtons();
    
    if(G.selected) {
        const col = G.selected.column;
        const isAutomated = G.automated[col];
        const wastesInColumn = G.cards.filter(c=>c.column===col && c.waste).length;
        
        let tip = '';
        
        if (G.selected.column === 'backlog') {
            const currentDay = G.day || 1;
            const daysLeft = G.selected.urgency - currentDay;
            let urgencyInfo = '';
            
            if (daysLeft < 0) {
                const overdueDays = Math.abs(daysLeft);
                const penalty = overdueDays * 5;
                urgencyInfo = `<br><br>üö® <strong>–ü–†–û–°–†–û–ß–ï–ù–û –Ω–∞ ${overdueDays} –¥–Ω–µ–π!</strong><br>–ü–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –±—ã—Ç—å –≤ –¥–µ–Ω—å ${G.selected.urgency}, —Å–µ–π—á–∞—Å –¥–µ–Ω—å ${currentDay}.<br>–¢–µ–∫—É—â–∏–π —à—Ç—Ä–∞—Ñ: -${penalty} –æ—á–∫–æ–≤. –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å +5 –∫ —à—Ç—Ä–∞—Ñ—É.<br><br>‚ö†Ô∏è <strong>–°–†–û–ß–ù–û –Ω–∞—á–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É!</strong>`;
            } else if (daysLeft === 0) {
                urgencyInfo = `<br><br>‚ö†Ô∏è <strong>–ü–û–°–¢–ê–í–ö–ê –°–ï–ì–û–î–ù–Ø!</strong><br>–ù—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –¥–µ–Ω—å ${G.selected.urgency}.<br>–ó–∞–≤—Ç—Ä–∞ –Ω–∞—á–Ω–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ -5 –æ—á–∫–æ–≤ –∑–∞ –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏!`;
            } else if (daysLeft === 1) {
                urgencyInfo = `<br><br>‚è∞ <strong>–ü–û–°–¢–ê–í–ö–ê –ó–ê–í–¢–†–ê!</strong><br>–ù—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –¥–µ–Ω—å ${G.selected.urgency}.<br>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Å—Ä–æ—á–Ω–æ –≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É.`;
            } else if (daysLeft <= 3) {
                urgencyInfo = `<br><br>‚è∞ <strong>–ß–µ—Ä–µ–∑ ${daysLeft} –¥–Ω–µ–π</strong><br>–ü–æ—Å—Ç–∞–≤–∫–∞ –≤ –¥–µ–Ω—å ${G.selected.urgency}.<br>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤–∑—è—Ç—å –∑–∞–¥–∞—á—É –≤ —Ä–∞–±–æ—Ç—É –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.`;
            } else {
                urgencyInfo = `<br><br>üìã <strong>–ü–æ—Å—Ç–∞–≤–∫–∞:</strong> –¥–µ–Ω—å ${G.selected.urgency} (—á–µ—Ä–µ–∑ ${daysLeft} –¥–Ω–µ–π).`;
            }
            
            if (G.selected.waste) {
                tip = `üì• <strong>–ó–∞–¥–∞—á–∞ –≤ Backlog —Å –ø–æ—Ç–µ—Ä–µ–π</strong><br>–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ (0 —É—Å–∏–ª–∏–π), –Ω–æ –ø–æ—Ç–µ—Ä—è –±—É–¥–µ—Ç –º–µ—à–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —ç—Ç–∞–ø–∞—Ö.${urgencyInfo}<br><br>üí° <strong>–°–æ–≤–µ—Ç:</strong> –ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–µ–π—á–∞—Å –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é –ø–æ–∑–∂–µ (-20 –æ—á–∫–æ–≤), –∏–ª–∏ –¥–≤–∏–≥–∞—Ç—å —Å –ø–æ—Ç–µ—Ä–µ–π –∑–∞ -7 —É—Å–∏–ª–∏–π.`;
            } else {
                tip = `üì• <strong>–ó–∞–¥–∞—á–∞ –≤ Backlog –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ</strong><br>–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã: 0 —É—Å–∏–ª–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω–æ).${urgencyInfo}<br><br>–ù–∞–∂–º–∏—Ç–µ "–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –∑–∞–¥–∞—á–µ–π.`;
            }
        } else if(G.selected.waste) {
            const moveCost = 7;
            if (G.score < moveCost) {
                tip = `‚ùå <strong>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!</strong><br>–î–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω—É–∂–Ω–æ ${moveCost} –æ—á–∫–æ–≤, –∞ —É –≤–∞—Å: ${G.score}.<br><br>‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ 3.5 —Ä–∞–∑–∞!<br><br>üí° <strong>–°–æ–≤–µ—Ç:</strong> –î–æ—Å—Ç–∞–≤—å—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏–ª–∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç–µ –ø–æ—Ç–µ—Ä–∏ –≤ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á–∞—Ö, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—á–∫–∏.`;
            } else {
                tip = `‚ö†Ô∏è <strong>–ü–æ—Ç–µ—Ä—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Å–∏–ª–∏—è!</strong><br>–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å—Ç–æ–∏—Ç—å -${moveCost} —É—Å–∏–ª–∏–π –≤–º–µ—Å—Ç–æ -2.<br><br>${G.selected.waste.itil}<br><br>üí° <strong>–°–æ–≤–µ—Ç:</strong> –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ (-20), –∑–∞—Ç–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (-2) = -22 –æ—á–∫–æ–≤ –ø—Ä–æ—Ç–∏–≤ -7 –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø–æ—Ç–µ—Ä–µ–π. –≠–∫–æ–Ω–æ–º–∏—è: 15 –æ—á–∫–æ–≤ –Ω–∞ –¥–æ–ª–≥–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏!`;
            }
        } else {
            const moveCost = 2;
            if (G.score < moveCost) {
                tip = `‚ùå <strong>–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!</strong><br>–î–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω—É–∂–Ω–æ ${moveCost} –æ—á–∫–∞, –∞ —É –≤–∞—Å: ${G.score}.<br><br>üí° <strong>–°–æ–≤–µ—Ç:</strong> –î–æ—Å—Ç–∞–≤—å—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∏–ª–∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç–µ –ø–æ—Ç–µ—Ä–∏ (+20), —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å –æ—á–∫–∏.`;
            } else {
                tip = '‚úÖ <strong>–ó–∞–¥–∞—á–∞ –±–µ–∑ –ø–æ—Ç–µ—Ä—å</strong> ‚Äî –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å—Ç–æ–∏—Ç –≤—Å–µ–≥–æ -2 —É—Å–∏–ª–∏—è.<br><br>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏. –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–∞–∫—Ç–∏–∫–æ–π ITIL 4.';
            }
        }
        
        // Info about column
        const cardsInColumn = G.cards.filter(c=>c.column===col).length;
        if (cardsInColumn > 1) {
            tip += `<br><br>üîÑ <strong>–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:</strong> –í –∫–æ–ª–æ–Ω–∫–µ ${cardsInColumn} –∑–∞–¥–∞—á. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏.`;
        }
        
        if (isAutomated) {
            tip += `<br><br>ü§ñ <strong>–ö–æ–ª–æ–Ω–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!</strong> –í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ ${G.automationSpeed} —Å–µ–∫ (—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, -2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π) –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è WIP –ª–∏–º–∏—Ç–∞.`;
        }
        
        if (wastesInColumn > 0) {
            tip += `<br><br>üí° <strong>–ü–æ—Ç–µ—Ä—å –≤ –∫–æ–ª–æ–Ω–∫–µ:</strong> ${wastesInColumn}. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–æ–ª–æ–Ω–∫—É –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –Ω–µ–π (5S, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è).`;
        }
        
        showItilTip(tip);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π
        checkCardActions(G.selected);
    }
}

function checkCardActions(card) {
    if (!card || !G.running) return;
    
    const col = card.column;
    
    // –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ Done - –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
    if (col === 'done') {
        showToast(
            '‚úÖ –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞',
            '–≠—Ç–∞ –∑–∞–¥–∞—á–∞ —É–∂–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞. –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω—ã.',
            'info',
            3000
        );
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
    let availableActions = [];
    let blockedReasons = [];
    
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è
    if (col === 'backlog') {
        // –ò–∑ backlog –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
        availableActions.push('–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å');
    } else {
        const moveCost = 2 + (card.waste ? 5 : 0);
        
        if (!card.isReady) {
            const elapsed = card.processingStartTime ? Math.floor((Date.now() - card.processingStartTime) / 1000) : 0;
            const remaining = Math.max(0, card.processingTime - elapsed);
            blockedReasons.push(`‚è±Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ (–æ—Å—Ç–∞–ª–æ—Å—å ${remaining}—Å)`);
        } else if (G.score < moveCost) {
            blockedReasons.push(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (–Ω—É–∂–Ω–æ ${moveCost}, –µ—Å—Ç—å ${G.score})`);
        } else {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º WIP –ª–∏–º–∏—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏
            const idx = COLUMNS.indexOf(col);
            const nextCol = COLUMNS[idx + 1];
            if (nextCol && G.wipLimits[nextCol]) {
                const count = G.cards.filter(c=>c.column===nextCol).length;
                if (count >= G.wipLimits[nextCol]) {
                    blockedReasons.push(`üö´ WIP –ª–∏–º–∏—Ç –≤ "${nextCol}" –ø—Ä–µ–≤—ã—à–µ–Ω (${count}/${G.wipLimits[nextCol]})`);
                } else {
                    availableActions.push('–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å');
                }
            } else {
                availableActions.push('–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å');
            }
        }
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏
    if (card.waste) {
        if (G.score >= 20) {
            availableActions.push('—É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é');
        } else {
            blockedReasons.push(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏ (–Ω—É–∂–Ω–æ 20, –µ—Å—Ç—å ${G.score})`);
        }
    }
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
    if (availableActions.length === 0 && blockedReasons.length > 0) {
        const title = '‚ö†Ô∏è –î–µ–π—Å—Ç–≤–∏—è —Å –∫–∞—Ä—Ç–æ—á–∫–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã';
        const message = `<strong>–° —ç—Ç–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π –ø–æ–∫–∞ –Ω–µ–ª—å–∑—è —Å–æ–≤–µ—Ä—à–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è:</strong><br><br>${blockedReasons.join('<br>')}<br><br>üí° <strong>–ß—Ç–æ –¥–µ–ª–∞—Ç—å:</strong><br>‚Ä¢ –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏<br>‚Ä¢ –î–æ—Å—Ç–∞–≤—å—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—á–∫–æ–≤<br>‚Ä¢ –£—Å—Ç—Ä–∞–Ω–∏—Ç–µ –ø–æ—Ç–µ—Ä–∏ –≤ –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞—á–∞—Ö<br>‚Ä¢ –û—Å–≤–æ–±–æ–¥–∏—Ç–µ –º–µ—Å—Ç–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–µ<br>‚Ä¢ –î–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–æ–ª–æ–Ω–∫–æ–π (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, 5S) - –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å–∞–º—É –∫–æ–ª–æ–Ω–∫—É`;
        
        showToast(title, message, 'warning', 6000);
    }
}

// Actions
function moveCard() {
    if(!G.selected || G.selected.column === 'done') return;
    
    const currentCol = G.selected.column;
    
    // Check if card is ready to move (except from backlog)
    if (currentCol !== 'backlog' && currentCol !== 'done' && !G.selected.isReady) {
        if (G.selected.processingStartTime) {
            const elapsed = Math.floor((Date.now() - G.selected.processingStartTime) / 1000);
            const remaining = Math.max(0, G.selected.processingTime - elapsed);
            log(`‚è±Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∞ –µ—â–µ –≤ —Ä–∞–±–æ—Ç–µ! –û—Å—Ç–∞–ª–æ—Å—å ${remaining} —Å–µ–∫—É–Ω–¥.`, 'warning');
        } else {
            log(`‚è±Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∞ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é!`, 'warning');
        }
        return;
    }
    
    const idx = COLUMNS.indexOf(currentCol);
    const nextCol = COLUMNS[idx + 1];
    
    // Check WIP
    if(G.wipLimits[nextCol]) {
        const count = G.cards.filter(c=>c.column===nextCol).length;
        if(count >= G.wipLimits[nextCol]) {
            log(`WIP –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω –≤ "${nextCol}"! –°–Ω–∞—á–∞–ª–∞ –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É.`, 'warning');
            return;
        }
    }
    
    // Calculate move cost (effort)
    let moveCost = 0;
    if (currentCol !== 'backlog') {
        moveCost = 2; // –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
        if (G.selected.waste) {
            moveCost += 5; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–∏–ª–∏—è –∏–∑-–∑–∞ –ø–æ—Ç–µ—Ä–∏
        }
        
        // Check if we have enough score to move
        if (G.score < moveCost) {
            log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è! –ù—É–∂–Ω–æ: ${moveCost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
            showScoreAnimation('‚ùå');
            return;
        }
    }
    // –ò–∑ backlog - –±–µ—Å–ø–ª–∞—Ç–Ω–æ
    
    const wasteWarning = G.selected.waste ? ' ‚ö†Ô∏è –° –ø–æ—Ç–µ—Ä–µ–π!' : '';
    
    G.selected.column = nextCol;
    G.selected.daysInColumn = 0;
    
    // Start processing timer for work columns (not backlog, not done)
    if (nextCol !== 'backlog' && nextCol !== 'done') {
        // –ë—Ä–æ—Å–∞–µ–º 2d6 –¥–ª—è –±–∞–∑–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (2-12 —Å–µ–∫) –∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 12
        const baseTime = roll2d6() * 12;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ñ–æ–∫—É—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ WIP –∏ —Ä–∞–∑–º–µ—Ä–∞ –∫–æ–º–∞–Ω–¥—ã
        const focusData = calculateFocusMultiplier();
        const focusMultiplier = focusData.multiplier;
        
        // –ò—Ç–æ–≥–æ–≤–æ–µ –≤—Ä–µ–º—è = –±–∞–∑–æ–≤–æ–µ √ó –º–Ω–æ–∂–∏—Ç–µ–ª—å —Ñ–æ–∫—É—Å–∞
        const finalTime = Math.ceil(baseTime * focusMultiplier);
        
        G.selected.isProcessing = true;
        G.selected.isReady = false;
        G.selected.processingStartTime = Date.now();
        G.selected.processingTime = finalTime;
        G.selected.baseProcessingTime = baseTime; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        G.selected.focusMultiplier = focusMultiplier; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å
    }
    
    if(nextCol === 'done') {
        let points = G.selected.value;
        let bonusText = '';
        
        // –ë–æ–Ω—É—Å –∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ç–µ—Ä—å
        if (!G.selected.waste) {
            points += 10;
            bonusText = ' +10 –±–æ–Ω—É—Å –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ';
        }
        
        // Net gain = value + bonus - move cost
        const netGain = points - moveCost;
        G.score += netGain;
        G.delivered++;
        G.selected.dayDelivered = G.day;
        
        showScoreAnimation(netGain >= 0 ? `+${netGain}` : `${netGain}`);
        log(`‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: ${G.selected.title} (+${points}${bonusText} -${moveCost} —É—Å–∏–ª–∏–π = ${netGain >= 0 ? '+' : ''}${netGain}) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
        showItilTip('–ü—Ä–∞–∫—Ç–∏–∫–∞ Deployment Management ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—É. –ü—Ä–∏–Ω—Ü–∏–ø Progress Iteratively ‚Äî –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ.');
    } else {
        if (moveCost > 0) {
            // Deduct effort cost for non-backlog moves
            G.score = Math.max(0, G.score - moveCost);
            showScoreAnimation(`-${moveCost}`);
            let timeInfo = '';
            if (nextCol !== 'done' && G.selected.baseProcessingTime) {
                const baseTime = G.selected.baseProcessingTime;
                const mult = G.selected.focusMultiplier.toFixed(2);
                timeInfo = ` ‚è±Ô∏è ${G.selected.processingTime}—Å (${baseTime}√ó${mult})`;
            }
            log(`‚û°Ô∏è ${G.selected.title} ‚Üí "${nextCol}" (-${moveCost} —É—Å–∏–ª–∏–π${wasteWarning})${timeInfo} | –í—Å–µ–≥–æ: ${G.score}`, 'info');
        } else {
            // Free move from backlog to first work column
            let timeInfo = '';
            if (nextCol !== 'done' && G.selected.baseProcessingTime) {
                const baseTime = G.selected.baseProcessingTime;
                const mult = G.selected.focusMultiplier.toFixed(2);
                timeInfo = ` ‚è±Ô∏è ${G.selected.processingTime}—Å (${baseTime}√ó${mult})`;
            }
            log(`‚û°Ô∏è ${G.selected.title} ‚Üí "${nextCol}" (–Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã)${timeInfo} | –í—Å–µ–≥–æ: ${G.score}`, 'info');
        }
    }
    
    G.selected = null;
    renderCards();
    updateColumnVisuals();
    updateStats();
    updateButtons();
}

function eliminateWaste() {
    if(!G.selected?.waste) return;
    
    if (G.score < 20) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏! –ù—É–∂–Ω–æ: 20, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        return;
    }
    
    const waste = G.selected.waste;
    G.selected.waste = null;
    G.wasteEliminated++;
    G.score = Math.max(0, G.score - 20);
    
    log(`üóëÔ∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø–æ—Ç–µ—Ä—è "${waste.name}" (-20 –æ—á–∫–æ–≤) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    showItilTip(waste.itil);
    showScoreAnimation('-20');
    
    renderCards();
    updateStats();
    updateButtons();
}

function automateProcess() {
    if(!G.selectedColumn) return;
    
    const col = G.selectedColumn;
    
    // Check if deploy column
    if (col === 'deploy') {
        log(`‚ùå –ö–æ–ª–æ–Ω–∫—É "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ" –Ω–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å!`, 'warning');
        showScoreAnimation('‚ùå');
        return;
    }
    
    const automationCost = 50; // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
    
    if (G.score < automationCost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏! –ù—É–∂–Ω–æ: ${automationCost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        return;
    }
    
    if(G.automated[col]) {
        log(`–≠—Ç–∞–ø "${col}" —É–∂–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω`, 'warning');
        return;
    }
    
    G.automated[col] = true;
    G.score = Math.max(0, G.score - automationCost);
    
    log(`ü§ñ –≠—Ç–∞–ø "${col}" –ê–í–¢–û–ú–ê–¢–ò–ó–ò–†–û–í–ê–ù! –í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ ${G.automationSpeed} —Å–µ–∫ (-2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π). (-${automationCost} –æ—á–∫–æ–≤) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    showScoreAnimation(`-${automationCost}`);
    showItilTip(`ü§ñ <strong>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!</strong><br>–ü—Ä–∏–Ω—Ü–∏–ø ITIL 4 "Optimize and Automate" ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä—É—Ç–∏–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–Ω–∏–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫.<br><br>–ö–æ–ª–æ–Ω–∫–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∑–Ω–∞—á–∫–æ–º ü§ñ –ê–≤—Ç–æ (—Å–ª–µ–≤–∞ –≤–≤–µ—Ä—Ö—É). –í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø –∫–∞–∂–¥—ã–µ ${G.automationSpeed} —Å–µ–∫—É–Ω–¥ (-2 —É—Å–∏–ª–∏—è –∑–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ, -7 —Å –ø–æ—Ç–µ—Ä–µ–π).<br><br>–ü–µ—Ä–µ–Ω–æ—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç WIP –ª–∏–º–∏—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏.<br><br>üí° <strong>–£—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Ç–µ—Ä–∏ –ø–µ—Ä–µ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π!</strong> –ü–æ—Ç–µ—Ä–∏ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ 3.5 —Ä–∞–∑–∞.<br><br>‚ö° –ú–æ–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –≤ 4 —ç—Ç–∞–ø–∞ (–ø–æ -500 –∫–∞–∂–¥—ã–π): 20‚Üí13‚Üí8‚Üí5‚Üí3 —Å–µ–∫!`);
    
    updateColumnVisuals();
    updateStats();
    updateButtons();
}

function apply5S() {
    if(!G.selectedColumn) return;
    
    const col = G.selectedColumn;
    const cleaned = G.cards.filter(c=>c.column===col && c.waste).length;
    
    if (cleaned === 0) {
        log(`üßπ 5S –≤ "${col}": –Ω–µ—Ç –ø–æ—Ç–µ—Ä—å –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è! –ö–æ–ª–æ–Ω–∫–∞ —É–∂–µ —á–∏—Å—Ç–∞—è.`, 'info');
        return;
    }
    
    const totalCost = 30 + (cleaned * 10); // 30 –±–∞–∑–æ–≤—ã—Ö + 10 –∑–∞ –∫–∞–∂–¥—É—é –ø–æ—Ç–µ—Ä—é
    
    if (G.score < totalCost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è 5S! –ù—É–∂–Ω–æ: ${totalCost} (30 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è + ${cleaned}√ó10 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ), –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        return;
    }
    
    G.cards.filter(c=>c.column===col && c.waste).forEach(card => {
        card.waste = null;
        G.wasteEliminated++;
    });
    
    G.score = Math.max(0, G.score - totalCost);
    
    log(`üßπ 5S –≤ "${col}": —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ ${cleaned} –ø–æ—Ç–µ—Ä—å! (-${totalCost} –æ—á–∫–æ–≤: 30 –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è + ${cleaned}√ó10 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    log(`‚ú® –ö–æ–ª–æ–Ω–∫–∞ "${col}" –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ –∏ –æ—á–∏—â–µ–Ω–∞ –æ—Ç –≤—Å–µ—Ö –ø–æ—Ç–µ—Ä—å!`, 'success');
    showScoreAnimation(`-${totalCost}`);
    showItilTip('üßπ <strong>5S –º–µ—Ç–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω!</strong><br>–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è 5S: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞, –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≤ —á–∏—Å—Ç–æ—Ç–µ, –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è, –°–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.<br><br>–°–≤—è–∑—å —Å ITIL: –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –í—Å–µ –ø–æ—Ç–µ—Ä–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ–¥–Ω–∏–º –¥–µ–π—Å—Ç–≤–∏–µ–º!<br><br>–°—Ç–æ–∏–º–æ—Å—Ç—å: 30 (–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è) + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–ø–æ—Ç–µ—Ä—å √ó 10 (—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ).');
    
    renderCards();
    updateStats();
    updateButtons();
}

function speedUpAutomation() {
    // 4 —ç—Ç–∞–ø–∞ —É—Å–∫–æ—Ä–µ–Ω–∏—è: 20 ‚Üí 13 ‚Üí 8 ‚Üí 5 ‚Üí 3
    const speedLevels = [
        { from: 20, to: 13, cost: 500, text: '13 —Å–µ–∫—É–Ω–¥' },
        { from: 13, to: 8, cost: 500, text: '8 —Å–µ–∫—É–Ω–¥' },
        { from: 8, to: 5, cost: 500, text: '5 —Å–µ–∫—É–Ω–¥' },
        { from: 5, to: 3, cost: 500, text: '3 —Å–µ–∫—É–Ω–¥—ã' }
    ];
    
    // –ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å
    const currentLevel = speedLevels.find(level => level.from === G.automationSpeed);
    
    if (!currentLevel) {
        log(`‚ö° –°–∫–æ—Ä–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–∂–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è (3 —Å–µ–∫—É–Ω–¥—ã)!`, 'info');
        return;
    }
    
    // Check if there are any automated columns
    if (Object.keys(G.automated).length === 0) {
        log(`‚ùå –°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–æ–ª–æ–Ω–∫—É!`, 'warning');
        return;
    }
    
    if (G.score < currentLevel.cost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è! –ù—É–∂–Ω–æ: ${currentLevel.cost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        return;
    }
    
    G.score = Math.max(0, G.score - currentLevel.cost);
    const oldSpeed = G.automationSpeed;
    G.automationSpeed = currentLevel.to;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    const levelNumber = speedLevels.findIndex(l => l.from === oldSpeed) + 1;
    const levelEmoji = ['‚ö°', '‚ö°‚ö°', '‚ö°‚ö°‚ö°', '‚ö°‚ö°‚ö°‚ö°'][levelNumber - 1];
    
    log(`${levelEmoji} –£–°–ö–û–†–ï–ù–ò–ï ${levelNumber}! –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ ${currentLevel.text}! (-${currentLevel.cost} –æ—á–∫–æ–≤) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    showScoreAnimation(`-${currentLevel.cost}`);
    showItilTip(`${levelEmoji} <strong>–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (—É—Ä–æ–≤–µ–Ω—å ${levelNumber})!</strong><br>–ü—Ä–∏–Ω—Ü–∏–ø ITIL 4 "Optimize and Automate" ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.<br><br>–°–∫–æ—Ä–æ—Å—Ç—å: ${oldSpeed} ‚Üí ${currentLevel.to} —Å–µ–∫—É–Ω–¥<br>–≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫!`);
    
    updateButtons();
}

function highlightWaste(wasteId) {
    const waste = WASTE_TYPES.find(w=>w.id===wasteId);
    if(waste) showItilTip(waste.itil);
}

function addWIP(column) {
    if (!G.running || !G.wipLimits[column]) return;
    
    const cost = 5;
    
    if (G.score < cost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è WIP! –ù—É–∂–Ω–æ: ${cost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤', `–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è WIP –Ω—É–∂–Ω–æ ${cost} –æ—á–∫–æ–≤, —É –≤–∞—Å: ${G.score}`, 'error', 3000);
        return;
    }
    
    G.wipLimits[column]++;
    G.baseWipLimits[column] = G.wipLimits[column]; // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    G.score = Math.max(0, G.score - cost);
    
    log(`üìà WIP "${column}" —É–≤–µ–ª–∏—á–µ–Ω –¥–æ ${G.wipLimits[column]} (-${cost} –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    showScoreAnimation(`-${cost}`);
    showItilTip(`üìà <strong>WIP –ª–∏–º–∏—Ç —É–≤–µ–ª–∏—á–µ–Ω!</strong><br>–ö–æ–ª–æ–Ω–∫–∞ "${column}": ${G.wipLimits[column] - 1} ‚Üí ${G.wipLimits[column]}<br><br>–°—Ç–æ–∏–º–æ—Å—Ç—å: -${cost} –æ—á–∫–æ–≤<br><br>‚úÖ <strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ!</strong><br>–ù–æ–≤—ã–π WIP –ª–∏–º–∏—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –≤—Å–µ –¥–Ω–∏.<br><br>üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.`);
    
    updateStats();
}

function removeWIP(column) {
    if (!G.running || !G.wipLimits[column]) return;
    
    const cost = 5;
    
    if (G.score < cost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è WIP! –ù—É–∂–Ω–æ: ${cost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤', `–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è WIP –Ω—É–∂–Ω–æ ${cost} –æ—á–∫–æ–≤, —É –≤–∞—Å: ${G.score}`, 'error', 3000);
        return;
    }
    
    const currentCount = G.cards.filter(c=>c.column===column).length;
    const newLimit = G.wipLimits[column] - 1;
    
    // –ù–µ–ª—å–∑—è —É–º–µ–Ω—å—à–∏—Ç—å WIP –Ω–∏–∂–µ 1
    if (newLimit < 1) {
        log(`‚ùå –ù–µ–ª—å–∑—è —É–º–µ–Ω—å—à–∏—Ç—å WIP –Ω–∏–∂–µ 1!`, 'warning');
        showToast('‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π WIP', `WIP –ª–∏–º–∏—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 1`, 'warning', 3000);
        return;
    }
    
    // –ù–µ–ª—å–∑—è —É–º–µ–Ω—å—à–∏—Ç—å –µ—Å–ª–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ –±–æ–ª—å—à–µ –∫–∞—Ä—Ç–æ—á–µ–∫
    if (currentCount > newLimit) {
        log(`‚ùå –í "${column}" ${currentCount} –∫–∞—Ä—Ç–æ—á–µ–∫! –°–Ω–∞—á–∞–ª–∞ –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É –¥–æ ${newLimit} –∫–∞—Ä—Ç–æ—á–µ–∫.`, 'warning');
        showToast('‚ùå –ö–æ–ª–æ–Ω–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞', `–í –∫–æ–ª–æ–Ω–∫–µ "${column}" —Å–µ–π—á–∞—Å ${currentCount} –∫–∞—Ä—Ç–æ—á–µ–∫. –£–º–µ–Ω—å—à–∏—Ç—å WIP –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –¥–æ ${newLimit}.`, 'warning', 4000);
        return;
    }
    
    G.wipLimits[column]--;
    G.baseWipLimits[column] = G.wipLimits[column]; // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    G.score = Math.max(0, G.score - cost);
    
    log(`üìâ WIP "${column}" —É–º–µ–Ω—å—à–µ–Ω –¥–æ ${G.wipLimits[column]} (-${cost} –æ—á–∫–æ–≤, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    showScoreAnimation(`-${cost}`);
    showItilTip(`üìâ <strong>WIP –ª–∏–º–∏—Ç —É–º–µ–Ω—å—à–µ–Ω!</strong><br>–ö–æ–ª–æ–Ω–∫–∞ "${column}": ${G.wipLimits[column] + 1} ‚Üí ${G.wipLimits[column]}<br><br>–°—Ç–æ–∏–º–æ—Å—Ç—å: -${cost} –æ—á–∫–æ–≤<br><br>‚úÖ <strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ!</strong><br>–ù–æ–≤—ã–π WIP –ª–∏–º–∏—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –≤—Å–µ –¥–Ω–∏.`);
    
    updateStats();
}

// Timer
function startTimer() {
    if (G.timerInterval) clearInterval(G.timerInterval);
    
    G.timerInterval = setInterval(() => {
        if (!G.running) return;
        
        G.dayTimeLeft--;
        updateStats();
        
        // Update card processing status (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –∫–æ–ª–æ–Ω–æ–∫)
        G.cards.forEach(card => {
            // –ö–∞—Ä—Ç–æ—á–∫–∏ –≤ backlog –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã
            if (card.column === 'backlog') {
                card.isReady = true;
                card.isProcessing = false;
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è —Ä–∞–±–æ—á–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
            else if (card.isProcessing && !card.isReady && card.column !== 'done') {
                const elapsed = Math.floor((Date.now() - card.processingStartTime) / 1000);
                if (elapsed >= card.processingTime) {
                    card.isProcessing = false;
                    card.isReady = true;
                }
            }
        });
        renderCards();
        
        // Auto-move in automated columns (–∫–∞–∂–¥—ã–µ automationSpeed —Å–µ–∫—É–Ω–¥)
        if (G.dayTimeLeft % G.automationSpeed === 0) {
            Object.keys(G.automated).forEach(col => {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É (order) - –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤—Å–µ –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                const cards = G.cards.filter(c=>c.column===col && c.isReady).sort((a, b) => a.order - b.order);
                
                const idx = COLUMNS.indexOf(col);
                const nextCol = COLUMNS[idx + 1];
                
                if (!nextCol) return;
                
                let movedCount = 0;
                let totalCost = 0;
                
                // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç WIP –ª–∏–º–∏—Ç
                cards.forEach(card => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º WIP –ª–∏–º–∏—Ç —Å–ª–µ–¥—É—é—â–µ–π –∫–æ–ª–æ–Ω–∫–∏
                    const currentCountInNext = G.cards.filter(c=>c.column===nextCol).length;
                    if (G.wipLimits[nextCol] && currentCountInNext >= G.wipLimits[nextCol]) {
                        return; // WIP –ª–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º
                    }
                    
                    // Calculate move cost (including waste penalty)
                    let moveCost = 2;
                    if (card.waste) moveCost += 5;
                    
                    // Check if we have enough score for automated move
                    if (G.score < moveCost) {
                        if (movedCount === 0) {
                            log(`‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ (–Ω—É–∂–Ω–æ ${moveCost})`, 'warning');
                        }
                        return;
                    }
                    
                    const wasteWarning = card.waste ? ' ‚ö†Ô∏è' : '';
                    
                    card.column = nextCol;
                    card.daysInColumn = 0;
                    
                    // Start processing for next column (if it's a work column)
                    if (nextCol !== 'done') {
                        const baseTime = roll2d6() * 12;
                        const focusData = calculateFocusMultiplier();
                        const finalTime = Math.ceil(baseTime * focusData.multiplier);
                        
                        card.isProcessing = true;
                        card.isReady = false;
                        card.processingStartTime = Date.now();
                        card.processingTime = finalTime;
                        card.baseProcessingTime = baseTime;
                        card.focusMultiplier = focusData.multiplier;
                    }
                    
                    G.score = Math.max(0, G.score - moveCost);
                    totalCost += moveCost;
                    movedCount++;
                });
                
                // –õ–æ–≥–∏—Ä—É–µ–º –≥—Ä—É–ø–ø–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
                if (movedCount > 0) {
                    log(`ü§ñ –ê–≤—Ç–æ "${col}": –ø–µ—Ä–µ–º–µ—â–µ–Ω–æ ${movedCount} –∑–∞–¥–∞—á ‚Üí "${nextCol}" (-${totalCost} —É—Å–∏–ª–∏–π) | –í—Å–µ–≥–æ: ${G.score}`, 'info');
                    renderCards();
                    updateStats();
                }
            });
        }
        
        // –í—Ä–µ–º—è –≤—ã—à–ª–æ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é
        if (G.dayTimeLeft <= 0) {
            log(`‚è∞ –í—Ä–µ–º—è –¥–Ω—è –∏—Å—Ç–µ–∫–ª–æ! –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é.`, 'warning');
            nextDay();
        }
    }, 1000);
}

function stopTimer() {
    if (G.timerInterval) {
        clearInterval(G.timerInterval);
        G.timerInterval = null;
    }
}

// Next Day
function nextDay() {
    if (!G.running) return;
    
    stopTimer();
    
    G.day++;
    
    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã
    const teamCost = G.teamSize * G.teamDailyCost;
    G.score = Math.max(0, G.score - teamCost);
    log(`üë• –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (${G.teamSize} —á–µ–ª): -${teamCost} –æ—á–∫–æ–≤ | –í—Å–µ–≥–æ: ${G.score}`, 'info');
    
    // –®—Ç—Ä–∞—Ñ –∑–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –ø–æ—Ç–µ—Ä—è–º–∏
    const cardsWithWaste = G.cards.filter(c=>c.waste && c.column!=='done').length;
    if (cardsWithWaste > 0) {
        const penalty = cardsWithWaste * 5;
        G.score = Math.max(0, G.score - penalty);
        log(`‚ö†Ô∏è –®—Ç—Ä–∞—Ñ –∑–∞ ${cardsWithWaste} –ø–æ—Ç–µ—Ä—å (-${penalty} –æ—á–∫–æ–≤)`, 'warning');
    }
    
    // –®—Ç—Ä–∞—Ñ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ Backlog
    const backlogCards = G.cards.filter(c=>c.column==='backlog');
    let totalOverduePenalty = 0;
    let overdueCount = 0;
    
    backlogCards.forEach(card => {
        const overdueDays = G.day - card.urgency;
        if (overdueDays > 0) {
            const cardPenalty = overdueDays * 5;
            totalOverduePenalty += cardPenalty;
            overdueCount++;
            log(`üö® –ü—Ä–æ—Å—Ä–æ—á–∫–∞: ${card.title} (–¥–µ–Ω—å ${card.urgency}, –ø—Ä–æ—Å—Ä–æ—á–∫–∞ ${overdueDays}–¥) -${cardPenalty} –æ—á–∫–æ–≤`, 'warning');
        }
    });
    
    if (totalOverduePenalty > 0) {
        G.score = Math.max(0, G.score - totalOverduePenalty);
        log(`üö® –ò—Ç–æ–≥–æ —à—Ç—Ä–∞—Ñ –∑–∞ ${overdueCount} –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ Backlog: -${totalOverduePenalty} –æ—á–∫–æ–≤ | –í—Å–µ–≥–æ: ${G.score}`, 'warning');
    }
    
    // –ë–æ–Ω—É—Å –∑–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    const delivered = G.cards.filter(c=>c.column==='done' && c.dayDelivered === G.day - 1).length;
    if (delivered > 0) {
        const bonus = delivered * 15;
        G.score += bonus;
        log(`üéâ –ë–æ–Ω—É—Å –∑–∞ ${delivered} –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á (+${bonus} –æ—á–∫–æ–≤)`, 'success');
    }
    
    // Age cards
    G.cards.forEach(card => {
        if(card.column !== 'done') card.daysInColumn++;
    });
    
    // Add new cards to backlog every day
    let newCardsCount;
    if (G.day <= 5) {
        newCardsCount = 5; // –î–Ω–∏ 1-5: 5 –∑–∞–¥–∞—á
    } else if (G.day <= 13) {
        newCardsCount = 8; // –î–Ω–∏ 6-13: 8 –∑–∞–¥–∞—á
    } else if (G.day <= 19) {
        newCardsCount = 13; // –î–Ω–∏ 14-19: 13 –∑–∞–¥–∞—á
    } else {
        newCardsCount = 5; // –î–Ω–∏ 20-21: 5 –∑–∞–¥–∞—á (—Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–Ω–∏)
    }
    
    for (let i = 0; i < newCardsCount; i++) {
        createCard();
    }
    log(`üì• ${newCardsCount} –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Backlog`, 'info');
    
    // Highlight backlog column briefly
    const backlogCol = document.querySelector('[data-col="backlog"]');
    if (backlogCol) {
        backlogCol.style.boxShadow = '0 0 20px rgba(57, 197, 207, 0.5)';
        backlogCol.style.transition = 'box-shadow 0.5s';
        setTimeout(() => {
            backlogCol.style.boxShadow = '';
        }, 1500);
    }
    
    // Random waste appears
    G.cards.filter(c=>!c.waste && c.column!=='done' && c.column!=='backlog').forEach(card => {
        if(Math.random() < 0.2) {
            card.waste = rnd(WASTE_TYPES);
            log(`‚ö†Ô∏è –ü–æ—Ç–µ—Ä—è "${card.waste.name}" –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–∞ –∑–∞–¥–∞—á–µ TASK-${card.id}`, 'waste');
        }
    });
    
    // Move cards from backlog
    const backlog = G.cards.filter(c=>c.column==='backlog');
    if(backlog.length > 0) {
        const analysisCount = G.cards.filter(c=>c.column==='analysis').length;
        if(analysisCount < G.wipLimits.analysis) {
            const baseTime = roll2d6() * 12;
            const focusData = calculateFocusMultiplier();
            const finalTime = Math.ceil(baseTime * focusData.multiplier);
            
            backlog[0].column = 'analysis';
            backlog[0].daysInColumn = 0;
            backlog[0].isProcessing = true;
            backlog[0].isReady = false;
            backlog[0].processingStartTime = Date.now();
            backlog[0].processingTime = finalTime;
            backlog[0].baseProcessingTime = baseTime;
            backlog[0].focusMultiplier = focusData.multiplier;
        }
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ Backlog –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ (urgency)
    const backlogCardsToSort = G.cards.filter(c => c.column === 'backlog');
    if (backlogCardsToSort.length > 0) {
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ urgency (–¥–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏) - –º–µ–Ω—å—à–µ = –±–ª–∏–∂–µ —Å—Ä–æ–∫ = –≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
        backlogCardsToSort.sort((a, b) => a.urgency - b.urgency);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º order –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        backlogCardsToSort.forEach((card, index) => {
            card.order = index;
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-3 —Å–∞–º—ã—Ö —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á–∏
        const top3 = backlogCardsToSort.slice(0, 3);
        const urgentTasks = top3.map(c => {
            const daysLeft = c.urgency - G.day;
            return `TASK-${String(c.id).padStart(3,'0')} (–¥–µ–Ω—å ${c.urgency}, ${daysLeft}–¥)`;
        }).join(', ');
        
        log(`üìã Backlog –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ —Å—Ä–æ–∫–∞–º (${backlogCardsToSort.length} –∑–∞–¥–∞—á). –¢–æ–ø —Å—Ä–æ—á–Ω—ã—Ö: ${urgentTasks}`, 'info');
    }
    
    log(`üìÖ –î–µ–Ω—å ${G.day} –Ω–∞—á–∞–ª—Å—è!`, 'info');
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–Ω–∏–º–æ–∫ –¥–ª—è CFD
    saveCFDSnapshot();
    
    renderCards();
    updateColumnVisuals();
    updateStats();
    
    if(G.day >= G.maxDays) {
        endGame();
        return;
    }
    
    // Reset timer for new day
    G.dayTimeLeft = 120;
    updateStats();
    startTimer();
}

function startGame() {
    if(G.running) return;
    
    G = {
        day: 1, maxDays: 21, score: 300, wasteEliminated: 0, delivered: 0,
        cards: [], cardCounter: 0, selected: null, selectedColumn: null, running: true,
        wipLimits: {...WIP_LIMITS}, 
        baseWipLimits: {...WIP_LIMITS},
        automated: {},
        automationSpeed: 20,
        dayTimeLeft: 120, timerInterval: null,
        teamSize: 5,
        teamDailyCost: 5,
        cfdData: []
    };
    
    // Initial cards
    for(let i=0; i<5; i++) createCard();
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π Backlog –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏
    const initialBacklog = G.cards.filter(c => c.column === 'backlog');
    initialBacklog.sort((a, b) => a.urgency - b.urgency);
    initialBacklog.forEach((card, index) => {
        card.order = index;
    });
    
    document.getElementById('startBtn').disabled = true;
    document.getElementById('nextDayBtn').disabled = false;
    document.getElementById('btnCFD').disabled = false;
    document.getElementById('log').innerHTML = '';
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫ –¥–ª—è CFD
    saveCFDSnapshot();
    log('üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –£ –≤–∞—Å 2 –º–∏–Ω—É—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.', 'success');
    log('üí∞ –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª: 300 –æ—á–∫–æ–≤ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã', 'success');
    log('üë• –ö–æ–º–∞–Ω–¥–∞: 5 —á–µ–ª–æ–≤–µ–∫ (—Å—Ç–æ–∏–º–æ—Å—Ç—å: 25 –æ—á–∫–æ–≤/–¥–µ–Ω—å). –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.', 'info');
    log('üí° –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏, —É—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Ç–µ—Ä–∏, –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—á–∫–∏!', 'info');
    log('üì• –ù–∞—á–∞–ª—å–Ω—ã–π Backlog: 5 –∑–∞–¥–∞—á. –î–Ω–∏ 1-5: +5, –î–Ω–∏ 6-13: +8, –î–Ω–∏ 14-19: +13 –∑–∞–¥–∞—á.', 'info');
    log('üìã –ê–≤—Ç–æ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ Backlog: –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –∑–∞–¥–∞—á–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ (–≤–≤–µ—Ä—Ö—É ‚Äî —Å—Ä–æ—á–Ω—ã–µ)', 'info');
    log('üö® –°—Ä–æ—á–Ω–æ—Å—Ç—å: —É –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –¥–µ–Ω—å –ø–æ—Å—Ç–∞–≤–∫–∏ (–æ—Ç —Å–ª–µ–¥. –¥–Ω—è –¥–æ –¥–Ω—è 20). –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏—è—Ö!', 'warning');
    log('‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –≤ Backlog: -5 –æ—á–∫–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!', 'warning');
    log('‚è±Ô∏è –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –í—Ä–µ–º—è = 2d6√ó12 (–±–∞–∑–æ–≤–æ–µ 24-144—Å) √ó (WIP/–∫–æ–º–∞–Ω–¥–∞)^1.5 (—Ñ–æ–∫—É—Å). –ë–æ–ª—å—à–µ WIP = –¥–æ–ª—å—à–µ!', 'info');
    log('üÜì –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –∏–∑ Backlog: 0 —É—Å–∏–ª–∏–π (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è)', 'success');
    log('‚ö° –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏: –ë–µ–∑ –ø–æ—Ç–µ—Ä—å -2, –° –ø–æ—Ç–µ—Ä–µ–π -7 —É—Å–∏–ª–∏–π!', 'warning');
    log('üíé –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –£—Å—Ç—Ä–∞–Ω—è–π—Ç–µ –ø–æ—Ç–µ—Ä–∏ (-20) + –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ (-2) = -22 –ø—Ä–æ—Ç–∏–≤ -7 –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ —Å –ø–æ—Ç–µ—Ä–µ–π. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç 5+ —ç—Ç–∞–ø–æ–≤!', 'success');
    log('‚ö†Ô∏è –ù–µ–ª—å–∑—è —Ä–∞—Å—Ö–æ–¥–æ–≤–∞—Ç—å –æ—á–∫–∏ –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–µ 0! –°–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º.', 'warning');
    log('üí° –í–ê–ñ–ù–û: –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ö–û–õ–û–ù–ö–£ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –Ω–µ–π (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è, 5S, —É—Å–∫–æ—Ä–µ–Ω–∏–µ)', 'info');
    log('üí° –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ö–ê–†–¢–û–ß–ö–£ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –Ω–µ–π (–ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å, —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é)', 'info');
    log('üîÑ –ü–†–ò–û–†–ò–¢–ò–ó–ê–¶–ò–Ø: –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –∫–æ–ª–æ–Ω–∫–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏', 'info');
    log('ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (-50, —Ñ–∏–∫—Å): –∫–æ–ª–æ–Ω–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –í–°–ï –≥–æ—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫ –¥–æ WIP –ª–∏–º–∏—Ç–∞ (-2 —É—Å–∏–ª–∏—è, -7 —Å –ø–æ—Ç–µ—Ä–µ–π).', 'info');
    log('‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ 4 —ç—Ç–∞–ø–∞ –ø–æ -500: 20‚Üí13‚Üí8‚Üí5‚Üí3 —Å–µ–∫ (–∫–∞–∂–¥—ã–π —ç—Ç–∞–ø +—Å–∫–æ—Ä–æ—Å—Ç—å!)', 'info');
    log('‚ûï –ö–Ω–æ–ø–∫–∏ WIP –Ω–∞ –∫–æ–ª–æ–Ω–∫–∞—Ö: +WIP (-5, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ), -WIP (-5, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ, –º–∏–Ω–∏–º—É–º 1)', 'info');
    log('üö´ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å!', 'warning');
    log('üßπ 5S –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É, —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –í–°–ï –ø–æ—Ç–µ—Ä–∏ —Ä–∞–∑–æ–º (30 + –∫–æ–ª-–≤–æ√ó10).', 'info');
    log('üìä CFD –¥–∏–∞–≥—Ä–∞–º–º–∞: –∫–Ω–æ–ø–∫–∞ "CFD" –ø–æ–∫–∞–∂–µ—Ç –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –∑–∞–¥–∞—á –ø–æ –¥–Ω—è–º', 'info');
    log('üèÜ –§–∏–Ω–∞–ª: CFD, Lead Time, Throughput –∏ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ –ø–æ—Ç–æ–∫–∞!', 'success');
    
    renderCards();
    updateColumnVisuals();
    updateStats();
    startTimer();
}

function resetGame() {
    stopTimer();
    G.running = false;
    G = {
        day: 0, maxDays: 21, score: 0, wasteEliminated: 0, delivered: 0,
        cards: [], cardCounter: 0, selected: null, selectedColumn: null, running: false,
        wipLimits: {...WIP_LIMITS}, 
        baseWipLimits: {...WIP_LIMITS},
        automated: {},
        automationSpeed: 20,
        dayTimeLeft: 120, timerInterval: null,
        teamSize: 5,
        teamDailyCost: 5,
        cfdData: []
    };
    
    document.getElementById('startBtn').disabled = false;
    document.getElementById('nextDayBtn').disabled = true;
    document.getElementById('btnCFD').disabled = true;
    COLUMNS.forEach(col => document.getElementById(`col-${col}`).innerHTML = '');
    document.getElementById('log').innerHTML = '';
    updateStats();
    updateButtons();
}

function endGame() {
    stopTimer();
    G.running = false;
    
    document.getElementById('nextDayBtn').disabled = true;
    
    const eff = Math.round((G.wasteEliminated / Math.max(G.wasteEliminated + G.cards.filter(c=>c.waste).length, 1)) * 100);
    
    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º Lead Time (—Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)
    const completedCards = G.cards.filter(c => c.column === 'done' && c.dayDelivered && c.createdDay);
    let avgLeadTime = 0;
    if (completedCards.length > 0) {
        const totalLeadTime = completedCards.reduce((sum, card) => {
            return sum + (card.dayDelivered - card.createdDay);
        }, 0);
        avgLeadTime = (totalLeadTime / completedCards.length).toFixed(1);
    }
    
    document.getElementById('fDelivered').textContent = G.delivered;
    document.getElementById('fWaste').textContent = G.wasteEliminated;
    document.getElementById('fLeadTime').textContent = avgLeadTime;
    document.getElementById('fEfficiency').textContent = eff + '%';
    document.getElementById('fScore').textContent = G.score;
    
    // –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–∞
    let analysis = '';
    
    // –°—Ä–µ–¥–Ω–µ–µ WIP
    if (G.cfdData.length > 0) {
        let totalWip = 0;
        let wipCount = 0;
        G.cfdData.forEach(snapshot => {
            const wip = snapshot.analysis + snapshot.design + snapshot.develop + snapshot.test + snapshot.deploy;
            totalWip += wip;
            wipCount++;
        });
        const avgWip = (totalWip / wipCount).toFixed(1);
        analysis += `<strong>‚Ä¢ –°—Ä–µ–¥–Ω–∏–π WIP:</strong> ${avgWip} –∑–∞–¥–∞—á –≤ —Ä–∞–±–æ—Ç–µ<br>`;
    }
    
    // Throughput (–ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)
    const throughput = (G.delivered / G.day).toFixed(1);
    analysis += `<strong>‚Ä¢ Throughput:</strong> ${throughput} –∑–∞–¥–∞—á/–¥–µ–Ω—å<br>`;
    
    // Lead Time –æ—Ü–µ–Ω–∫–∞
    if (avgLeadTime > 0) {
        let leadTimeRating = '';
        if (avgLeadTime < 3) {
            leadTimeRating = 'üü¢ –û—Ç–ª–∏—á–Ω–æ! –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞.';
        } else if (avgLeadTime < 5) {
            leadTimeRating = 'üü° –•–æ—Ä–æ—à–æ. –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å.';
        } else if (avgLeadTime < 8) {
            leadTimeRating = 'üü† –°—Ä–µ–¥–Ω–µ. –ï—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –ø–æ—Ç–æ–∫–µ.';
        } else {
            leadTimeRating = 'üî¥ –ú–µ–¥–ª–µ–Ω–Ω–æ. –ú–Ω–æ–≥–æ —É–∑–∫–∏—Ö –º–µ—Å—Ç.';
        }
        analysis += `<strong>‚Ä¢ Lead Time:</strong> ${avgLeadTime} –¥–Ω–µ–π ‚Äî ${leadTimeRating}<br>`;
    }
    
    // –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    if (eff >= 80) {
        analysis += `<strong>‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ:</strong> üü¢ –û—Ç–ª–∏—á–Ω–æ! ${eff}% –∑–∞–¥–∞—á –±–µ–∑ –ø–æ—Ç–µ—Ä—å.`;
    } else if (eff >= 60) {
        analysis += `<strong>‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ:</strong> üü° –•–æ—Ä–æ—à–æ. ${eff}% –∑–∞–¥–∞—á –±–µ–∑ –ø–æ—Ç–µ—Ä—å.`;
    } else {
        analysis += `<strong>‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ:</strong> üî¥ –ú–Ω–æ–≥–æ –ø–æ—Ç–µ—Ä—å. –¢–æ–ª—å–∫–æ ${eff}% –∑–∞–¥–∞—á —á–∏—Å—Ç—ã.`;
    }
    
    document.getElementById('flowAnalysis').innerHTML = analysis;
    
    log('üèÅ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: ' + G.score, 'success');
    log(`üìä Lead Time: ${avgLeadTime} –¥–Ω–µ–π | Throughput: ${throughput} –∑–∞–¥–∞—á/–¥–µ–Ω—å`, 'info');
    
    document.getElementById('gameOver').style.display = 'flex';
    
    // –†–∏—Å—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é CFD –¥–∏–∞–≥—Ä–∞–º–º—É
    setTimeout(() => drawFinalCFD(), 100);
}

function showRules() { document.getElementById('rulesModal').style.display = 'block'; }
function closeRules() { document.getElementById('rulesModal').style.display = 'none'; }

function showTeamModal() {
    document.getElementById('teamModal').style.display = 'block';
    updateTeamDisplay();
}

function closeTeamModal() {
    document.getElementById('teamModal').style.display = 'none';
}

function updateTeamDisplay() {
    document.getElementById('teamSizeDisplay').textContent = G.teamSize;
    const dailyCost = G.teamSize * G.teamDailyCost;
    document.getElementById('teamCostDisplay').textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${dailyCost} –æ—á–∫–æ–≤/–¥–µ–Ω—å`;
}

function addTeamMember() {
    const cost = 10;
    
    if (G.score < cost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –Ω–∞–π–º–∞! –ù—É–∂–Ω–æ: ${cost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤', `–î–ª—è –Ω–∞–π–º–∞ –Ω—É–∂–Ω–æ ${cost} –æ—á–∫–æ–≤, —É –≤–∞—Å: ${G.score}`, 'error', 3000);
        return;
    }
    
    G.teamSize++;
    G.score = Math.max(0, G.score - cost);
    
    log(`üë• –ù–∞–Ω—è—Ç –Ω–æ–≤—ã–π —á–ª–µ–Ω –∫–æ–º–∞–Ω–¥—ã! –†–∞–∑–º–µ—Ä: ${G.teamSize} —á–µ–ª–æ–≤–µ–∫ (-${cost} –æ—á–∫–æ–≤) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    log(`üí∞ –¢–µ–ø–µ—Ä—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã: ${G.teamSize * G.teamDailyCost} –æ—á–∫–æ–≤/–¥–µ–Ω—å`, 'info');
    showScoreAnimation(`-${cost}`);
    
    updateTeamDisplay();
    updateStats();
}

function removeTeamMember() {
    const cost = 15;
    
    if (G.teamSize <= 1) {
        log(`‚ùå –ù–µ–ª—å–∑—è —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –º–µ–Ω—å—à–µ 1 —á–µ–ª–æ–≤–µ–∫–∞!`, 'warning');
        showToast('‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞', `–í –∫–æ–º–∞–Ω–¥–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã 1 —á–µ–ª–æ–≤–µ–∫`, 'warning', 3000);
        return;
    }
    
    if (G.score < cost) {
        log(`‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è —É–≤–æ–ª—å–Ω–µ–Ω–∏—è! –ù—É–∂–Ω–æ: ${cost}, –µ—Å—Ç—å: ${G.score}`, 'warning');
        showScoreAnimation('‚ùå');
        showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤', `–î–ª—è —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ ${cost} –æ—á–∫–æ–≤ (–≤—ã—Ö–æ–¥–Ω–æ–µ –ø–æ—Å–æ–±–∏–µ), —É –≤–∞—Å: ${G.score}`, 'error', 3000);
        return;
    }
    
    G.teamSize--;
    G.score = Math.max(0, G.score - cost);
    
    log(`üë• –ß–ª–µ–Ω –∫–æ–º–∞–Ω–¥—ã —É–≤–æ–ª–µ–Ω. –†–∞–∑–º–µ—Ä: ${G.teamSize} —á–µ–ª–æ–≤–µ–∫ (-${cost} –æ—á–∫–æ–≤ –≤—ã—Ö–æ–¥–Ω–æ–µ) | –í—Å–µ–≥–æ: ${G.score}`, 'success');
    log(`üí∞ –¢–µ–ø–µ—Ä—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã: ${G.teamSize * G.teamDailyCost} –æ—á–∫–æ–≤/–¥–µ–Ω—å`, 'info');
    showScoreAnimation(`-${cost}`);
    
    updateTeamDisplay();
    updateStats();
}

// CFD Functions
function saveCFDSnapshot() {
    const snapshot = {
        day: G.day,
        backlog: G.cards.filter(c=>c.column==='backlog').length,
        analysis: G.cards.filter(c=>c.column==='analysis').length,
        design: G.cards.filter(c=>c.column==='design').length,
        develop: G.cards.filter(c=>c.column==='develop').length,
        test: G.cards.filter(c=>c.column==='test').length,
        deploy: G.cards.filter(c=>c.column==='deploy').length,
        done: G.cards.filter(c=>c.column==='done').length
    };
    G.cfdData.push(snapshot);
}

function showCFD() {
    document.getElementById('cfdModal').style.display = 'block';
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ canvas
    setTimeout(() => drawCFD(), 100);
}

function closeCFD() {
    document.getElementById('cfdModal').style.display = 'none';
}

function drawCFDOnCanvas(canvasId) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    const padding = { top: 40, right: 40, bottom: 60, left: 60 };
    const chartWidth = width - padding.left - padding.right;
    const chartHeight = height - padding.top - padding.bottom;
    
    // –û—á–∏—Å—Ç–∫–∞
    ctx.fillStyle = '#0d1117';
    ctx.fillRect(0, 0, width, height);
    
    if (G.cfdData.length < 2) {
        ctx.fillStyle = '#c9d1d9';
        ctx.font = '16px "Exo 2"';
        ctx.textAlign = 'center';
        ctx.fillText('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö. –ò–≥—Ä–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π!', width / 2, height / 2);
        return;
    }
    
    // –¶–≤–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏ (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö: done, deploy, test, develop, design, analysis, backlog)
    const colors = {
        done: '#238636',      // –∑–µ–ª–µ–Ω—ã–π
        deploy: '#1f6feb',    // —Å–∏–Ω–∏–π
        test: '#8957e5',      // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
        develop: '#d29922',   // –æ—Ä–∞–Ω–∂–µ–≤—ã–π
        design: '#39c5cf',    // —Ü–∏–∞–Ω
        analysis: '#ec4899',  // —Ä–æ–∑–æ–≤—ã–π
        backlog: '#da3633'    // –∫—Ä–∞—Å–Ω—ã–π
    };
    
    const columns = ['done', 'deploy', 'test', 'develop', 'design', 'analysis', 'backlog'];
    
    // –ù–∞–π—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    let maxCumulative = 0;
    G.cfdData.forEach(snapshot => {
        let cumulative = 0;
        columns.forEach(col => {
            cumulative += snapshot[col];
        });
        maxCumulative = Math.max(maxCumulative, cumulative);
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º 10% –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
    maxCumulative = Math.ceil(maxCumulative * 1.1);
    
    // –†–∏—Å—É–µ–º –æ—Å–∏
    ctx.strokeStyle = '#8b949e';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left, height - padding.bottom);
    ctx.lineTo(width - padding.right, height - padding.bottom);
    ctx.stroke();
    
    // –ü–æ–¥–ø–∏—Å–∏ –æ—Å–µ–π
    ctx.fillStyle = '#c9d1d9';
    ctx.font = 'bold 14px "Exo 2"';
    ctx.textAlign = 'center';
    ctx.fillText('–î–µ–Ω—å', width / 2, height - 20);
    
    ctx.save();
    ctx.translate(20, height / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.fillText('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ)', 0, 0);
    ctx.restore();
    
    // –ú–µ—Ç–∫–∏ –Ω–∞ –æ—Å–∏ Y
    ctx.font = '12px "Exo 2"';
    ctx.textAlign = 'right';
    ctx.fillStyle = '#8b949e';
    const ySteps = 5;
    for (let i = 0; i <= ySteps; i++) {
        const value = Math.round((maxCumulative / ySteps) * i);
        const y = height - padding.bottom - (chartHeight / ySteps) * i;
        ctx.fillText(value, padding.left - 10, y + 5);
        
        // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è —Å–µ—Ç–∫–∏
        ctx.strokeStyle = 'rgba(139, 148, 158, 0.2)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(padding.left, y);
        ctx.lineTo(width - padding.right, y);
        ctx.stroke();
    }
    
    // –ú–µ—Ç–∫–∏ –Ω–∞ –æ—Å–∏ X (–¥–Ω–∏)
    ctx.textAlign = 'center';
    ctx.fillStyle = '#8b949e';
    const xStep = Math.max(1, Math.floor(G.cfdData.length / 10));
    G.cfdData.forEach((snapshot, idx) => {
        if (idx % xStep === 0 || idx === G.cfdData.length - 1) {
            const x = padding.left + (chartWidth / (G.cfdData.length - 1)) * idx;
            ctx.fillText(snapshot.day, x, height - padding.bottom + 20);
        }
    });
    
    // –†–∏—Å—É–µ–º –æ–±–ª–∞—Å—Ç–∏ (—Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö)
    columns.forEach((col, colIdx) => {
        ctx.fillStyle = colors[col];
        ctx.beginPath();
        
        // –ù–∏–∂–Ω—è—è –ª–∏–Ω–∏—è (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏)
        G.cfdData.forEach((snapshot, idx) => {
            let cumulativeBefore = 0;
            for (let i = 0; i < colIdx; i++) {
                cumulativeBefore += snapshot[columns[i]];
            }
            const x = padding.left + (chartWidth / (G.cfdData.length - 1)) * idx;
            const y = height - padding.bottom - (cumulativeBefore / maxCumulative) * chartHeight;
            if (idx === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        
        // –í–µ—Ä—Ö–Ω—è—è –ª–∏–Ω–∏—è (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —Å —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–æ–π, –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ)
        for (let idx = G.cfdData.length - 1; idx >= 0; idx--) {
            const snapshot = G.cfdData[idx];
            let cumulativeWith = 0;
            for (let i = 0; i <= colIdx; i++) {
                cumulativeWith += snapshot[columns[i]];
            }
            const x = padding.left + (chartWidth / (G.cfdData.length - 1)) * idx;
            const y = height - padding.bottom - (cumulativeWith / maxCumulative) * chartHeight;
            ctx.lineTo(x, y);
        }
        
        ctx.closePath();
        ctx.fill();
    });
    
    // –õ–µ–≥–µ–Ω–¥–∞
    const legendX = width - padding.right - 10;
    const legendY = padding.top;
    const legendItemHeight = 25;
    
    ctx.font = 'bold 12px "Exo 2"';
    ctx.textAlign = 'right';
    
    columns.reverse().forEach((col, idx) => {
        const y = legendY + idx * legendItemHeight;
        
        // –¶–≤–µ—Ç–Ω–æ–π –∫–≤–∞–¥—Ä–∞—Ç–∏–∫
        ctx.fillStyle = colors[col];
        ctx.fillRect(legendX - 80, y - 10, 15, 15);
        
        // –ù–∞–∑–≤–∞–Ω–∏–µ
        ctx.fillStyle = '#c9d1d9';
        const labels = {
            backlog: 'Backlog',
            analysis: '–ê–Ω–∞–ª–∏–∑',
            design: '–î–∏–∑–∞–π–Ω',
            develop: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
            test: '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
            deploy: '–í–Ω–µ–¥—Ä–µ–Ω–∏–µ',
            done: '–ì–æ—Ç–æ–≤–æ'
        };
        ctx.fillText(labels[col], legendX - 90, y + 2);
    });
}

function drawCFD() {
    drawCFDOnCanvas('cfdCanvas');
}

function drawFinalCFD() {
    drawCFDOnCanvas('finalCfdCanvas');
}

window.onclick = e => { if(e.target.className==='modal') e.target.style.display='none'; }
</script>
</body>
</html>


