<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITIL4 - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-panel: #21262d;
            --bg-hover: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent: #58a6ff;
            --success: #3fb950;
            --warning: #d29922;
            --danger: #f85149;
            --purple: #a371f7;
            --border: #30363d;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--bg-dark);
            background-image:
                radial-gradient(ellipse at 10% 10%, rgba(88, 166, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 90%, rgba(163, 113, 247, 0.08) 0%, transparent 50%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 25px;
        }

        h1 {
            font-family: 'Russo One', sans-serif;
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Score Board */
        .score-board {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .score-item {
            text-align: center;
            padding: 15px 30px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
            min-width: 100px;
        }

        .score-value {
            font-family: 'Russo One', sans-serif;
            font-size: 2rem;
        }

        .score-value.blue { color: var(--accent); }
        .score-value.green { color: var(--success); }
        .score-value.orange { color: var(--warning); }
        .score-value.purple { color: var(--purple); }

        .score-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* Selector Panel */
        .selector-panel {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 25px;
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .selector-panel { grid-template-columns: 1fr; }
        }

        .selector-panel select {
            padding: 12px 15px;
            font-size: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-panel);
            color: var(--text-primary);
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.2s;
        }

        .selector-panel select:hover {
            border-color: var(--accent);
        }

        .selector-panel select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 12px 28px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Exo 2', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #2563eb);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(88, 166, 255, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #22c55e);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(63, 185, 80, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(248, 81, 73, 0.3);
        }

        .btn-secondary {
            background: var(--bg-panel);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Current Instruction */
        .instruction-panel {
            background: var(--bg-card);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .instruction-panel.show { display: block; }

        .instruction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .instruction-header h3 {
            font-family: 'Russo One', sans-serif;
            color: var(--warning);
            font-size: 1rem;
        }

        .instruction-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        /* Tools Panel */
        .tools-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--bg-card);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .tools-panel.hidden { display: none; }

        .tool-btn {
            padding: 10px 18px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-panel);
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Exo 2', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .tool-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent);
        }

        .tool-btn.active {
            background: rgba(88, 166, 255, 0.2);
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Game Container */
        .game-container {
            position: relative;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
            min-height: 500px;
            margin-bottom: 20px;
        }

        #svgDisplay {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            background: white;
        }

        .canvas-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            cursor: crosshair;
            z-index: 10;
            border-radius: 8px;
        }

        /* Answer Panel */
        .answer-panel {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }

        .answer-panel.hidden { display: none; }

        /* Sticky Notes */
        .sticky-note {
            position: absolute;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 4px;
            padding: 12px;
            min-width: 150px;
            max-width: 250px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: move;
            z-index: 100;
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
            color: #1a1a1a;
        }

        .sticky-note-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(0, 0, 0, 0.2);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #1a1a1a;
            transition: all 0.2s;
        }

        .sticky-note-close:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Final Screen */
        .final-screen {
            display: none;
            text-align: center;
            padding: 60px 20px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .final-screen.show { display: block; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .final-screen h2 {
            font-family: 'Russo One', sans-serif;
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--success), #22c55e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .final-score-display {
            font-family: 'Russo One', sans-serif;
            font-size: 4rem;
            color: var(--accent);
            margin: 30px 0;
        }

        .final-score-display span {
            font-size: 2rem;
            color: var(--text-muted);
        }

        .final-message {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .final-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .final-stat {
            text-align: center;
        }

        .final-stat-value {
            font-family: 'Russo One', sans-serif;
            font-size: 2.5rem;
        }

        .final-stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Score Popup */
        .score-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Russo One', sans-serif;
            font-size: 4rem;
            color: var(--success);
            text-shadow: 0 0 30px rgba(63, 185, 80, 0.5);
            z-index: 2000;
            pointer-events: none;
            animation: scorePopup 1s ease-out;
        }

        .score-popup.wrong {
            color: var(--danger);
            text-shadow: 0 0 30px rgba(248, 81, 73, 0.5);
        }

        @keyframes scorePopup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -80%) scale(1); }
        }

        /* Start Screen */
        .start-screen {
            text-align: center;
            padding: 50px 20px;
        }

        .start-screen h2 {
            font-family: 'Russo One', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .start-screen p {
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Rules */
        .rules {
            text-align: left;
            background: var(--bg-card);
            padding: 25px;
            border-radius: 12px;
            max-width: 600px;
            margin: 0 auto 30px;
            border: 1px solid var(--border);
        }

        .rules h3 {
            margin-bottom: 15px;
            color: var(--purple);
            font-family: 'Russo One', sans-serif;
        }

        .rules ul {
            color: var(--text-secondary);
            margin-left: 20px;
        }

        .rules li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .rules li strong {
            color: var(--accent);
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-panel);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        footer {
            text-align: center;
            padding: 25px;
            color: var(--text-muted);
            font-size: 0.8rem;
            border-top: 1px solid var(--border);
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ITIL4 –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</h1>
            <p class="subtitle">–ò–∑—É—á–∞–π—Ç–µ —Ç–µ–º—ã ITIL 4 —Å –ø–æ–º–æ—â—å—é –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫</p>
        </header>

        <!-- Score Board -->
        <div class="score-board" id="scoreBoard" style="display: none;">
            <div class="score-item">
                <div class="score-value green" id="scoreDisplay">0</div>
                <div class="score-label">–û—á–∫–∏</div>
            </div>
            <div class="score-item">
                <div class="score-value orange" id="roundDisplay">1</div>
                <div class="score-label">–î–µ–Ω—å</div>
            </div>
            <div class="score-item">
                <div class="score-value purple" id="totalDisplay">20</div>
                <div class="score-label">–í—Å–µ–≥–æ</div>
            </div>
            <div class="score-item">
                <div class="score-value blue" id="progressPercent">0%</div>
                <div class="score-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Selector Panel -->
        <div class="selector-panel" id="selectorPanel">
            <select id="themeSelect">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É...</option>
                <option value="games-theme1">–¢–µ–º–∞ 1: –í–≤–µ–¥–µ–Ω–∏–µ –≤ ITIL 4</option>
                <option value="games-theme2">–¢–µ–º–∞ 2: SVS, Principles, Practices</option>
                <option value="games-theme3">–¢–µ–º–∞ 3: 7 Guiding Principles</option>
            </select>

            <select id="gameSelect" disabled>
                <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É...</option>
            </select>

            <button class="btn btn-primary" onclick="startGame()">
                <span>‚ñ∂</span> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
            </button>
        </div>

        <!-- Instruction Panel -->
        <div class="instruction-panel" id="instructionPanel">
            <div class="instruction-header">
                <span>üìã</span>
                <h3>–ó–∞–¥–∞–Ω–∏–µ –¥–Ω—è</h3>
            </div>
            <p class="instruction-text" id="instructionText">
                –ò–∑—É—á–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–º–µ—Ç–æ–∫, –∑–∞—Ç–µ–º –æ—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç.
            </p>
        </div>

        <!-- Tools Panel -->
        <div class="tools-panel hidden" id="toolsPanel">
            <button class="tool-btn" onclick="setTool('pen')" id="penTool">
                <span>‚úèÔ∏è</span> –†–∏—Å–æ–≤–∞—Ç—å
            </button>
            <button class="tool-btn" onclick="setTool('eraser')" id="eraserTool">
                <span>üßπ</span> –°—Ç–µ—Ä–µ—Ç—å
            </button>
            <button class="tool-btn" onclick="addStickyNote()">
                <span>üìù</span> –°—Ç–∏–∫–µ—Ä
            </button>
            <button class="tool-btn" onclick="addMark('‚úì')">
                <span>‚úì</span> –û—Ç–º–µ—Ç–∏—Ç—å
            </button>
            <button class="tool-btn" onclick="clearCanvas()">
                <span>üóëÔ∏è</span> –û—á–∏—Å—Ç–∏—Ç—å
            </button>
        </div>

        <!-- Answer Panel -->
        <div class="answer-panel hidden" id="answerPanel">
            <button class="btn btn-success" onclick="submitAnswer(true)" id="correctBtn">
                <span>‚úì</span> –ü—Ä–∞–≤–∏–ª—å–Ω–æ (+10)
            </button>
            <button class="btn btn-danger" onclick="submitAnswer(false)" id="wrongBtn">
                <span>‚úó</span> –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (0)
            </button>
            <button class="btn btn-primary" onclick="nextRound()" id="nextBtn" disabled>
                <span>‚Üí</span> –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
            </button>
            <button class="btn btn-secondary" onclick="restartGame()">
                <span>‚Ü∫</span> –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
            </button>
        </div>

        <!-- Game Container -->
        <div class="game-container" id="gameContainer">
            <canvas id="drawingCanvas" class="canvas-overlay"></canvas>

            <!-- Start Screen -->
            <div class="start-screen" id="startScreen">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –∏ –Ω–∞—á–Ω–∏—Ç–µ 20-–¥–Ω–µ–≤–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –∏–∑—É—á–µ–Ω–∏—é ITIL 4 —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏.</p>

                <div class="rules">
                    <h3>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:</h3>
                    <ul>
                        <li><strong>–¶–µ–ª—å:</strong> –ù–∞–±—Ä–∞—Ç—å –º–∞–∫—Å–∏–º—É–º –æ—á–∫–æ–≤ –∑–∞ 20 –¥–Ω–µ–π –æ–±—É—á–µ–Ω–∏—è</li>
                        <li><strong>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong> –ò–∑—É—á–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–Ω—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–º–µ—Ç–æ–∫</li>
                        <li><strong>–û—Ü–µ–Ω–∫–∞:</strong> –ó–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç +10 –æ—á–∫–æ–≤, –∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π 0</li>
                        <li><strong>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</strong> –†–∏—Å—É–π—Ç–µ, –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å—Ç–∏–∫–µ—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</li>
                        <li><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—á—ë—Ç–æ–º –∏ –¥–Ω—è–º–∏ –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏</li>
                        <li><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í –∫–æ–Ω—Ü–µ —É–≤–∏–¥–∏—Ç–µ –∏—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç –∏ –æ—Ü–µ–Ω–∫—É</li>
                    </ul>
                </div>
            </div>

            <!-- SVG Display -->
            <img id="svgDisplay" alt="–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –Ω–∞—á–∞–ª–∞" style="display: none;" />
        </div>

        <!-- Final Screen -->
        <div class="final-screen" id="finalScreen">
            <h2>üéâ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
            <div class="final-score-display">
                <span id="finalScore">0</span> <span>/ 200</span>
            </div>
            <p class="final-message" id="finalMessage">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</p>

            <div class="final-stats">
                <div class="final-stat">
                    <div class="final-stat-value" style="color: var(--success);" id="correctCount">0</div>
                    <div class="final-stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="final-stat">
                    <div class="final-stat-value" style="color: var(--danger);" id="wrongCount">0</div>
                    <div class="final-stat-label">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</div>
                </div>
                <div class="final-stat">
                    <div class="final-stat-value" style="color: var(--purple);" id="accuracyPercent">0%</div>
                    <div class="final-stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="restartGame()" style="margin-top: 20px;">
                <span>‚Ü∫</span> –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>

        <footer>
            ITIL4 –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ | –ò–∑—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É
        </footer>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä –ø–æ —Ç–µ–º–∞–º
        const games = {
            'games-theme1': [
                'sheet_01_memory.svg',
                'sheet_02_domino.svg',
                'sheet_03_true_false.svg',
                'sheet_04_matching.svg',
                'sheet_05_puzzle.svg',
                'sheet_06_sorting.svg',
                'sheet_07_sequence.svg',
                'sheet_08_bingo.svg',
                'sheet_09_quiz_cards.svg',
                'sheet_10_crossword.svg',
                'sheet_11_role_play.svg',
                'sheet_12_taboo.svg',
                'sheet_13_find_mistakes.svg',
                'sheet_14_scenarios.svg',
                'sheet_15_process_flow.svg'
            ],
            'games-theme2': [
                'sheet_01_memory.svg',
                'sheet_02_guiding_principles.svg',
                'sheet_03_true_false.svg',
                'sheet_04_matching_practices.svg',
                'sheet_05_puzzle_svs.svg',
                'sheet_06_taboo.svg',
                'sheet_07_bingo.svg',
                'sheet_08_domino.svg',
                'sheet_09_sorting.svg',
                'sheet_10_quiz_cards.svg',
                'sheet_11_crossword.svg',
                'sheet_12_find_mistakes.svg',
                'sheet_13_scenarios.svg',
                'sheet_14_sequence.svg',
                'sheet_15_role_play.svg'
            ],
            'games-theme3': [
                'sheet_01_memory.svg',
                'sheet_02_matching.svg',
                'sheet_03_true_false.svg',
                'sheet_04_domino.svg',
                'sheet_05_quiz_cards.svg',
                'sheet_06_sorting.svg',
                'sheet_07_taboo.svg',
                'sheet_08_scenarios.svg',
                'sheet_09_find_mistakes.svg',
                'sheet_10_puzzle.svg',
                'sheet_11_bingo.svg',
                'sheet_12_sequence.svg',
                'sheet_13_role_play.svg',
                'sheet_14_dimensions.svg',
                'sheet_15_crossword.svg'
            ]
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let canvas, ctx;
        let isDrawing = false;
        let currentTool = 'pen';
        let lastX = 0, lastY = 0;
        let stickyNotes = [];

        let currentScore = 0;
        let currentRound = 1;
        const totalRounds = 20;
        let gameStarted = false;
        let currentTheme = '';
        let gameSequence = [];
        let correctAnswers = 0;
        let wrongAnswers = 0;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
        document.getElementById('themeSelect').addEventListener('change', function() {
            const theme = this.value;
            const gameSelect = document.getElementById('gameSelect');

            if (theme) {
                gameSelect.disabled = false;
                gameSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)...</option>';

                games[theme].forEach(game => {
                    const option = document.createElement('option');
                    option.value = `${theme}/${game}`;
                    const gameName = game.replace('.svg', '').replace('sheet_', '').replace(/_/g, ' ');
                    option.textContent = gameName.charAt(0).toUpperCase() + gameName.slice(1);
                    gameSelect.appendChild(option);
                });
            } else {
                gameSelect.disabled = true;
                gameSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É...</option>';
            }
        });

        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        function startGame() {
            const theme = document.getElementById('themeSelect').value;
            if (!theme) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É!');
                return;
            }

            currentTheme = theme;
            currentScore = 0;
            currentRound = 1;
            correctAnswers = 0;
            wrongAnswers = 0;
            gameStarted = true;

            // –°–æ–∑–¥–∞—ë–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑ 20 –¥–Ω–µ–π
            gameSequence = [];
            const availableGames = games[theme];
            for (let i = 0; i < totalRounds; i++) {
                const randomIndex = Math.floor(Math.random() * availableGames.length);
                gameSequence.push(`${theme}/${availableGames[randomIndex]}`);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            document.getElementById('scoreBoard').style.display = 'flex';
            document.getElementById('instructionPanel').classList.add('show');
            document.getElementById('toolsPanel').classList.remove('hidden');
            document.getElementById('answerPanel').classList.remove('hidden');
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('svgDisplay').style.display = 'block';
            document.getElementById('finalScreen').classList.remove('show');
            document.getElementById('selectorPanel').style.display = 'none';

            loadRound();
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—É–Ω–¥
        function loadRound() {
            if (currentRound > totalRounds) {
                showFinalScreen();
                return;
            }

            const gamePath = gameSequence[currentRound - 1];
            const img = document.getElementById('svgDisplay');
            img.src = gamePath;

            img.onload = function() {
                setupCanvas();
                updateStats();
                updateInstruction();

                document.getElementById('nextBtn').disabled = true;
                document.getElementById('correctBtn').disabled = false;
                document.getElementById('wrongBtn').disabled = false;
            };
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas
        function setupCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');

            const img = document.getElementById('svgDisplay');
            canvas.width = img.offsetWidth;
            canvas.height = img.offsetHeight;

            canvas.style.width = img.offsetWidth + 'px';
            canvas.style.height = img.offsetHeight + 'px';

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            stickyNotes.forEach(sticky => sticky.remove());
            stickyNotes = [];

            canvas.onmousedown = startDrawing;
            canvas.onmousemove = draw;
            canvas.onmouseup = stopDrawing;
            canvas.onmouseout = stopDrawing;

            canvas.ontouchstart = handleTouch;
            canvas.ontouchmove = handleTouch;
            canvas.ontouchend = stopDrawing;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function updateStats() {
            document.getElementById('scoreDisplay').textContent = currentScore;
            document.getElementById('roundDisplay').textContent = currentRound;
            document.getElementById('totalDisplay').textContent = totalRounds;

            const progress = Math.round((currentRound - 1) / totalRounds * 100);
            document.getElementById('progressPercent').textContent = `${progress}%`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        function updateInstruction() {
            const instructions = [
                '–ò–∑—É—á–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–Ω—è –∏ –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã',
                '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞–Ω–∏—è',
                '–û—Ç–º–µ—Ç—å—Ç–µ –≤–∞–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ',
                '–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–±—è',
                '–ü–æ–¥—É–º–∞–π—Ç–µ –∏ –ø—Ä–∏–º–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ'
            ];
            const randomInstruction = instructions[Math.floor(Math.random() * instructions.length)];
            document.getElementById('instructionText').textContent =
                `–î–µ–Ω—å ${currentRound}: ${randomInstruction}. –û—Ü–µ–Ω–∏—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –¥–Ω—é.`;
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
        function submitAnswer(isCorrect) {
            if (!gameStarted) return;

            if (isCorrect) {
                currentScore += 10;
                correctAnswers++;
                showScorePopup('+10', true);
            } else {
                wrongAnswers++;
                showScorePopup('0', false);
            }

            updateStats();

            document.getElementById('correctBtn').disabled = true;
            document.getElementById('wrongBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å popup –æ—á–∫–æ–≤
        function showScorePopup(text, isCorrect) {
            const popup = document.createElement('div');
            popup.className = 'score-popup' + (isCorrect ? '' : ' wrong');
            popup.textContent = text;
            document.body.appendChild(popup);

            setTimeout(() => popup.remove(), 1000);
        }

        // –°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥
        function nextRound() {
            currentRound++;
            if (currentRound <= totalRounds) {
                loadRound();
            } else {
                showFinalScreen();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showFinalScreen() {
            gameStarted = false;

            const maxScore = totalRounds * 10;
            const percentage = Math.round((currentScore / maxScore) * 100);

            document.getElementById('finalScore').textContent = currentScore;
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('wrongCount').textContent = wrongAnswers;
            document.getElementById('accuracyPercent').textContent = `${percentage}%`;

            let message = '';
            if (percentage >= 90) {
                message = 'üåü –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ! –í—ã —ç–∫—Å–ø–µ—Ä—Ç ITIL 4!';
            } else if (percentage >= 75) {
                message = 'üéØ –û—Ç–ª–∏—á–Ω–æ! –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!';
            } else if (percentage >= 60) {
                message = 'üëç –•–æ—Ä–æ—à–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —É—á–∏—Ç—å—Å—è!';
            } else if (percentage >= 40) {
                message = 'üìö –ù–µ–ø–ª–æ—Ö–æ, –Ω–æ –µ—Å—Ç—å –Ω–∞–¥ —á–µ–º –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å';
            } else {
                message = 'üí™ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑! –ü—Ä–∞–∫—Ç–∏–∫–∞ –¥–µ–ª–∞–µ—Ç –º–∞—Å—Ç–µ—Ä–∞!';
            }
            document.getElementById('finalMessage').textContent = message;

            document.getElementById('toolsPanel').classList.add('hidden');
            document.getElementById('answerPanel').classList.add('hidden');
            document.getElementById('instructionPanel').classList.remove('show');
            document.getElementById('svgDisplay').style.display = 'none';
            document.getElementById('finalScreen').classList.add('show');
        }

        // –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
        function restartGame() {
            currentScore = 0;
            currentRound = 1;
            correctAnswers = 0;
            wrongAnswers = 0;
            gameStarted = false;

            document.getElementById('finalScreen').classList.remove('show');
            document.getElementById('scoreBoard').style.display = 'none';
            document.getElementById('instructionPanel').classList.remove('show');
            document.getElementById('toolsPanel').classList.add('hidden');
            document.getElementById('answerPanel').classList.add('hidden');
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('svgDisplay').style.display = 'none';
            document.getElementById('selectorPanel').style.display = 'grid';

            if (canvas) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }

            stickyNotes.forEach(sticky => sticky.remove());
            stickyNotes = [];
        }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        function startDrawing(e) {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function draw(e) {
            if (!isDrawing) return;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);

            if (currentTool === 'pen') {
                ctx.strokeStyle = '#58a6ff';
                ctx.lineWidth = 3;
            } else if (currentTool === 'eraser') {
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 20;
            }

            ctx.lineCap = 'round';
            ctx.stroke();

            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;

            if (e.type === 'touchstart') {
                isDrawing = true;
                [lastX, lastY] = [x, y];
            } else if (e.type === 'touchmove' && isDrawing) {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);

                if (currentTool === 'pen') {
                    ctx.strokeStyle = '#58a6ff';
                    ctx.lineWidth = 3;
                } else {
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 20;
                }

                ctx.lineCap = 'round';
                ctx.stroke();

                [lastX, lastY] = [x, y];
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
        function setTool(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tool + 'Tool').classList.add('active');
        }

        // –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–º–µ—Ç–∫—É
        function addMark(mark) {
            const x = canvas.width / 2;
            const y = canvas.height / 2;

            ctx.font = 'bold 48px Arial';
            ctx.fillStyle = '#3fb950';
            ctx.textAlign = 'center';
            ctx.fillText(mark, x, y);
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä
        function addStickyNote() {
            const text = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Å—Ç–∏–∫–µ—Ä–∞:');
            if (!text) return;

            const container = document.getElementById('gameContainer');
            const sticky = document.createElement('div');
            sticky.className = 'sticky-note';
            sticky.innerHTML = `
                <button class="sticky-note-close" onclick="this.parentElement.remove()">‚úï</button>
                <div>${text}</div>
            `;

            sticky.style.left = '50px';
            sticky.style.top = '50px';

            makeDraggable(sticky);
            container.appendChild(sticky);
            stickyNotes.push(sticky);
        }

        // –°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º
        function makeDraggable(element) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            element.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                if (e.target.classList.contains('sticky-note-close')) return;

                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                element.style.top = (element.offsetTop - pos2) + 'px';
                element.style.left = (element.offsetLeft - pos1) + 'px';
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å canvas
        function clearCanvas() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                stickyNotes.forEach(sticky => sticky.remove());
                stickyNotes = [];
            }
        }
    </script>
</body>
</html>
